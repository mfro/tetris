{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ui/config/config-select.vue?75a9","webpack:///./src/main.vue?afaf","webpack:///./src/main.vue?c0e6","webpack:///./src/ui/config/config-number.vue?295b","webpack:///./src/ui/config/config-number.vue?70e2","webpack:////home/mfro/code/web-apps/chess/vue-next/packages/vue/dist/vue.runtime.esm-bundler.js","webpack:///./src/main.vue","webpack:///./src/ui/edit-config.vue","webpack:///./src/ui/config/config-game-rules.vue","webpack:///./src/tetris/config.ts","webpack:///./src/vec.ts","webpack:///./src/ui/config/config-select.vue","webpack:///./src/ui/config/config-select.vue?a069","webpack:///./src/ui/config/config-number.vue","webpack:///./src/ui/config/config-number.vue?0490","webpack:///./src/ui/config/config-rational.vue","webpack:///./src/ui/config/config-rational.vue?6018","webpack:///./src/ui/config/config-game-rules.vue?c2be","webpack:///./src/ui/config/config-user-prefs.vue","webpack:///./src/ui/config/config-autoshift.vue","webpack:///./src/ui/config/config-autoshift.vue?27b0","webpack:///./src/ui/config/config-user-prefs.vue?4068","webpack:///./src/ui/edit-config.vue?e7f8","webpack:///./src/view/room.vue","webpack:///./src/ui/game.vue","webpack:///./src/input.ts","webpack:///./src/tetris/index.ts","webpack:///./src/tetris/render/basic.ts","webpack:///./src/tetris/render/pixi.ts","webpack:///./src/ui/game.vue?8e79","webpack:///./src/ui/clipboard.vue","webpack:///./src/ui/clipboard.vue?d909","webpack:///./src/view/room.vue?0b9e","webpack:///./src/view/landing.vue","webpack:///./src/tetris/remote.ts","webpack:///./src/view/landing.vue?e6b8","webpack:///./src/view/joining.vue","webpack:///./src/view/joining.vue?9e35","webpack:///./src/main.vue?6697","webpack:///./src/main.ts","webpack:///./src/ui/config/config-rational.vue?6031"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","align-center","class","model-value","editing_user","kind","user_prefs","current_room","room","joining_code","code","$event","style","title","icon","small","$emit","actions","color","save","description","gravity","filter","v","lock_delay","move_reset_limit","bag_preview","wall_kicks","options","wallKickOptions","Vec","x","y","this","Math","sqrt","atan2","a","polar","dir","scalar","b","dot","abs","acos","len","cos","sin","constant","type","optional","inner","natural","rational","zero","tetronimos","define","size","raw_tiles","rotation","map","rotations","I","O","T","J","L","S","Z","GARBAGE","all","define_kick_data","raw","no_kick_data","base_kick_data","base_i_kick_data","asira_i_kick_data","standard","Map","asira","none","GameRules","rules","field_size","fall_delay","indexOf","load","src","delay","initial_delay","right","text","label","$refs","select","click","id","ref","option","emits","props","String","modelValue","Array","setup","emit","findIndex","pair","set","render","__scopeId","state","editing","onInput","onBlur","warning","error","Number","Function","toString","immediate","num","parseInt","cssModules","__cssModules","top","focus","setTop","target","column","justify-center","bot","setBot","console","log","components","configSelect","configNumber","configRational","autoshift","soft_drop","configAutoshift","configGameRules","configUserPrefs","game_rules","grow","local","others","member","game","align-start","link","members","winner","index","start","SPACE","LEFT","UP","SHIFT","DOWN","RIGHT","A","X","C","R","down","Set","up_listeners","down_listeners","isKeyDown","k","has","onKeyDown","handler","list","onKeyUp","addEventListener","e","keyCode","add","item","delete","pieces","position","empty_row","row","empty_field","field","empty_state","seed","random","uint32","falling","fall_queue","holding","hold_available","garbage","dead","reactive_state","track","trigger","new_game","self","next_id","collide","part","tile","hard_drop_position","bottom","hold","next_fall","unshift","drop","distance","rotate","kicks","kick_info","assert","kick","lock_down","indices","every","clear_lines","count","floor","assign","new_falling","pool","ceil","end_game","add_garbage","play","user","move_reset","lock_progress","fall_progress","repeating","shift_left","shift_right","repeat_shift","repeat_delay","Infinity","is_on_ground","try_move_reset","change","hard_drop","press_shift","release_shift","cancel","setInterval","update","clearInterval","min","move","TileStyle","draw_styles","v1","context","surroundings","colors","ghost","fillStyle","fillRect","disabled","border","beginPath","lineCap","lineWidth","strokeStyle","moveTo","lineTo","stroke","restore","v2","globalAlpha","translate","left_inner","left_outer","right_inner","right_outer","IMAGE_STRIDE","image_offset","around","scale","render_tilesheets","callback","bytes","TextEncoder","encode","crypto","subtle","digest","then","hash_raw","hash","from","Uint8Array","padStart","join","localStorage","getItem","cache","JSON","parse","styles","normal","canvas","document","createElement","width","height","getContext","kinds","clearRect","offset","url","toDataURL","setItem","stringify","unit_size","pixel","textures","tile_at","pos","base","sprite","texture","SpritePool","container","sprites","removeChild","addChild","offsets","adj","eq","draw_tile","draw_ui","g","topleft","botrite","thickness","lineStyle","clear","center","parts","minX","reduce","minY","maxX","max","maxY","draw_tetronimo","draw_background","beginFill","drawRect","endFill","app","view","transparent","tilesheets","forEach","sheet","loader","onLoad","once","resources","baseTexture","root","background","queue","stage","garbage_pool","destroy","cleanup","pixi_render","copy","copied","bold","solo","input","execCommand","clipboard","editConfig","location","origin","pathname","_","start_game","local_game","valid","create_room","observe","hook","original","socket","host","check_exit","playing","WebSocket","config","players","next","URL","href","searchParams","history","replaceState","search","names","localCleanup","edit","submit","landing","joining","use","mount"],"mappings":"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","file":"js/index.076edb7c.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"index\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-select.vue?vue&type=style&index=0&id=632a7c32&lang=scss&scoped=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./main.vue?vue&type=style&index=0&id=3ed78246&lang=scss\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./main.vue?vue&type=style&index=1&id=3ed78246&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-0-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-0-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-0-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-number.vue?vue&type=style&index=0&id=fb5eeb40&lang=scss&module=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-0-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-0-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-0-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-number.vue?vue&type=style&index=0&id=fb5eeb40&lang=scss&module=true\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"config-number_root_1JO2c\"};","import { setDevtoolsHook, initCustomFormatter, warn } from '@vue/runtime-dom';\nexport * from '@vue/runtime-dom';\nimport { getGlobalThis } from '@vue/shared';\n\nfunction initDev() {\r\n    const target = getGlobalThis();\r\n    target.__VUE__ = true;\r\n    setDevtoolsHook(target.__VUE_DEVTOOLS_GLOBAL_HOOK__);\r\n    {\r\n        initCustomFormatter();\r\n    }\r\n}\n\n// This entry exports the runtime only, and is built as\r\nif ((process.env.NODE_ENV !== 'production') || __VUE_PROD_DEVTOOLS__) {\r\n    initDev();\r\n}\r\nconst compile = () => {\r\n    if ((process.env.NODE_ENV !== 'production')) {\r\n        warn(`Runtime compilation is not supported in this build of Vue.` +\r\n            ( ` Configure your bundler to alias \"vue\" to \"vue/dist/vue.esm-bundler.js\".`\r\n                ) /* should not happen */);\r\n    }\r\n};\n\nexport { compile };\n","<template>\n  <v-app align-center class=\"pa-6\">\n    <v-dialog :model-value=\"editing_user\">\n      <edit-config\n        kind=\"user\"\n        v-model=\"user_prefs\"\n        @close=\"editing_user = false\"\n      />\n    </v-dialog>\n\n    <v-flex class=\"user pa-4\">\n      <v-button @click=\"editing_user = true\">\n        <v-icon class=\"mr-3\">settings</v-icon>\n        <span>User preferences</span>\n      </v-button>\n    </v-flex>\n\n    <room v-if=\"current_room != null\" :room=\"current_room\" />\n\n    <joining\n      v-else-if=\"joining_code != null\"\n      :code=\"joining_code\"\n      @room=\"current_room = $event\"\n    />\n\n    <landing v-else @room=\"current_room = $event\" />\n  </v-app>\n</template>\n\n<script>\nimport { computed, provide, shallowRef, watch } from 'vue';\n\nimport editConfig from '@/ui/edit-config';\n\nimport room from './view/room';\nimport landing from './view/landing';\nimport joining from './view/joining';\n\nexport default {\n  name: 'tetris',\n\n  components: {\n    editConfig,\n\n    room,\n    landing,\n    joining,\n  },\n\n  setup() {\n    const current_room = shallowRef(null);\n    const url = new URL(window.location.href);\n    const code = url.searchParams.get('code');\n    const joining_code = shallowRef(code);\n\n    const raw = localStorage.getItem('mfro:tetris-user-preferences');\n\n    const editing_user = shallowRef(false);\n    const user_prefs = raw ? JSON.parse(raw) : {\n      autoshift: { delay: 2, initial_delay: 10 },\n      soft_drop: 10,\n    };\n\n    provide('user_prefs', user_prefs);\n\n    return {\n      current_room,\n      joining_code,\n      editing_user,\n\n      user_prefs: computed({\n        get: () => user_prefs,\n        set: (v) => {\n          Object.assign(user_prefs, v)\n          localStorage.setItem('mfro:tetris-user-preferences', JSON.stringify(v));\n        },\n      }),\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\">\n#app {\n  width: 100vw;\n  height: 100vh;\n}\n</style>\n\n<style lang=\"scss\" scoped>\n.user {\n  position: absolute;\n  left: 0;\n  bottom: 0;\n}\n</style>\n","<template>\n  <v-card style=\"min-width: 60ch\">\n    <template v-slot:title>\n      <v-text title v-if=\"kind == 'game'\">Game rules</v-text>\n      <v-text title v-if=\"kind == 'user'\">User preferences</v-text>\n\n      <v-grow />\n\n      <v-button icon small @click=\"$emit('close')\">\n        <v-icon>close</v-icon>\n      </v-button>\n    </template>\n\n    <config-game-rules v-if=\"kind == 'game'\" v-model=\"value\" />\n    <config-user-prefs v-if=\"kind == 'user'\" v-model=\"value\" />\n\n    <template v-slot:actions>\n      <v-grow />\n\n      <v-button color=\"primary\" @click=\"save()\">\n        <span>Save</span>\n      </v-button>\n    </template>\n  </v-card>\n</template>\n\n<script>\nimport { shallowRef, watch } from 'vue';\nimport configGameRules from './config/config-game-rules';\nimport configUserPrefs from './config/config-user-prefs';\n\nexport default {\n  name: 'edit-config',\n  components: {\n    configGameRules,\n    configUserPrefs,\n  },\n\n  emits: ['close', 'update:modelValue'],\n  props: {\n    kind: String,\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    const value = shallowRef(props.modelValue);\n\n    watch(() => props.modelValue, v => value.value = v);\n\n    return {\n      value,\n\n      save() {\n        emit('update:modelValue', value.value);\n        emit('close');\n      },\n    }\n  },\n};\n</script>\n","<template>\n  <config-rational\n    name=\"Gravity\"\n    description=\"Gravity for falling pieces (tiles per frame)\"\n    v-model=\"gravity\"\n    :filter=\"(v) => v <= 20\"\n  />\n\n  <config-number\n    name=\"Lock delay\"\n    description=\"Delay after touching the ground before a piece locks down (frames)\"\n    v-model=\"lock_delay\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-number\n    name=\"Move reset limit\"\n    description=\"Maximum number of times the lock delay can be reset by successful shifts or rotates\"\n    v-model=\"move_reset_limit\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-number\n    name=\"Preview size\"\n    description=\"Number of pieces in the preview\"\n    v-model=\"bag_preview\"\n    :filter=\"(v) => v >= 0 && v <= 6\"\n  />\n\n  <config-select\n    name=\"Wall kick style\"\n    description=\"Wall kick configuration to use for rotations\"\n    v-model=\"wall_kicks\"\n    :options=\"wallKickOptions\"\n  />\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport { wall_kicks } from '@/tetris/config';\n\nimport configSelect from './config-select';\nimport configNumber from './config-number';\nimport configRational from './config-rational';\n\nconst wallKickOptions = [\n  ['No Kicks', wall_kicks.none],\n  ['Standard', wall_kicks.standard],\n  ['Asira', wall_kicks.asira],\n];\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-game-rules',\n  components: {\n    configSelect,\n    configNumber,\n    configRational,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let gravity = field(emit, () => props.modelValue, 'fall_delay', v => 1 / v, v => 1 / v);\n    let lock_delay = field(emit, () => props.modelValue, 'lock_delay');\n    let move_reset_limit = field(emit, () => props.modelValue, 'move_reset_limit');\n    let bag_preview = field(emit, () => props.modelValue, 'bag_preview');\n    let wall_kicks = field(emit, () => props.modelValue, 'wall_kicks');\n\n    return {\n      gravity,\n      lock_delay,\n      move_reset_limit,\n      bag_preview,\n      wall_kicks,\n      wallKickOptions,\n    };\n  },\n};\n</script>\n","import { Vec } from '@/vec';\n\nimport { TetronimoKind, Tile, Tetronimo } from '.';\n\nexport namespace tetronimos {\n  function define(size: number, raw_tiles: [number, number][]): TetronimoKind {\n    let rotation = raw_tiles.map(t => new Vec(t[0], t[1]));\n    let rotations = [rotation];\n\n    for (let i = 0; i < 3; ++i) {\n      rotation = rotation.map(v => new Vec(size - 1 - v.y, v.x));\n      rotations.push(rotation);\n    }\n\n    return {\n      size,\n      rotations,\n    };\n  }\n\n  export const I = define(4, [[0, 1], [1, 1], [2, 1], [3, 1]]);\n  export const O = define(2, [[0, 0], [0, 1], [1, 0], [1, 1]]);\n  export const T = define(3, [[1, 0], [0, 1], [1, 1], [2, 1]]);\n  export const J = define(3, [[0, 0], [0, 1], [1, 1], [2, 1]]);\n  export const L = define(3, [[2, 0], [0, 1], [1, 1], [2, 1]]);\n  export const S = define(3, [[1, 0], [2, 0], [0, 1], [1, 1]]);\n  export const Z = define(3, [[0, 0], [1, 0], [1, 1], [2, 1]]);\n  export const GARBAGE = define(0, []);\n\n  export const all = [I, O, T, J, L, S, Z];\n}\n\nexport namespace wall_kicks {\n  function define_kick_data(raw: [number, number][][]) {\n    return raw.map(a => [Vec.zero, ...a.map(a => new Vec(a[0], -a[1]))]);\n  }\n\n  const no_kick_data = define_kick_data([\n    [[0, 0]], // 0 -> 1\n    [[0, 0]], // 1 -> 0\n    [[0, 0]], // 1 -> 2\n    [[0, 0]], // 2 -> 1\n    [[0, 0]], // 2 -> 3\n    [[0, 0]], // 3 -> 2\n    [[0, 0]], // 3 -> 0\n    [[0, 0]], // 0 -> 3\n  ]);\n\n  const base_kick_data = define_kick_data([\n    [[0, 0], [-1, 0], [-1, +1], [0, -2], [-1, -2]], // 0 -> 1\n    [[0, 0], [+1, 0], [+1, -1], [0, +2], [+1, +2]], // 1 -> 0\n    [[0, 0], [+1, 0], [+1, -1], [0, +2], [+1, +2]], // 1 -> 2\n    [[0, 0], [-1, 0], [-1, +1], [0, -2], [-1, -2]], // 2 -> 1\n    [[0, 0], [+1, 0], [+1, +1], [0, -2], [+1, -2]], // 2 -> 3\n    [[0, 0], [-1, 0], [-1, -1], [0, +2], [-1, +2]], // 3 -> 2\n    [[0, 0], [-1, 0], [-1, -1], [0, +2], [-1, +2]], // 3 -> 0\n    [[0, 0], [+1, 0], [+1, +1], [0, -2], [+1, -2]], // 0 -> 3\n  ]);\n\n  const base_i_kick_data = define_kick_data([\n    [[0, 0], [-2, 0], [+1, 0], [-2, -1], [+1, +2]], // 0 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 1 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 1 -> 2\n    [[0, 0], [+1, 0], [-2, 0], [+1, -2], [-2, +1]], // 2 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 2 -> 3\n    [[0, 0], [-2, 0], [+1, 0], [-2, -1], [+1, +2]], // 3 -> 2\n    [[0, 0], [+1, 0], [-2, 0], [+1, -2], [-2, +1]], // 3 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 0 -> 3\n  ]);\n\n  const asira_i_kick_data = define_kick_data([\n    [[0, 0], [-2, 0], [+1, 0], [+1, +2], [-2, -1]], // 0 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 1 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 1 -> 2\n    [[0, 0], [-2, 0], [+1, 0], [-2, +1], [+1, -1]], // 2 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -1]], // 2 -> 3\n    [[0, 0], [+1, 0], [-2, 0], [+1, +2], [-2, -1]], // 3 -> 2\n    [[0, 0], [-2, 0], [+1, 0], [-2, +1], [+1, -2]], // 3 -> 0\n    [[0, 0], [+2, 0], [-1, 0], [-1, +2], [+2, -1]], // 0 -> 3\n  ]);\n\n  export const standard = new Map([\n    [tetronimos.I, base_i_kick_data],\n    [tetronimos.O, base_kick_data],\n    [tetronimos.T, base_kick_data],\n    [tetronimos.J, base_kick_data],\n    [tetronimos.L, base_kick_data],\n    [tetronimos.S, base_kick_data],\n    [tetronimos.Z, base_kick_data],\n  ]);\n\n  export const asira = new Map([\n    [tetronimos.I, asira_i_kick_data],\n    [tetronimos.O, base_kick_data],\n    [tetronimos.T, base_kick_data],\n    [tetronimos.J, base_kick_data],\n    [tetronimos.L, base_kick_data],\n    [tetronimos.S, base_kick_data],\n    [tetronimos.Z, base_kick_data],\n  ]);\n\n  export const none = new Map([\n    [tetronimos.I, no_kick_data],\n    [tetronimos.O, no_kick_data],\n    [tetronimos.T, no_kick_data],\n    [tetronimos.J, no_kick_data],\n    [tetronimos.L, no_kick_data],\n    [tetronimos.S, no_kick_data],\n    [tetronimos.Z, no_kick_data],\n  ]);\n\n  export const all = [none, standard, asira];\n}\n\nexport interface GameRules {\n  // size of the visible playfield\n  field_size: Vec;\n\n  // updates between the falling piece moving down\n  fall_delay: number;\n  // delay before the falling pieces locks into place\n  lock_delay: number;\n  // limit on how many times rotating or shifting the piece can reset the lock delay. null indicates no limit\n  move_reset_limit: null | number;\n\n  // wall kick data\n  wall_kicks: Map<TetronimoKind, Vec[][]>;\n\n  // number of Tetronimos to pre-generate in the queue\n  bag_preview: 5,\n}\n\nexport namespace GameRules {\n  export function save(rules: GameRules): any {\n    return {\n      field_size: [rules.field_size.x, rules.field_size.y],\n      fall_delay: rules.fall_delay,\n      lock_delay: rules.lock_delay,\n      move_reset_limit: rules.move_reset_limit,\n      wall_kicks: wall_kicks.all.indexOf(rules.wall_kicks),\n      bag_preview: rules.bag_preview,\n    };\n  }\n\n  export function load(src: any): GameRules {\n    return {\n      field_size: new Vec(src.field_size[0], src.field_size[1]),\n      fall_delay: src.fall_delay,\n      lock_delay: src.lock_delay,\n      move_reset_limit: src.move_reset_limit,\n      wall_kicks: wall_kicks.all[src.wall_kicks],\n      bag_preview: src.bag_preview,\n    };\n  }\n}\n\nexport interface UserPreferences {\n  // autoshift information for repeating shifts while input is held\n  autoshift: null | { delay: number, initial_delay: number };\n  // multiplier for fall_delay while soft drop is held\n  soft_drop: number;\n}\n\nexport interface GameState {\n  seed: number;\n  field: (Tile | null)[][],\n\n  falling: Tetronimo | null,\n  fall_queue: TetronimoKind[],\n\n  holding: TetronimoKind | null,\n  hold_available: boolean,\n\n  garbage: number[];\n\n  dead: boolean;\n}\n\nexport type Option =\n  | { type: 'constant', value: any }\n  | { type: 'optional', inner: Option }\n  | { name: string, description: string } & (\n    | { type: 'natural' }\n    | { type: 'rational' }\n    | { type: 'select', options: [string, any][] }\n    | { type: 'object', inner: Definition<any> }\n  );\n\nfunction constant(value: any): Option {\n  return { type: 'constant', value };\n}\n\nfunction optional(inner: Option): Option {\n  return { type: 'optional', inner };\n}\n\nfunction natural(name: string, description: string): Option {\n  return { type: 'natural', name, description };\n}\n\nfunction rational(name: string, description: string): Option {\n  return { type: 'rational', name, description };\n}\n\nfunction select(name: string, description: string, options: [string, any][]): Option {\n  return { type: 'select', name, description, options };\n}\n\nfunction object<T>(name: string, description: string, inner: Definition<T>): Option {\n  return { type: 'object', name, description, inner };\n}\n\ntype Definition<T> = {\n  [K in keyof T]: Option;\n}\n\nexport const GameDefinition: Definition<GameRules> = {\n  field_size: constant(new Vec(10, 40)),\n\n  fall_delay: rational('Drop Delay', 'Drop delay for falling pieces (frames per tile)'),\n\n  lock_delay: rational('Lock Delay', 'Lock down delay (frames)'),\n\n  move_reset_limit: optional(rational('Move Reset Limit', 'Maximum number of times the Lock Delay can be reset by successful shifts or rotates')),\n\n  wall_kicks: select('Wall Kicks', 'Wall kick data', [\n    ['No Kicks', wall_kicks.none],\n    ['Standard', wall_kicks.standard],\n    ['Asira', wall_kicks.asira],\n  ]),\n\n  bag_preview: natural('Preview Size', 'Number of pieces in the preview'),\n};\n\nexport const UserDefinition: Definition<UserPreferences> = {\n  autoshift: optional(object('Autoshift', 'Configure repeated shifts while input is held', {\n    delay: rational('Delay', 'Delay between repeated shifts (frames)'),\n    initial_delay: rational('Initial Delay', 'Delay after first shift before repeating (frames)'),\n  })),\n\n  soft_drop: rational('Soft Drop Multiplier', 'Multiplier for Drop Delay while soft dropping'),\n}\n","export class Vec {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n    get len() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n    get dir() {\n        return Math.atan2(this.y, this.x);\n    }\n    static norm(a) {\n        return Vec.polar(1, a.dir);\n    }\n    static scale(a, scalar) {\n        return new Vec(a.x * scalar, a.y * scalar);\n    }\n    static add(a, b) {\n        return new Vec(a.x + b.x, a.y + b.y);\n    }\n    static dot(a, b) {\n        return a.x * b.x + a.y * b.y;\n    }\n    static eq(a, b) {\n        return a.x == b.x && a.y == b.y;\n    }\n    static delta(a, b) {\n        let dot = Vec.dot(a, b);\n        let abs = Math.acos(dot / a.len / b.len);\n        if (a.y * b.x > a.x * b.y)\n            return -abs;\n        return abs;\n    }\n    static polar(len, dir) {\n        return new Vec(Math.cos(dir) * len, Math.sin(dir) * len);\n    }\n}\nVec.zero = new Vec(0, 0);\n","<template>\n  <v-tooltip right :text=\"description\">\n    <v-input :label=\"name\" @click=\"$refs.select.click()\">\n      <template v-slot=\"{ id }\">\n        <select :id=\"id\" v-model=\"value\" ref=\"select\">\n          <option v-for=\"(option, i) in options\" :key=\"option[0]\" :value=\"i\">\n            {{ option[0] }}\n          </option>\n        </select>\n      </template>\n    </v-input>\n  </v-tooltip>\n\n  <!-- <config-value :name=\"name\" :description=\"description\">\n    <v-select\n      small\n      v-model=\"value\"\n      :options=\"options\"\n      :text=\"(o) => o[0]\"\n      :value=\"(o) => o[1]\"\n    />\n  </config-value> -->\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nexport default {\n  name: 'config-select',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: {},\n    options: Array,\n  },\n\n  setup(props, { emit }) {\n    let value = computed({\n      get: () => props.options.findIndex(pair => pair[1] == props.modelValue),\n      set: (v) => {\n        emit('update:modelValue', props.options[v][1]);\n      },\n    });\n\n    return { value };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\nselect {\n  outline: none;\n  width: calc(100% + 32px);\n  margin: -30px -16px -8px -16px;\n  padding: 30px 16px 7px;\n}\n</style>\n","import { render } from \"./config-select.vue?vue&type=template&id=632a7c32&scoped=true\"\nimport script from \"./config-select.vue?vue&type=script&lang=js\"\nexport * from \"./config-select.vue?vue&type=script&lang=js\"\n\nimport \"./config-select.vue?vue&type=style&index=0&id=632a7c32&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-632a7c32\"\n\nexport default script","<template>\n  <v-tooltip right :text=\"description\">\n    <v-text-field\n      :label=\"name\"\n      :model-value=\"state.editing\"\n      @update:model-value=\"onInput\"\n      @blur=\"onBlur\"\n      :warning=\"state.error\"\n    />\n  </v-tooltip>\n</template>\n\n<script>\nimport { nextTick, shallowReactive, watch } from 'vue';\n\nexport default {\n  name: 'config-number',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: Number,\n    filter: Function,\n  },\n\n  setup(props, { emit }) {\n    let state = shallowReactive({\n      editing: null,\n      error: false,\n    });\n\n    watch(() => props.modelValue, () => {\n      state.editing = props.modelValue.toString();\n    }, { immediate: true });\n\n    return {\n      state,\n\n      onInput(v) {\n        state.editing = v;\n\n        let num = parseInt(v, 10);\n\n        if (num.toString() != v || props.filter && !props.filter(num)) {\n          state.error = true;\n        } else {\n          state.error = false;\n          nextTick(() => emit('update:modelValue', num));\n        }\n      },\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" module>\ndiv.root :global(input) {\n  width: 10ch;\n}\n</style>\n","import { render } from \"./config-number.vue?vue&type=template&id=fb5eeb40\"\nimport script from \"./config-number.vue?vue&type=script&lang=js\"\nexport * from \"./config-number.vue?vue&type=script&lang=js\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./config-number.vue?vue&type=style&index=0&id=fb5eeb40&lang=scss&module=true\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <v-tooltip right :text=\"description\">\n    <v-input\n      :label=\"name\"\n      style=\"cursor: text\"\n      @click=\"$refs.top.focus()\"\n      :warning=\"state.error\"\n    >\n      <template v-slot=\"{ id }\">\n        <v-flex>\n          <input\n            ref=\"top\"\n            :id=\"id\"\n            :style=\"{ width: `3ch` }\"\n            :value=\"state.top\"\n            @input=\"setTop($event.target.value)\"\n          />\n\n          <v-flex class=\"mx-2\" column justify-center>\n            <v-text>/</v-text>\n          </v-flex>\n\n          <input\n            @click.stop\n            :value=\"state.bot\"\n            @input=\"setBot($event.target.value)\"\n          />\n        </v-flex>\n      </template>\n    </v-input>\n  </v-tooltip>\n</template>\n\n<script>\nimport { shallowReactive, watch } from 'vue';\n\nexport default {\n  name: 'config-rational',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: Number,\n    filter: Function,\n  },\n\n  setup(props, { emit }) {\n    let state = shallowReactive({\n      top: null,\n      bot: null,\n      error: false,\n    });\n\n    watch(() => props.modelValue, () => {\n      if (props.modelValue > 1) {\n        state.top = props.modelValue.toString();\n        state.bot = '1';\n      } else {\n        state.top = '1';\n        state.bot = 1 / props.modelValue.toString();\n      }\n    }, { immediate: true });\n\n    return {\n      state,\n\n      setTop(v) {\n        state.top = v;\n        state.bot = '1';\n\n        let num = parseInt(v, 10);\n        if (num.toString() != v || props.filter && !props.filter(num)) {\n          state.error = true;\n        } else {\n          state.error = false;\n          emit('update:modelValue', num);\n        }\n      },\n\n      setBot(v) {\n        state.top = '1';\n        state.bot = v;\n\n        let num = 1 / parseInt(v, 10);\n        console.log(v, num);\n        if ((1 / num).toString() != v || props.filter && !props.filter(num)) {\n          state.error = true;\n        } else {\n          state.error = false;\n          emit('update:modelValue', num);\n        }\n      },\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"@mfro/vue-ui/src/style.scss\";\n\ninput {\n  color: inherit;\n  font-size: $text-unit;\n  outline: none;\n\n  font-family: Roboto;\n  font-weight: normal;\n}\n</style>\n","import { render } from \"./config-rational.vue?vue&type=template&id=305fcda5&scoped=true\"\nimport script from \"./config-rational.vue?vue&type=script&lang=js\"\nexport * from \"./config-rational.vue?vue&type=script&lang=js\"\n\nimport \"./config-rational.vue?vue&type=style&index=0&id=305fcda5&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-305fcda5\"\n\nexport default script","import { render } from \"./config-game-rules.vue?vue&type=template&id=6fe6caeb\"\nimport script from \"./config-game-rules.vue?vue&type=script&lang=js\"\nexport * from \"./config-game-rules.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <config-autoshift v-model=\"autoshift\" />\n\n  <config-number\n    name=\"Soft drop multiplier\"\n    description=\"Gravity multiplier when soft dropping\"\n    v-model=\"soft_drop\"\n    :filter=\"(v) => v >= 0\"\n  />\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport configAutoshift from './config-autoshift';\nimport configNumber from './config-number';\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-game-rules',\n  components: {\n    configAutoshift,\n    configNumber,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let autoshift = field(emit, () => props.modelValue, 'autoshift');\n    let soft_drop = field(emit, () => props.modelValue, 'soft_drop');\n\n    return {\n      autoshift,\n      soft_drop,\n    };\n  },\n};\n</script>\n","<template>\n  <config-number\n    name=\"Autoshift delay\"\n    description=\"Delay between repeated shifts while input is held (ARR)\"\n    v-model=\"delay\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-number\n    name=\"Autoshift initial delay\"\n    description=\"Delay after the initial shift when pressing an input before repeating (DAS)\"\n    v-model=\"initial_delay\"\n    :filter=\"(v) => v >= 0\"\n  />\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport configNumber from './config-number';\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-autoshift',\n  components: {\n    configNumber,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let delay = field(emit, () => props.modelValue, 'delay');\n    let initial_delay = field(emit, () => props.modelValue, 'initial_delay');\n\n    return {\n      delay,\n      initial_delay,\n    };\n  },\n};\n</script>\n","import { render } from \"./config-autoshift.vue?vue&type=template&id=1b70b3ed\"\nimport script from \"./config-autoshift.vue?vue&type=script&lang=js\"\nexport * from \"./config-autoshift.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./config-user-prefs.vue?vue&type=template&id=2bb86a88\"\nimport script from \"./config-user-prefs.vue?vue&type=script&lang=js\"\nexport * from \"./config-user-prefs.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./edit-config.vue?vue&type=template&id=54576fb1\"\nimport script from \"./edit-config.vue?vue&type=script&lang=js\"\nexport * from \"./edit-config.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-dialog :model-value=\"editing\">\n    <edit-config kind=\"game\" v-model=\"game_rules\" @close=\"editing = false\" />\n  </v-dialog>\n\n  <v-flex column grow align-center>\n    <v-card v-if=\"!room.local\">\n      <template v-slot:title>\n        <v-flex grow align-start>\n          <v-text title>Tetris Lobby</v-text>\n\n          <v-grow class=\"mx-6\" />\n          <v-grow class=\"mx-6\" />\n\n          <clipboard :value=\"link\" />\n        </v-flex>\n      </template>\n\n      <v-flex column class=\"pt-4\">\n        <v-flex v-for=\"member in room.members\" :key=\"member\" class=\"px-4\">\n          <v-icon class=\"mr-3\" v-if=\"member.winner\" style=\"color: #ffc107\">emoji_events</v-icon>\n          <v-text class=\"my-3\">{{ member.name }}</v-text>\n        </v-flex>\n      </v-flex>\n\n      <template v-slot:actions v-if=\"room.index == 0\">\n        <v-button text @click=\"editing = true\" class=\"mr-3\">\n          <v-icon class=\"mr-3\">settings</v-icon>\n          <span>Game rules</span>\n        </v-button>\n\n        <v-grow />\n\n        <v-button @click=\"start()\" color=\"primary\">\n          <span>Start game</span>\n        </v-button>\n      </template>\n    </v-card>\n\n    <v-flex v-else>\n      <game :value=\"room.local\" />\n\n      <v-flex>\n        <game v-for=\"member in others\" :key=\"member\" :value=\"member.game\" />\n      </v-flex>\n    </v-flex>\n  </v-flex>\n</template>\n\n<script>\nimport { computed, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { wall_kicks } from '@/tetris/config';\n\nimport game from '@/ui/game';\nimport clipboard from '@/ui/clipboard';\nimport editConfig from '@/ui/edit-config';\n\nexport default {\n  name: 'room',\n  components: {\n    game,\n    clipboard,\n    editConfig,\n  },\n\n  props: ['room'],\n\n  setup(props) {\n    const base = window.location;\n    const link = computed(() => `${base.origin}${base.pathname}?code=${props.room.code}`);\n\n    const editing = shallowRef(false);\n    const game_rules = shallowReactive({\n      field_size: new Vec(10, 40),\n      fall_delay: 50,\n      lock_delay: 30,\n      move_reset_limit: 15,\n\n      wall_kicks: wall_kicks.standard,\n\n      bag_preview: 5,\n    });\n\n    const others = computed(() => {\n      return props.room.members.filter((_, i) => i != props.room.index);\n    });\n\n    return {\n      link,\n\n      editing,\n      game_rules,\n      others,\n\n      start() {\n        props.room.start_game(game_rules);\n      },\n    };\n  },\n};\n</script>\n","<template>\n  <canvas ref=\"canvas\" />\n</template>\n\n<script>\nimport { onMounted, ref, toRef, watch } from 'vue';\n\nimport { render as pixi_render } from '@/tetris/render/pixi';\n\nexport default {\n  name: 'game',\n\n  props: {\n    value: Object,\n  },\n\n  setup(props) {\n    let value = toRef(props, 'value');\n    let canvas = ref(null);\n    let cleanup;\n\n    onMounted(() => {\n      watch(value, (game, v) => {\n        cleanup?.();\n\n        if (game) {\n          cleanup = pixi_render(canvas.value, game);\n        }\n      }, { immediate: true });\n    });\n\n    return { canvas };\n  },\n};\n</script>\n","export const\n  SPACE = 32,\n  ENTER = 13,\n  LEFT = 37,\n  UP = 38,\n  SHIFT = 16,\n  DOWN = 40,\n  RIGHT = 39,\n  A = 65,\n  Z = 90,\n  S = 83,\n  X = 88,\n  C = 67,\n  R = 82;\n\nlet down = new Set<number>();\n\nlet up_listeners = new Map<number, (() => void)[]>();\nlet down_listeners = new Map<number, (() => void)[]>();\n\nwindow.addEventListener('keydown', e => {\n  if (down.has(e.keyCode))\n    return;\n\n  // console.log(e.keyCode);\n  down.add(e.keyCode);\n\n  let list = down_listeners.get(e.keyCode);\n  if (!list) return;\n\n  for (let item of list) {\n    item();\n  }\n});\n\nwindow.addEventListener('keyup', e => {\n  down.delete(e.keyCode);\n\n  let list = up_listeners.get(e.keyCode);\n  if (!list) return;\n\n  for (let item of list) {\n    item();\n  }\n});\n\nexport function isKeyDown(k: number) {\n  return down.has(k);\n}\n\nexport function onKeyDown(key: number, handler: () => void) {\n  let list = down_listeners.get(key);\n  if (!list) down_listeners.set(key, list = []);\n  list.push(handler);\n}\n\nexport function onKeyUp(key: number, handler: () => void) {\n  let list = up_listeners.get(key);\n  if (!list) up_listeners.set(key, list = []);\n  list.push(handler);\n}\n","import alea from 'alea';\nimport { customRef, reactive, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { assert } from '@mfro/ts-common/assert';\nimport { A, C, DOWN, isKeyDown, LEFT, onKeyDown, onKeyUp, RIGHT, S, SHIFT, SPACE, UP, X, Z } from '@/input';\n\nimport { GameRules, GameState, tetronimos, UserPreferences } from './config';\n\nconst down = new Vec(0, 1);\n\nexport interface Tile {\n  id: number;\n  kind: TetronimoKind;\n}\n\nexport interface Tetronimo {\n  id: number;\n  kind: TetronimoKind;\n  position: Vec;\n  rotation: number;\n}\n\nexport interface TetronimoKind {\n  size: number;\n  rotations: Vec[][];\n}\n\nexport interface Game {\n  rules: GameRules;\n  state: GameState;\n\n  collide(t: Tetronimo): boolean;\n  hard_drop_position(t: Tetronimo): Vec;\n\n  hold(): void;\n  drop(distance: number): number;\n  shift(dir: 1 | -1): boolean;\n  rotate(dir: 1 | -1): boolean;\n  lock_down(): void;\n  clear_lines(indices: number[]): void;\n  new_falling(): boolean;\n  end_game(): void;\n\n  add_garbage(count: number): void;\n}\n\n/** get the absolute positions of all the pieces of a tetronimo */\nexport function pieces(t: Tetronimo): Vec[] {\n  return t.kind.rotations[t.rotation]\n    .map(v => Vec.add(t.position, v));\n}\n\n/** create an empty row */\nexport function empty_row(rules: GameRules) {\n  let row = [];\n  for (let x = 0; x < rules.field_size.x; ++x) {\n    row[x] = null;\n  }\n  return row;\n}\n\n/** create an empty field */\nexport function empty_field(rules: GameRules) {\n  let field = [];\n  for (let y = 0; y < rules.field_size.y; ++y) {\n    field[y] = empty_row(rules);\n  }\n  return field;\n}\n\n/** create a new game */\nexport function empty_state(rules: GameRules, seed: number | null = null): GameState {\n  if (seed === null)\n    seed = alea(Math.random()).uint32();\n\n  return {\n    seed,\n    field: empty_field(rules),\n\n    falling: null,\n    fall_queue: [],\n    holding: null,\n    hold_available: true,\n    garbage: [],\n    dead: false,\n  };\n}\n\nexport function reactive_state(inner: GameState): GameState {\n  let falling = inner.falling;\n\n  return reactive({\n    seed: inner.seed,\n    field: inner.field.map(row => shallowReactive(row)),\n\n    falling: customRef<typeof falling>((track, trigger) => ({\n      get: () => { track(); return falling; },\n      set: (v) => { falling = v && shallowReactive(v); trigger(); },\n    })),\n    fall_queue: shallowReactive([]),\n    holding: shallowRef(null),\n    hold_available: inner.hold_available,\n    garbage: [],\n    dead: inner.dead,\n  });\n}\n\nexport function new_game(rules: GameRules, state: GameState): Game {\n  let next_id = 0;\n  let holding = false;\n\n  let self: Game;\n\n  function collide(t: Tetronimo) {\n    for (let part of pieces(t)) {\n      if (part.x < 0 || part.x >= rules.field_size.x || part.y >= rules.field_size.y)\n        return true;\n\n      if (part.y < 0)\n        continue;\n\n      let tile = state.field[part.y][part.x];\n      if (tile != null)\n        return true;\n    }\n\n    return false;\n  }\n\n  function hard_drop_position(t: Tetronimo) {\n    let bottom = t.position;\n    while (true) {\n      let position = Vec.add(bottom, down);\n      if (collide({ ...t, position })) break;\n      bottom = position;\n    }\n\n    return bottom;\n  }\n\n  function hold() {\n    if (state.dead || state.falling == null) return;\n\n    let next_fall = state.holding;\n    state.holding = state.falling?.kind ?? null;\n\n    if (next_fall) {\n      state.fall_queue.unshift(next_fall);\n    }\n\n    state.falling = null;\n    state.hold_available = false;\n    holding = true;\n  }\n\n  function drop(distance: number) {\n    if (state.dead || state.falling == null) return 0;\n\n    for (let i = 0; i < distance; ++i) {\n      let position = Vec.add(state.falling.position, down);\n      if (collide({ ...state.falling, position }))\n        return i;\n\n      state.falling.position = position;\n    }\n\n    return distance;\n  }\n\n  function shift(dir: 1 | -1) {\n    if (state.dead || state.falling == null) return false;\n\n    let position = Vec.add(state.falling.position, new Vec(dir, 0));\n    if (!collide({ ...state.falling, position })) {\n      state.falling.position = position;\n      return true;\n    }\n\n    return false;\n  }\n\n  function rotate(dir: 1 | -1) {\n    if (state.dead || state.falling == null) return false;\n\n    let rotation = (state.falling.rotation + dir) % 4;\n    if (rotation < 0) rotation += 4;\n\n    let kick_info = rules.wall_kicks.get(state.falling.kind);\n    assert(kick_info != null, `no kick info for piece`);\n\n    let kicks;\n    if (dir == 1)\n      kicks = kick_info[state.falling.rotation * 2];\n    else\n      kicks = kick_info[rotation * 2 + 1];\n\n    for (let kick of kicks) {\n      let position = Vec.add(state.falling.position, kick)\n\n      if (!collide({ ...state.falling, position, rotation })) {\n        state.falling.position = position;\n        state.falling.rotation = rotation;\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function lock_down() {\n    if (state.dead || state.falling == null) return;\n\n    for (let part of pieces(state.falling)) {\n      state.field[part.y][part.x] = {\n        id: state.falling.id,\n        kind: state.falling.kind,\n      };\n    }\n\n    let indices = [];\n    for (let y = 0; y < rules.field_size.y; ++y) {\n      if (state.field[y].every(t => t != null)) {\n        indices.push(y);\n      }\n    }\n\n    if (indices.length > 0) {\n      self.clear_lines(indices);\n    }\n\n    for (let count of state.garbage) {\n      let random = alea(state.seed);\n      state.seed = random.uint32();\n\n      let column = Math.floor(random() * rules.field_size.x);\n      for (let y = 0; y < rules.field_size.y - count; ++y) {\n        Object.assign(state.field[y], state.field[y + count]);\n      }\n\n      for (let y = rules.field_size.y - count; y < rules.field_size.y; ++y) {\n        for (let x = 0; x < rules.field_size.x; ++x) {\n          if (x == column) state.field[y][x] = null;\n          else state.field[y][x] = { id: -1, kind: tetronimos.GARBAGE };\n        }\n      }\n    }\n    state.garbage.length = 0;\n  }\n\n  function clear_lines(indices: number[]) {\n    console.log(`cleared ${indices.length} lines`);\n\n    for (let index of indices) {\n      for (let i = index; i > 0; --i) {\n        Object.assign(state.field[i], state.field[i - 1]);\n      }\n\n      for (let x = 0; x < rules.field_size.x; ++x) {\n        state.field[0][x] = null;\n      }\n    }\n  }\n\n  function new_falling() {\n    if (state.dead) return false;\n\n    if (state.fall_queue.length - 1 < rules.bag_preview) {\n      let random = alea(state.seed);\n      state.seed = random.uint32();\n\n      let pool = tetronimos.all.slice();\n      while (pool.length > 0) {\n        let i = Math.floor(random() * pool.length);\n        let kind = pool.splice(i, 1)[0];\n        state.fall_queue.push(kind);\n      }\n    }\n\n    let kind = state.fall_queue[0];\n    let position = new Vec(5 - Math.ceil(kind.size / 2), rules.field_size.y / 2 - 2);\n    let rotation = 0;\n\n    let falling = { id: next_id++, kind, position, rotation };\n    state.hold_available = !holding;\n    holding = false;\n\n    if (collide(falling)) {\n      return false;\n    } else {\n      state.fall_queue.shift();\n      state.falling = falling;\n      return true;\n    }\n  }\n\n  function end_game() {\n    state.dead = true;\n    state.falling = null;\n  }\n\n  function add_garbage(count: number) {\n    state.garbage.push(count);\n  }\n\n  return self = {\n    rules, state,\n\n    collide,\n    hard_drop_position,\n\n    hold,\n    drop,\n    shift,\n    rotate,\n    lock_down,\n    clear_lines,\n    new_falling,\n    end_game,\n\n    add_garbage,\n  };\n}\n\nexport function play(user: UserPreferences, game: Game) {\n  let move_reset = 0;\n  let lock_progress = 0;\n  let fall_progress = 0;\n\n  let repeating = false;\n  let shift_left = false;\n  let shift_right = false;\n  let repeat_shift = 0 as 0 | 1 | -1;\n  let repeat_delay = 0;\n\n  new_falling();\n\n  /** generate a new falling tetronimo, filling the bag if needed */\n  function new_falling() {\n    if (game.state.dead) return;\n\n    if (game.new_falling()) {\n      move_reset = game.rules.move_reset_limit ?? Infinity;\n      lock_progress = 0;\n      fall_progress = 0;\n      game.drop(1);\n    } else {\n      game.end_game();\n    }\n  }\n\n  /** determine if the falling piece is resting on the ground */\n  function is_on_ground(t: Tetronimo) {\n    let position = Vec.add(t.position, down);\n\n    return game.collide({ ...t, position });\n  }\n\n  /** lock down the falling tetronimo */\n  function lock_down() {\n    game.lock_down();\n    new_falling();\n  }\n\n  /** reset the lock_delay, consuming a move reset */\n  function try_move_reset() {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (lock_progress > 0 && move_reset > 0) {\n      move_reset -= 1;\n      lock_progress = 0;\n    }\n  }\n\n  /** hold a piece */\n  function hold() {\n    if (!game.state.hold_available) return;\n\n    game.hold();\n    new_falling();\n  }\n\n  /** attempt to shift the falling tetronimo */\n  function shift(change: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (game.shift(change)) {\n      try_move_reset();\n\n      if (user.autoshift) {\n        repeat_delay = repeating\n          ? user.autoshift.delay\n          : user.autoshift.initial_delay;\n\n        repeating = true;\n      }\n    }\n  }\n\n  /** attempt to rotate the falling tetronimo */\n  function rotate(change: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (game.rotate(change)) {\n      try_move_reset();\n      return;\n    }\n  }\n\n  /** hard drop the falling tetronimo */\n  function hard_drop() {\n    if (game.state.dead || game.state.falling == null) return;\n\n    game.drop(20);\n    lock_down();\n  }\n\n  /** shift input handler */\n  function press_shift(dir: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    repeating = false;\n    if (dir == 1)\n      shift_right = true;\n    else\n      shift_left = true;\n    repeat_shift = dir;\n    shift(dir);\n  }\n\n  /** shift input handler */\n  function release_shift(dir: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (dir == 1)\n      shift_right = false;\n    else\n      shift_left = false;\n\n    if (user.autoshift && repeat_shift == dir) {\n      repeat_delay = repeating\n        ? user.autoshift.delay\n        : user.autoshift.initial_delay;\n    }\n\n    repeat_shift = shift_left ? -1 : shift_right ? 1 : 0;\n  }\n\n  onKeyDown(Z, () => rotate(-1));\n  onKeyDown(A, () => rotate(-1));\n  onKeyDown(X, () => rotate(1));\n  onKeyDown(S, () => rotate(1));\n  onKeyDown(UP, () => rotate(1));\n\n  onKeyUp(LEFT, () => release_shift(-1));\n  onKeyDown(LEFT, () => press_shift(-1));\n  onKeyUp(RIGHT, () => release_shift(1));\n  onKeyDown(RIGHT, () => press_shift(1));\n\n  // onKeyDown(DOWN, () => try_drop());\n\n  onKeyDown(SPACE, () => hard_drop());\n\n  onKeyDown(C, () => hold());\n  onKeyDown(SHIFT, () => hold());\n\n  let cancel = setInterval(update, 1000 / 60);\n  function update() {\n    if (game.state.dead) {\n      return clearInterval(cancel);\n    }\n\n    if (repeat_delay > 0) {\n      repeat_delay -= 1;\n    } else if (user.autoshift && repeat_shift != 0) {\n      shift(repeat_shift);\n    }\n\n    if (game.state.falling != null) {\n      if (is_on_ground(game.state.falling)) {\n        lock_progress += 1 / game.rules.lock_delay;\n        fall_progress = Math.min(fall_progress, Math.ceil(1 / game.rules.fall_delay));\n\n        if (lock_progress >= 1) {\n          fall_progress = 0;\n          lock_progress = 0;\n          lock_down();\n        }\n      } else {\n        if (isKeyDown(DOWN))\n          fall_progress += 1 / game.rules.fall_delay * user.soft_drop;\n        else\n          fall_progress += 1 / game.rules.fall_delay\n\n        if (fall_progress > 1) {\n          let drop = Math.floor(fall_progress);\n          let move = game.drop(drop);\n          if (move > 0)\n            move_reset = game.rules.move_reset_limit ?? Infinity;\n          if (move == drop)\n            fall_progress -= drop;\n          else\n            fall_progress = 0;\n        }\n      }\n    }\n  }\n\n  return () => clearInterval(cancel);\n}\n","import { Vec } from '@/vec';\nimport { assert } from '@mfro/ts-common/assert';\n\nimport { TetronimoKind, Tetronimo, pieces, Game } from '..';\nimport { tetronimos } from '../config';\n\n/** draw a single tile of a tetronimo */\nexport const draw_styles = {\n  v1(context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, surroundings: boolean[], style: TileStyle) {\n    const colors = new Map([\n      [tetronimos.I, '#31c7ef'],\n      [tetronimos.O, '#e39f02'],\n      [tetronimos.T, '#af298a'],\n      [tetronimos.J, '#2141c6'],\n      [tetronimos.L, '#e35b02'],\n      [tetronimos.S, '#59b101'],\n      [tetronimos.Z, '#d70f37'],\n      [tetronimos.GARBAGE, 'gray'],\n    ]);\n\n    const p = position;\n\n    context.save();\n    if (style == TileStyle.ghost) {\n      context.fillStyle = 'white';\n      context.fillRect(p.x, p.y, 1, 1);\n    } else if (style == TileStyle.disabled) {\n      context.filter = 'grayscale(100%)';\n    } else {\n      let color = colors.get(kind);\n      assert(color != null, `no color for piece`);\n      context.fillStyle = color;\n      context.fillRect(p.x, p.y, 1, 1);\n    }\n\n    const border = 1 / 8;\n\n    context.beginPath();\n    context.lineCap = 'butt';\n    context.lineWidth = border;\n    context.strokeStyle = '#00000040';\n\n    if (surroundings[0]) {\n      context.moveTo(p.x, p.y + border / 2);\n      context.lineTo(p.x + border / 2, p.y + border / 2);\n      context.lineTo(p.x + border / 2, p.y);\n    }\n\n    if (surroundings[1]) {\n      context.moveTo(p.x, p.y + border / 2);\n      context.lineTo(p.x + 1, p.y + border / 2);\n    }\n\n    if (surroundings[2]) {\n      context.moveTo(p.x + 1 - border / 2, p.y);\n      context.lineTo(p.x + 1 - border / 2, p.y + border / 2);\n      context.lineTo(p.x + 1, p.y + border / 2);\n    }\n\n    if (surroundings[3]) {\n      context.moveTo(p.x - border / 2 + 1, p.y);\n      context.lineTo(p.x - border / 2 + 1, p.y + 1);\n    }\n\n    if (surroundings[4]) {\n      context.moveTo(p.x + 1, p.y + 1 - border / 2);\n      context.lineTo(p.x + 1 - border / 2, p.y + 1 - border / 2);\n      context.lineTo(p.x + 1 - border / 2, p.y + 1);\n    }\n\n    if (surroundings[5]) {\n      context.moveTo(p.x + 1, p.y - border / 2 + 1);\n      context.lineTo(p.x, p.y - border / 2 + 1);\n    }\n\n    if (surroundings[6]) {\n      context.moveTo(p.x + border / 2, p.y + 1);\n      context.lineTo(p.x + border / 2, p.y + 1 - border / 2);\n      context.lineTo(p.x, p.y + 1 - border / 2);\n    }\n\n    if (surroundings[7]) {\n      context.moveTo(p.x + border / 2, p.y + 1);\n      context.lineTo(p.x + border / 2, p.y);\n    }\n\n    // context.strokeStyle = kind.color;\n    // context.stroke();\n\n    context.strokeStyle = '#00000040';\n    context.stroke();\n\n    context.filter = 'none';\n    context.restore();\n  },\n\n  v2(context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, surroundings: boolean[], style: TileStyle) {\n    const border = 1 / 8;\n\n    const colors = new Map([\n      [tetronimos.I, ['#31c7ef', '#48e0ff', '#20b0e0']],\n      [tetronimos.O, ['#f7d308', '#ffec1c', '#e8c000']],\n      [tetronimos.T, ['#ad4d9c', '#c658b4', '#983888']],\n      [tetronimos.J, ['#5a65ad', '#6680cc', '#4857a0']],\n      [tetronimos.L, ['#ef7921', '#ff9030', '#e06810']],\n      [tetronimos.S, ['#42b642', '#48d048', '#30a030']],\n      [tetronimos.Z, ['#ef2029', '#ff4848', '#d01818']],\n      [tetronimos.GARBAGE, ['#42b642', '#48d048', '#30a030']],\n      // [tetronimos.GARBAGE, ['#9e9e9e', '#bdbdbd', '#757575']],\n    ]);\n\n    const p = position;\n\n    let color = colors.get(kind);\n    assert(color != null, `no color for piece`);\n\n    context.save();\n    if (style == TileStyle.ghost) {\n      context.fillStyle = 'white';\n      context.fillRect(p.x, p.y, 1, 1);\n      context.globalAlpha = 0.4;\n    } else if (style == TileStyle.disabled || kind == tetronimos.GARBAGE) {\n      context.filter = 'grayscale(100%)';\n    }\n\n    context.translate(p.x, p.y);\n\n    const left_inner = border;\n    const left_outer = border / 2;\n    const right_inner = 1 - border;\n    const right_outer = 1 - border / 2;\n\n    context.fillStyle = color[0];\n    context.fillRect(left_inner, left_inner, 1 - 2 * border, 1 - 2 * border);\n\n    context.lineCap = 'butt';\n    context.lineWidth = border;\n\n    context.beginPath();\n    context.moveTo(left_outer, right_inner);\n    context.lineTo(left_outer, left_inner);\n    context.strokeStyle = surroundings[7] ? color[1] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(left_inner, left_outer);\n    context.lineTo(right_inner, left_outer);\n    context.strokeStyle = surroundings[1] ? color[1] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(0, left_outer);\n    context.lineTo(left_outer, left_outer);\n    context.lineTo(left_outer, 0);\n    context.strokeStyle = surroundings[0] || surroundings[7] || surroundings[1] ? color[1] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(right_outer, left_inner);\n    context.lineTo(right_outer, right_inner);\n    context.strokeStyle = surroundings[3] ? color[2] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(right_inner, right_outer);\n    context.lineTo(left_inner, right_outer);\n    context.strokeStyle = surroundings[5] ? color[2] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(1, right_outer);\n    context.lineTo(right_outer, right_outer);\n    context.lineTo(right_outer, 1);\n    context.strokeStyle = surroundings[4] || surroundings[3] || surroundings[5] ? color[2] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(right_outer, 0);\n    context.lineTo(right_outer, left_outer);\n    context.lineTo(1, left_outer);\n    context.strokeStyle = surroundings[2] && surroundings[1] && surroundings[3] ? color[0]\n      : surroundings[1] ? color[1]\n        : surroundings[3] ? color[2]\n          : surroundings[2] ? color[2]\n            : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(left_outer, 1);\n    context.lineTo(left_outer, right_outer);\n    context.lineTo(0, right_outer);\n    context.strokeStyle = surroundings[6] && surroundings[7] && surroundings[5] ? color[0]\n      : surroundings[7] ? color[1]\n        : surroundings[5] ? color[2]\n          : surroundings[6] ? color[1]\n            : color[0];\n    context.stroke();\n\n    context.filter = 'none';\n    context.restore();\n  },\n};\n\nexport enum TileStyle {\n  normal,\n  ghost,\n  disabled,\n}\n\nconst IMAGE_STRIDE = 256;\nexport function image_offset(around: boolean[], style: TileStyle, size: number) {\n  let index = style << 8;\n\n  for (let i = 0; i < 8; ++i) {\n    if (around[i]) {\n      index |= (1 << i);\n    }\n  }\n\n  // return Vec.scale(new Vec(x, style), size);\n  return Vec.scale(new Vec(index % IMAGE_STRIDE, Math.floor(index / IMAGE_STRIDE)), size);\n}\n\ninterface ImageCache {\n  hash: string;\n  list: string[];\n}\n\nexport function render_tilesheets(size: number, render: (context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) => void, callback: (s: string[]) => void) {\n  let bytes = new TextEncoder().encode(render.toString());\n  window.crypto.subtle.digest('SHA-256', bytes).then(hash_raw => {\n    let hash = Array.from(new Uint8Array(hash_raw))\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n\n    let raw = localStorage.getItem('mfro:tetris-tilesheet');\n    if (raw) {\n      let cache: ImageCache = JSON.parse(raw);\n      if (cache.hash == hash) {\n        // console.log(`tilesheet hash match ${hash}`);\n        callback(cache.list);\n        return;\n      } else {\n        console.log(`tilesheet hash match ${cache.hash} expected ${hash}`);\n      }\n    }\n\n    const styles = [TileStyle.normal, TileStyle.ghost, TileStyle.disabled];\n\n    let canvas = document.createElement('canvas');\n    canvas.width = size * IMAGE_STRIDE;\n    canvas.height = size * styles.length * (256 / IMAGE_STRIDE);\n\n    let context = canvas.getContext('2d');\n    assert(context != null, 'no context');\n\n    context.scale(size, size);\n\n    let list: string[] = [];\n    let kinds = [...tetronimos.all, tetronimos.GARBAGE];\n\n    for (let kind of kinds) {\n      context!.clearRect(0, 0, canvas.width, canvas.height);\n\n      for (let style of styles) {\n        for (let i = 0; i < 256; ++i) {\n          let around = [];\n          for (let j = 0; j < 8; ++j) around[j] = (i & (1 << j)) != 0;\n\n          let offset = image_offset(around, style, 1);\n          render(context!, offset, kind, around, style);\n        }\n      }\n\n      let url = canvas.toDataURL();\n      list.push(url);\n      if (list.length == kinds.length) {\n        localStorage.setItem('mfro:tetris-tilesheet', JSON.stringify({ hash, list }))\n        callback(list);\n      }\n    }\n  });\n}\n\nfunction prerender(size: number, render: (context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) => void) {\n  let images: HTMLImageElement[] = [];\n  // let images = render_tilesheets(size, render).map(s => {\n  //   let image = new Image();\n  //   image.src = s;\n  //   return image;\n  // });\n\n  return (context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) => {\n    let sheet = images[kind == tetronimos.GARBAGE ? tetronimos.all.length : tetronimos.all.indexOf(kind)];\n    let offset = image_offset(around, style, size);\n\n    context.drawImage(sheet, offset.x, offset.y, size, size, position.x, position.y, 1, 1)\n  };\n}\n\nexport function render(canvas: HTMLCanvasElement, game: Game) {\n  const unit_size = 32;\n  const pixel = 1 / unit_size;\n\n  // const render_tile = draw_tile.v2;\n  const render_tile = prerender(unit_size, draw_styles.v2);\n\n  canvas.width = (game.rules.field_size.x + 12) * unit_size;\n  canvas.height = (game.rules.field_size.y / 2) * unit_size;\n  canvas.style.width = `${canvas.width}px`;\n  canvas.style.height = `${canvas.height}px`;\n\n  const context = canvas.getContext('2d')!;\n  assert(context != null, 'no context');\n\n  context.imageSmoothingEnabled = false;\n\n  function tile_at(pos: Vec) {\n    if (pos.x < 0 || pos.x >= game.rules.field_size.x\n      || pos.y < 0 || pos.y >= game.rules.field_size.y)\n      return null;\n\n    return game.state.field[pos.y][pos.x];\n  }\n\n  const adj8 = [\n    new Vec(-1, -1),\n    new Vec(0, -1),\n    new Vec(1, -1),\n    new Vec(1, 0),\n    new Vec(1, 1),\n    new Vec(0, 1),\n    new Vec(-1, 1),\n    new Vec(-1, 0),\n  ];\n\n  /** draw a a tetronimo */\n  function draw_tetronimo(t: Tetronimo, style: TileStyle) {\n    for (let offset of t.kind.rotations[t.rotation]) {\n      let position = Vec.add(t.position, offset);\n\n      let diff = adj8.map(adj =>\n        t.kind.rotations[t.rotation]\n          .every(v => !Vec.eq(v, Vec.add(offset, adj)))\n      );\n\n      render_tile(context, position, t.kind, diff, style);\n    }\n  }\n\n  /** draw a tetronimo in the UI */\n  function draw_ui(kinds: TetronimoKind[], center: Vec) {\n    let topleft = Vec.add(center, new Vec(-2, -2));\n    let botrite = Vec.add(center, new Vec(2, -1 + 3 * kinds.length));\n\n    context.lineCap = 'butt';\n    context.lineJoin = 'miter';\n    context.strokeStyle = 'gray'\n    context.beginPath();\n\n    const thickness = 2 * pixel;\n    const length = 8 * pixel;\n\n    context.lineWidth = thickness;\n\n    context.moveTo(topleft.x + thickness / 2, topleft.y + length);\n    context.lineTo(topleft.x + thickness / 2, topleft.y + thickness / 2);\n    context.lineTo(topleft.x + length, topleft.y + thickness / 2);\n\n    context.moveTo(botrite.x - length, topleft.y + thickness / 2);\n    context.lineTo(botrite.x - thickness / 2, topleft.y + thickness / 2);\n    context.lineTo(botrite.x - thickness / 2, topleft.y + length);\n\n    context.moveTo(botrite.x - thickness / 2, botrite.y - length);\n    context.lineTo(botrite.x - thickness / 2, botrite.y - thickness / 2);\n    context.lineTo(botrite.x - length, botrite.y - thickness / 2);\n\n    context.moveTo(topleft.x + length, botrite.y - thickness / 2);\n    context.lineTo(topleft.x + thickness / 2, botrite.y - thickness / 2);\n    context.lineTo(topleft.x + thickness / 2, botrite.y - length);\n\n    context.stroke();\n\n    for (let kind of kinds) {\n      let parts = pieces({ id: -1, kind, position: Vec.zero, rotation: 0 });\n\n      let minX = parts.reduce((m, v) => Math.min(m, v.x), Infinity) + 0.5;\n      let minY = parts.reduce((m, v) => Math.min(m, v.y), Infinity) + 0.5;\n      let maxX = parts.reduce((m, v) => Math.max(m, v.x), -Infinity) + 0.5;\n      let maxY = parts.reduce((m, v) => Math.max(m, v.y), -Infinity) + 0.5;\n\n      let offset = new Vec(-(minX + maxX) / 2, -(minY + maxY) / 2);\n      let position = Vec.add(center, offset);\n\n      draw_tetronimo({ id: -1, kind, position, rotation: 0 }, TileStyle.normal);\n\n      center = Vec.add(center, new Vec(0, 3));\n    }\n  }\n\n  requestAnimationFrame(tick);\n  function tick() {\n    requestAnimationFrame(tick);\n\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    context.save();\n\n    context.scale(unit_size, unit_size);\n    context.translate(6, 0);\n\n    if (game.state.holding) {\n      context.save();\n      draw_ui([game.state.holding], new Vec(-3, 3));\n      context.restore();\n    }\n\n    if (game.rules.bag_preview > 0) {\n      draw_ui(game.state.fall_queue.slice(0, game.rules.bag_preview), new Vec(game.rules.field_size.x + 3, 3));\n    }\n\n    context.fillStyle = 'white';\n    context.fillRect(0, 0, game.rules.field_size.x, game.rules.field_size.y);\n\n    context.lineWidth = 1 * pixel;\n    context.strokeStyle = '#f4f4f4';\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      context.beginPath();\n      context.moveTo(x + 0.5 * pixel, 0);\n      context.lineTo(x + 0.5 * pixel, game.rules.field_size.y);\n      context.moveTo((x + 1) - 0.5 * pixel, 0);\n      context.lineTo((x + 1) - 0.5 * pixel, game.rules.field_size.y);\n      context.stroke();\n    }\n\n    for (let y = 0; y < game.rules.field_size.y; ++y) {\n      context.beginPath();\n      context.moveTo(0, y + 0.5 * pixel);\n      context.lineTo(game.rules.field_size.x, y + 0.5 * pixel);\n      context.moveTo(0, (y + 1) - 0.5 * pixel);\n      context.lineTo(game.rules.field_size.x, (y + 1) - 0.5 * pixel);\n      context.stroke();\n    }\n\n    context.translate(0, -game.rules.field_size.y / 2);\n\n    if (game.state.falling) {\n      let position = game.hard_drop_position(game.state.falling);\n      draw_tetronimo({ ...game.state.falling, position }, TileStyle.ghost);\n\n      draw_tetronimo(game.state.falling, TileStyle.normal);\n    }\n\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      for (let y = 0; y < game.rules.field_size.y; ++y) {\n        let t = game.state.field[y][x];\n        if (t == null) continue;\n\n        let position = new Vec(x, y);\n\n        let diff = adj8.map(adj => tile_at(Vec.add(position, adj))?.id != t!.id);\n\n        render_tile(context, new Vec(x, y), game.state.field[y][x]!.kind, diff, TileStyle.normal);\n      }\n    }\n\n    context.restore();\n  }\n}\n","import { Application, BaseTexture, Container, Graphics, Point, Rectangle, Sprite, Texture } from 'pixi.js';\nimport { watch, watchEffect } from 'vue';\n\nimport { Vec } from '@/vec';\n\nimport { TetronimoKind, Game, Tetronimo, pieces } from '..';\nimport { tetronimos } from '../config';\n\nimport { draw_styles, image_offset, render_tilesheets, TileStyle } from './basic';\n\nconst adj8 = [\n  new Vec(-1, -1),\n  new Vec(0, -1),\n  new Vec(1, -1),\n  new Vec(1, 0),\n  new Vec(1, 1),\n  new Vec(0, 1),\n  new Vec(-1, 1),\n  new Vec(-1, 0),\n];\n\nexport function render(canvas: HTMLCanvasElement, game: Game) {\n  const unit_size = 32;\n  const pixel = 1 / unit_size;\n\n  const textures = new Map<TetronimoKind, BaseTexture>();\n\n  canvas.width = (game.rules.field_size.x + 12) * unit_size;\n  canvas.height = (game.rules.field_size.y / 2) * unit_size;\n  canvas.style.width = `${canvas.width}px`;\n  canvas.style.height = `${canvas.height}px`;\n\n  function tile_at(pos: Vec) {\n    if (pos.x < 0 || pos.x >= game.rules.field_size.x\n      || pos.y < 0 || pos.y >= game.rules.field_size.y)\n      return null;\n\n    return game.state.field[pos.y][pos.x];\n  }\n\n  function draw_tile(position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) {\n    let base = textures.get(kind)!;\n    let index = image_offset(around, style, unit_size);\n\n    let sprite = new Sprite();\n    sprite.scale = new Point(1 / unit_size, 1 / unit_size);\n    sprite.texture = new Texture(base, new Rectangle(index.x, index.y, unit_size, unit_size));\n    sprite.position = new Point(position.x, position.y);\n\n    return sprite;\n  }\n\n  class SpritePool {\n    sprites: Sprite[] = [];\n\n    constructor(\n      readonly container: Container,\n    ) { }\n\n    clear() {\n      for (let sprite of this.sprites)\n        this.container.removeChild(sprite);\n      this.sprites = [];\n    }\n\n    draw_tile(position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) {\n      let sprite = draw_tile(position, kind, around, style);\n      this.sprites.push(sprite);\n      this.container.addChild(sprite);\n    }\n\n    draw_tetronimo(t: Tetronimo, style: TileStyle) {\n      let offsets = t.kind.rotations[t.rotation];\n\n      for (let offset of t.kind.rotations[t.rotation]) {\n        let position = Vec.add(t.position, offset);\n\n        let around = adj8.map(adj =>\n          offsets\n            .every(v => !Vec.eq(v, Vec.add(offset, adj)))\n        );\n\n        this.draw_tile(position, t.kind, around, style);\n      }\n    }\n  }\n\n  function draw_ui(src: () => (TetronimoKind | null)[]) {\n    let size = src().length;\n\n    let field = new Container();\n    // field.scale = new Point(1, unit_size);\n\n    let g = new Graphics();\n    field.addChild(g);\n    g.scale = new Point(1 / unit_size, 1 / unit_size);\n\n    let topleft = Vec.scale(new Vec(0, 0), unit_size);\n    let botrite = Vec.scale(new Vec(4, 1 + 3 * size), unit_size);\n\n    const thickness = 2;\n    const length = 8;\n\n    g.lineStyle(thickness, 0x808080, 1, 0);\n\n    g.moveTo(topleft.x, topleft.y + length);\n    g.lineTo(topleft.x, topleft.y);\n    g.lineTo(topleft.x + length, topleft.y);\n\n    g.moveTo(botrite.x - length, topleft.y);\n    g.lineTo(botrite.x, topleft.y);\n    g.lineTo(botrite.x, topleft.y + length);\n\n    g.moveTo(botrite.x, botrite.y - length);\n    g.lineTo(botrite.x, botrite.y);\n    g.lineTo(botrite.x - length, botrite.y);\n\n    g.moveTo(topleft.x + length, botrite.y);\n    g.lineTo(topleft.x, botrite.y);\n    g.lineTo(topleft.x, botrite.y - length);\n\n    let pool = new SpritePool(field);\n    watch(() => [src(), game.state.hold_available] as const, ([list, hold_available]) => {\n      pool.clear();\n\n      let center = new Vec(2, 2);\n\n      for (let kind of list) {\n        if (!kind) continue;\n\n        let parts = pieces({ id: -1, kind, position: Vec.zero, rotation: 0 });\n\n        let minX = parts.reduce((m, v) => Math.min(m, v.x), Infinity) + 0.5;\n        let minY = parts.reduce((m, v) => Math.min(m, v.y), Infinity) + 0.5;\n        let maxX = parts.reduce((m, v) => Math.max(m, v.x), -Infinity) + 0.5;\n        let maxY = parts.reduce((m, v) => Math.max(m, v.y), -Infinity) + 0.5;\n\n        let offset = new Vec(-(minX + maxX) / 2, -(minY + maxY) / 2);\n        let position = Vec.add(center, offset);\n\n        let style = list.length == 1 && !hold_available ? TileStyle.disabled : TileStyle.normal;\n\n        pool.draw_tetronimo({ id: -1, kind, position, rotation: 0 }, style);\n        center = Vec.add(center, new Vec(0, 3));\n      }\n    }, { immediate: true });\n\n    return field;\n  }\n\n  function draw_background(g: Graphics) {\n    g.beginFill(0xFFFFFF);\n    g.drawRect(0, 0, game.rules.field_size.x, game.rules.field_size.y);\n    g.endFill();\n\n    g.lineStyle(pixel, 0xf4f4f4);\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      g.moveTo(x + 0.5 * pixel, 0);\n      g.lineTo(x + 0.5 * pixel, game.rules.field_size.y);\n      g.moveTo((x + 1) - 0.5 * pixel, 0);\n      g.lineTo((x + 1) - 0.5 * pixel, game.rules.field_size.y);\n    }\n\n    for (let y = 0; y < game.rules.field_size.y; ++y) {\n      g.moveTo(0, y + 0.5 * pixel);\n      g.lineTo(game.rules.field_size.x, y + 0.5 * pixel);\n      g.moveTo(0, (y + 1) - 0.5 * pixel);\n      g.lineTo(game.rules.field_size.x, (y + 1) - 0.5 * pixel);\n    }\n  }\n\n  const app = new Application({\n    view: canvas,\n    width: unit_size * (game.rules.field_size.x + 12),\n    height: unit_size * (game.rules.field_size.y / 2),\n    transparent: true,\n  });\n\n  // let s = performance.now();\n  render_tilesheets(unit_size, draw_styles.v2, tilesheets => {\n    // let e = performance.now();\n    // console.log(e - s);\n    tilesheets.forEach((sheet, i) => {\n      app.loader.add(i.toString(), sheet);\n    });\n    app.loader.load();\n  });\n\n  app.loader.onLoad.once(() => {\n    for (let i = 0; i < 7; ++i) {\n      let base = app.loader.resources[i]!.texture.baseTexture;\n      textures.set(tetronimos.all[i], base);\n    }\n    let base = app.loader.resources[tetronimos.all.length]!.texture.baseTexture;\n    textures.set(tetronimos.GARBAGE, base);\n\n    const root = new Container();\n    root.scale = new Point(unit_size, unit_size);\n\n    const field = new Container();\n    field.position = new Point(6, (-game.rules.field_size.y / 2));\n\n    const background = new Graphics();\n    draw_background(background);\n\n    const holding = draw_ui(() => [game.state.holding]);\n    holding.position = new Point(1, 1);\n\n    const queue = draw_ui(() => game.state.fall_queue.slice(0, 5));\n    queue.position = new Point((7 + game.rules.field_size.x), 1);\n\n    const garbage = new Container();\n    garbage.position = new Point(4, 0);\n\n    field.addChild(background);\n    root.addChild(field);\n    root.addChild(queue);\n    root.addChild(holding);\n    root.addChild(garbage);\n    app.stage.addChild(root);\n\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      for (let y = 0; y < game.rules.field_size.y; ++y) {\n        let position = new Vec(x, y);\n        let sprite: Sprite | null = null;\n\n        watchEffect(() => {\n          if (sprite != null) {\n            field.removeChild(sprite);\n            sprite = null;\n          }\n\n          let t = game.state.field[y][x];\n          if (t != null) {\n            let around = adj8.map(adj => tile_at(Vec.add(position, adj))?.id != t!.id);\n            sprite = draw_tile(new Vec(x, y), t.kind, around, TileStyle.normal);\n            field.addChild(sprite);\n          }\n        });\n      }\n    }\n\n    let falling = new SpritePool(field);\n    watchEffect(() => {\n      falling.clear();\n\n      if (game.state.falling) {\n        let position = game.hard_drop_position(game.state.falling);\n        let ghost = { ...game.state.falling, position };\n        falling.draw_tetronimo(ghost, TileStyle.ghost);\n        falling.draw_tetronimo(game.state.falling, TileStyle.normal);\n      }\n    });\n\n    let garbage_pool = new SpritePool(garbage);\n    watchEffect(() => {\n      garbage_pool.clear();\n      let y = game.rules.field_size.y / 2;\n\n      for (let count of game.state.garbage) {\n        y -= count;\n        for (let i = 0; i < count; ++i) {\n          let position = new Vec(0, y + i);\n          garbage_pool.draw_tile(position, tetronimos.GARBAGE, [true, i == 0, true, true, true, i + 1 == count, true, true], TileStyle.normal);\n        }\n      }\n    });\n  });\n\n  return () => app.destroy();\n}\n","import { render } from \"./game.vue?vue&type=template&id=fa91e622\"\nimport script from \"./game.vue?vue&type=script&lang=js\"\nexport * from \"./game.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-flex align-center justify-center>\n    <v-button small icon @click=\"copy()\" @mouseleave=\"copied = false\">\n      <v-icon small v-if=\"!copied\">content_paste</v-icon>\n      <v-icon small v-else bold style=\"color: #4caf50\">check</v-icon>\n    </v-button>\n\n    <v-text-field small class=\"mt-0 ml-4\" ref=\"input\" solo :model-value=\"value\" />\n  </v-flex>\n</template>\n\n<script>\nimport { shallowRef } from 'vue';\n\nexport default {\n  name: 'clipboard',\n\n  props: {\n    value: String,\n  },\n\n  setup(props) {\n    const input = shallowRef(null);\n    const copied = shallowRef(false);\n\n    return {\n      input, copied,\n      copy: () => {\n        input.value.select();\n        document.execCommand('copy');\n        copied.value = true;\n      },\n    };\n  },\n};\n</script>\n","import { render } from \"./clipboard.vue?vue&type=template&id=65564d5c\"\nimport script from \"./clipboard.vue?vue&type=script&lang=js\"\nexport * from \"./clipboard.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./room.vue?vue&type=template&id=45f06c71\"\nimport script from \"./room.vue?vue&type=script&lang=js\"\nexport * from \"./room.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-dialog :model-value=\"editing\">\n    <edit-config kind=\"game\" v-model=\"game_rules\" @close=\"editing = false\" />\n  </v-dialog>\n\n  <v-flex column grow align-center>\n    <game :value=\"local_game\" />\n\n    <v-grow />\n\n    <!-- <v-flex justify-center>\n      <v-button @click=\"editing = true\">\n        <v-icon class=\"mr-3\">settings</v-icon>\n        <span>Game rules</span>\n      </v-button>\n    </v-flex> -->\n\n    <v-card class=\"mt-4\">\n      <v-text-field label=\"Name\" v-model=\"name\" />\n\n      <v-flex justify-center class=\"my-2\">\n        <v-button\n          text\n          color=\"primary\"\n          :disabled=\"!valid\"\n          @click=\"create_room()\"\n        >\n          <span>Create lobby</span>\n          <v-icon class=\"ml-3\">arrow_forward</v-icon>\n        </v-button>\n      </v-flex>\n    </v-card>\n  </v-flex>\n</template>\n\n<script>\nimport { computed, inject, onBeforeUnmount, onMounted, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { onKeyDown, R } from '@/input';\nimport { play, new_game, reactive_state, empty_state } from '@/tetris';\nimport { wall_kicks } from '@/tetris/config';\nimport { create_room } from '@/tetris/remote';\n\nimport game from '@/ui/game';\nimport editConfig from '@/ui/edit-config';\nimport configGameRules from '@/ui/config/config-game-rules';\nimport configUserPrefs from '@/ui/config/config-user-prefs';\n\nexport default {\n  name: 'landing',\n  components: {\n    game,\n    editConfig,\n    configGameRules,\n    configUserPrefs,\n  },\n\n  emits: ['room'],\n\n  setup(props, { emit }) {\n    const editing = shallowRef(null);\n    const game_rules = shallowReactive({\n      field_size: new Vec(10, 40),\n      fall_delay: 50,\n      lock_delay: 30,\n      move_reset_limit: 15,\n\n      wall_kicks: wall_kicks.standard,\n\n      bag_preview: 5,\n    });\n\n    const user_prefs = inject('user_prefs');\n\n    const local_game = shallowRef(null);\n\n    let localCleanup;\n    const start_game = () => {\n      localCleanup?.();\n\n      const state = reactive_state(empty_state(game_rules));\n      local_game.value = new_game(game_rules, state);\n      localCleanup = play(user_prefs, local_game.value);\n    };\n\n    onMounted(() => {\n      start_game();\n    });\n\n    onBeforeUnmount(() => localCleanup?.());\n\n    onKeyDown(R, () => start_game());\n\n    const name = shallowRef(localStorage.getItem('mfro:user-name') ?? '');\n    const valid = computed(() => {\n      return name.value != '';\n    });\n\n    return {\n      local_game,\n\n      editing,\n      game_rules,\n\n      name,\n      valid,\n\n      create_room() {\n        localStorage.setItem('mfro:user-name', name.value);\n        let room = create_room(name.value, user_prefs);\n        emit('room', room);\n      },\n\n      edit(name) {\n        editing.value = name;\n      },\n    };\n  },\n};\n</script>\n","import alea from 'alea';\nimport { shallowReactive } from 'vue';\n\nimport { on } from '@mfro/ts-common/events';\nimport { receive, send } from '@mfro/ts-common/sockets/client';\nimport { BroadcastUpdate, ClientUpdate, RoomCode, RoomState, StartGame, StartGameRequest } from 'common';\n\nimport { empty_state, Game, new_game, play, reactive_state } from '.';\nimport { GameRules, UserPreferences } from './config';\n\ninterface Member {\n  name: string;\n  game: Game | null;\n  winner: boolean;\n}\n\ninterface RemoteState {\n  code: string | null;\n\n  local: Game | null;\n  index: number;\n  members: Member[];\n\n  start_game(rules: GameRules): void;\n}\n\ntype Hook<T> = T extends (...args: infer T) => infer R ? (...args: T) => void : never;\n\nfunction observe<Args extends any[], R, O extends { [k in K]: (...args: Args) => R }, K extends keyof O>(target: O, key: K, hook: Hook<O[K]>) {\n  let original = target[key];\n  target[key] = ((...args) => {\n    let result = original(...args);\n    hook(...args);\n    return result;\n  }) as O[K];\n}\n\nexport function create_room(name: string, user: UserPreferences, code: string | null) {\n  let socket: WebSocket;\n  const base =\n    window.location.host == 'box:8080' || window.location.host == 'localhost:8080'\n      ? 'ws://box:8081/' : 'wss://api.mfro.me/tetris/play';\n\n  const state: RemoteState = shallowReactive({\n    local: null,\n    index: 0,\n    members: [],\n\n    code: code,\n    state: 0,\n\n    start_game(rules: GameRules) {\n      let seed = alea(Math.random()).uint32();\n      send(socket, StartGameRequest, { seed, rules: GameRules.save(rules) });\n    },\n  });\n\n  if (state.code) {\n    socket = new WebSocket(`${base}?name=${name}&code=${state.code}`);\n  } else {\n    socket = new WebSocket(`${base}?name=${name}`);\n  }\n\n  function check_exit() {\n    let playing = state.members.filter((m, i) => m.game && !m.game.state.dead);\n    if (playing.length == 1)\n      playing[0].winner = true;\n    else if (playing.length == 0) {\n      state.local = null;\n      for (let member of state.members) {\n        member.game = null;\n      }\n    }\n  }\n\n  let cleanup: (() => void) | null = null;\n  on(receive(socket, StartGame), (config) => {\n    cleanup?.();\n\n    let rules = GameRules.load(config.rules);\n\n    let s = reactive_state(empty_state(rules, config.seed))\n    state.local = new_game(rules, s);\n\n    for (let i = 0; i < config.players; ++i) {\n      state.members[i].winner = false;\n\n      if (i == state.index) {\n        state.members[i].game = state.local;\n      } else {\n        let s = reactive_state(empty_state(rules, config.seed))\n        state.members[i].game = new_game(rules, s);\n      }\n    }\n\n    observe(state.local, 'hold', () => send(socket, ClientUpdate, { type: 'hold' }));\n    observe(state.local, 'drop', (distance) => send(socket, ClientUpdate, { type: 'drop', distance }));\n    observe(state.local, 'shift', (dir) => send(socket, ClientUpdate, { type: 'shift', dir }));\n    observe(state.local, 'rotate', (dir) => send(socket, ClientUpdate, { type: 'rotate', dir }));\n    observe(state.local, 'lock_down', () => send(socket, ClientUpdate, { type: 'lock_down' }));\n    observe(state.local, 'new_falling', () => send(socket, ClientUpdate, { type: 'new_falling' }));\n    observe(state.local, 'clear_lines', (i) => send(socket, ClientUpdate, { type: 'send_lines', count: garbage(i.length) }));\n    observe(state.local, 'end_game', () => {\n      send(socket, ClientUpdate, { type: 'end_game' });\n      check_exit();\n    });\n\n    cleanup = play(user, state.local);\n  });\n\n  on(receive(socket, BroadcastUpdate), ([index, update]) => {\n    let target = state.members[index].game!;\n    if (target == state.local && update.type != 'send_lines') return;\n\n    switch (update.type) {\n      case 'hold': target.hold(); break;\n      case 'drop': target.drop(update.distance); break;\n      case 'shift': target.shift(update.dir); break;\n      case 'rotate': target.rotate(update.dir); break;\n      case 'lock_down': target.lock_down(); break;\n      case 'new_falling': target.new_falling(); break;\n      case 'end_game': target.end_game(); check_exit(); break;\n\n      case 'send_lines':\n        let next = state.members[(index + 1) % state.members.length].game!;\n        next.add_garbage(update.count);\n        break;\n    }\n  });\n\n  on(receive(socket, RoomCode), code => {\n    if (code != state.code) {\n      const url = new URL(window.location.href);\n      url.searchParams.delete('code');\n      window.history.replaceState(null, document.title, url.pathname + url.search);\n    }\n\n    state.code = code;\n  });\n\n  on(receive(socket, RoomState), ({ index, names }) => {\n    state.members = names.map(name => ({ name, game: null, winner: false }));\n    state.index = index;\n\n    if (state.members.length > 1) {\n      const url = new URL(window.location.href);\n      url.searchParams.set('code', state.code!);\n      window.history.replaceState(null, document.title, url.pathname + url.search);\n    }\n\n    check_exit();\n  });\n\n  return state;\n}\n\nfunction garbage(count: number) {\n  if (count == 4)\n    return 4;\n\n  return count - 1;\n}\n","import { render } from \"./landing.vue?vue&type=template&id=4a21be92\"\nimport script from \"./landing.vue?vue&type=script&lang=js\"\nexport * from \"./landing.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-flex column grow align-center>\n    <v-card class=\"mb-4\">\n      <v-text-field label=\"Code\" v-model=\"code\" />\n\n      <v-text-field label=\"Name\" v-model=\"name\" />\n\n      <v-flex justify-center class=\"my-2\">\n        <v-button text color=\"primary\" :disabled=\"!valid\" @click=\"submit()\">\n          <span>Join lobby</span>\n          <v-icon class=\"ml-3\">arrow_forward</v-icon>\n        </v-button>\n      </v-flex>\n    </v-card>\n  </v-flex>\n</template>\n\n<script>\nimport { computed, inject, shallowRef } from 'vue';\n\nimport { create_room } from '@/tetris/remote';\n\nexport default {\n  name: 'joining',\n\n  emits: ['room'],\n  props: {\n    code: String,\n  },\n\n  setup(props, { emit }) {\n    const name = shallowRef(localStorage.getItem('mfro:user-name') ?? '');\n    const code = shallowRef(props.code);\n\n    const valid = computed(() => {\n      return name.value != '';\n    });\n\n    const user_prefs = inject('user_prefs');\n\n    return {\n      name,\n      code,\n      valid,\n\n      submit() {\n        localStorage.setItem('mfro:user-name', name.value);\n        let room = create_room(name.value, user_prefs, code.value);\n        emit('room', room);\n      },\n    };\n  },\n};\n</script>\n","import { render } from \"./joining.vue?vue&type=template&id=4d8db7c0\"\nimport script from \"./joining.vue?vue&type=script&lang=js\"\nexport * from \"./joining.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./main.vue?vue&type=template&id=3ed78246&scoped=true\"\nimport script from \"./main.vue?vue&type=script&lang=js\"\nexport * from \"./main.vue?vue&type=script&lang=js\"\n\nimport \"./main.vue?vue&type=style&index=0&id=3ed78246&lang=scss\"\nimport \"./main.vue?vue&type=style&index=1&id=3ed78246&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-3ed78246\"\n\nexport default script","import { createApp } from 'vue'\nimport { framework } from '@mfro/vue-ui';\n\nimport root from './main.vue'\n\ncreateApp(root)\n  .use(framework)\n  .mount('#app')\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-rational.vue?vue&type=style&index=0&id=305fcda5&lang=scss&scoped=true\""],"sourceRoot":""}