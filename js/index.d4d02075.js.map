{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ui/config/config-rational.vue?494b","webpack:///./src/ui/config/config-number.vue?6bc1","webpack:///./src/ui/config/config-select.vue?75a9","webpack:///./src/assets/tetrio.png","webpack:///./src/main.vue?ed87","webpack:///./src/ui/config/config-number.vue?165b","webpack:///./src/assets/tetrio-bg.png","webpack:///./src/ui/config/config-boolean.vue?f3b9","webpack:////home/mfro/code/web-apps/chess/vue-next/packages/vue/dist/vue.runtime.esm-bundler.js","webpack:///./src/main.vue","webpack:///./src/ui/edit-config.vue","webpack:///./src/ui/config/config-game-rules.vue","webpack:///./src/tetris/config.ts","webpack:///./src/vec.ts","webpack:///./src/ui/config/config-select.vue","webpack:///./src/ui/config/config-select.vue?a069","webpack:///./src/ui/config/config-number.vue","webpack:///./src/ui/config/config-number.vue?0490","webpack:///./src/ui/config/config-rational.vue","webpack:///./src/ui/config/config-rational.vue?6018","webpack:///./src/ui/config/config-game-rules.vue?c2be","webpack:///./src/ui/config/config-user-prefs.vue","webpack:///./src/ui/config/config-autoshift.vue","webpack:///./src/ui/config/config-autoshift.vue?27b0","webpack:///./src/ui/config/config-render.vue","webpack:///./src/ui/config/config-boolean.vue","webpack:///./src/ui/config/config-boolean.vue?2998","webpack:///./src/ui/config/config-render.vue?d24f","webpack:///./src/ui/config/config-user-prefs.vue?4068","webpack:///./src/ui/edit-config.vue?e7f8","webpack:///./src/input.ts","webpack:///./src/tetris/index.ts","webpack:///./src/tetris/render/basic.ts","webpack:///./src/view/room.vue","webpack:///./src/ui/game.vue","webpack:///./src/tetris/render/pixi.ts","webpack:///./src/ui/game.vue?8e79","webpack:///./src/ui/clipboard.vue","webpack:///./src/ui/clipboard.vue?d909","webpack:///./src/view/room.vue?0b9e","webpack:///./src/view/landing.vue","webpack:///./src/tetris/remote.ts","webpack:///./src/view/landing.vue?e6b8","webpack:///./src/view/joining.vue","webpack:///./src/view/joining.vue?9e35","webpack:///./src/main.vue?6697","webpack:///./src/main.ts","webpack:///./src/ui/config/config-boolean.vue?7a83","webpack:///./src/main.vue?5a8d"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","align-center","class","model-value","editing_user","kind","user_prefs","current_room","room","joining_code","code","$event","style","title","icon","small","$emit","actions","color","save","description","gravity","filter","v","lock_delay","move_reset_limit","bag_preview","wall_kicks","options","wallKickOptions","Vec","x","y","this","Math","sqrt","atan2","a","polar","dir","scalar","b","dot","abs","acos","len","cos","sin","constant","type","optional","inner","natural","rational","zero","tetronimos","define","size","raw_tiles","rotation","map","rotations","I","O","T","J","L","S","Z","GARBAGE","all","define_kick_data","raw","no_kick_data","base_kick_data","base_i_kick_data","asira_i_kick_data","standard","Map","asira","none","GameRules","rules","field_size","fall_delay","indexOf","load","src","delay","initial_delay","right","text","label","$refs","select","click","id","ref","option","emits","props","String","modelValue","Array","setup","emit","findIndex","pair","set","render","__scopeId","state","editing","onInput","warning","error","Number","Function","toString","immediate","num","parseFloat","cssModules","__cssModules","top","focus","setTop","target","column","justify-center","bot","setBot","parseInt","components","configSelect","configNumber","configRational","autoshift","soft_drop","styleOptions","smooth","border","ghost_opacity","ghost_color","Boolean","configAutoshift","configBoolean","configRender","configGameRules","configUserPrefs","SPACE","LEFT","UP","SHIFT","DOWN","RIGHT","A","X","C","R","Set","press","release","isKeyDown","k","has","onKeyDown","handler","event","onKeyUp","addEventListener","e","keyCode","add","preventDefault","delete","TileStyle","down","pieces","position","empty_row","row","empty_field","field","empty_state","seed","random","uint32","falling","fall_queue","holding","hold_available","garbage_ready","garbage_pending","dead","reactive_state","track","trigger","new_game","self","next_id","collide","part","tile","hard_drop_position","bottom","hold","next_fall","unshift","drop","distance","rotate","kicks","kick_info","assert","kick","lock_down","indices","every","clear_lines","count","floor","assign","index","new_falling","pool","ceil","end_game","apply_garbage","play_local","user","game","move_reset","lock_progress","fall_progress","repeating","shift_left","shift_right","repeat_shift","repeat_delay","Infinity","is_on_ground","try_move_reset","change","hard_drop","press_shift","release_shift","cleanup","garbage_time","cancel","setInterval","update","min","move","clearInterval","fn","make_renderer","config","default_background","context","origin","scale","draw_ui","center","topleft","botrite","lineCap","lineJoin","strokeStyle","beginPath","thickness","pixel","lineWidth","moveTo","lineTo","stroke","translate","fillStyle","fillRect","restore","tile_size","smoothing","render_tile","around","colors","ghost","disabled","render_background","globalAlpha","sprites","Image","background","order","p1","Promise","resolve","onload","p2","drawImage","globalCompositeOperation","strokeRect","Error","render_tilesheets","renderer","styles","normal","canvas","document","createElement","IMAGE_STRIDE","width","height","offset_fn","lookup","bytes","TextEncoder","encode","JSON","stringify","crypto","subtle","digest","hash_raw","hash","from","Uint8Array","padStart","join","localStorage","getItem","cache","parse","images","console","log","getContext","kinds","clearRect","offset","url","toDataURL","setItem","game_rules","grow","local","before","after","others","member","align-start","link","members","winner","start","padding","prerender_background","tile_at","isHold","SpritePool","list","clear","parts","minX","reduce","minY","maxX","max","maxY","draw_tetronimo","base","textures","sprite","texture","pos","unit_size","marginBottom","SCALE_MODE","NEAREST","container","removeChild","addChild","offsets","adj","eq","draw_tile","app","view","transparent","tilesheets","forEach","sheet","loader","onLoad","once","resources","baseTexture","root","queue","garbage","stage","garbage_pool","destroy","prevCanvas","prevGame","prevPrefs","reset","then","copy","copied","bold","solo","input","execCommand","clipboard","editConfig","location","pathname","start_game","local_game","valid","create_room","observe","hook","original","URL","socket","searchParams","WebSocket","check_exit","playing","players","next","href","history","replaceState","search","names","local_cleanup","edit","submit","landing","joining","Reflect","catch","use","mount"],"mappings":"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","file":"js/index.d4d02075.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"index\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-rational.vue?vue&type=style&index=0&id=0ea7d42c&lang=scss&scoped=true\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"config-number_root_1JO2c\"};","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-select.vue?vue&type=style&index=0&id=632a7c32&lang=scss&scoped=true\"","module.exports = __webpack_public_path__ + \"img/tetrio.f8eaf703.png\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./main.vue?vue&type=style&index=1&id=45e58851&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-0-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-0-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-0-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-number.vue?vue&type=style&index=0&id=316ba812&lang=scss&module=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-0-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-0-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-0-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-number.vue?vue&type=style&index=0&id=316ba812&lang=scss&module=true\"","module.exports = __webpack_public_path__ + \"img/tetrio-bg.bfe283a4.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"config-boolean_root_3o7bx\"};","import { setDevtoolsHook, initCustomFormatter, warn } from '@vue/runtime-dom';\nexport * from '@vue/runtime-dom';\nimport { getGlobalThis } from '@vue/shared';\n\nfunction initDev() {\r\n    const target = getGlobalThis();\r\n    target.__VUE__ = true;\r\n    setDevtoolsHook(target.__VUE_DEVTOOLS_GLOBAL_HOOK__);\r\n    {\r\n        initCustomFormatter();\r\n    }\r\n}\n\n// This entry exports the runtime only, and is built as\r\nif ((process.env.NODE_ENV !== 'production') || __VUE_PROD_DEVTOOLS__) {\r\n    initDev();\r\n}\r\nconst compile = () => {\r\n    if ((process.env.NODE_ENV !== 'production')) {\r\n        warn(`Runtime compilation is not supported in this build of Vue.` +\r\n            ( ` Configure your bundler to alias \"vue\" to \"vue/dist/vue.esm-bundler.js\".`\r\n                ) /* should not happen */);\r\n    }\r\n};\n\nexport { compile };\n","<template>\n  <v-app align-center class=\"pb-6 root\">\n    <v-dialog :model-value=\"editing_user\">\n      <edit-config\n        kind=\"user\"\n        v-model=\"user_prefs\"\n        @close=\"editing_user = false\"\n      />\n    </v-dialog>\n\n    <v-flex class=\"user pa-4\">\n      <v-button @click=\"editing_user = true\">\n        <v-icon class=\"mr-3\">settings</v-icon>\n        <span>User preferences</span>\n      </v-button>\n    </v-flex>\n\n    <room v-if=\"current_room != null\" :room=\"current_room\" />\n\n    <joining\n      v-else-if=\"joining_code != null\"\n      :code=\"joining_code\"\n      @room=\"current_room = $event\"\n    />\n\n    <landing v-else @room=\"current_room = $event\" />\n  </v-app>\n</template>\n\n<script>\nimport { computed, provide, shallowRef, watchEffect } from 'vue';\n\nimport editConfig from '@/ui/edit-config';\nimport { make_renderer } from '@/tetris/render/basic';\n\nimport room from './view/room';\nimport landing from './view/landing';\nimport joining from './view/joining';\n\nexport default {\n  name: 'tetris',\n\n  components: {\n    editConfig,\n\n    room,\n    landing,\n    joining,\n  },\n\n  setup() {\n    const current_room = shallowRef(null);\n    const url = new URL(window.location.href);\n    const code = url.searchParams.get('code');\n    const joining_code = shallowRef(code);\n\n    const raw = localStorage.getItem('mfro:tetris-user-preferences');\n\n    const editing_user = shallowRef(false);\n    const user_prefs = shallowRef(raw ? JSON.parse(raw) : {});\n\n    if (!Reflect.has(user_prefs.value, 'autoshift'))\n      user_prefs.value.autoshift = { delay: 2, initial_delay: 10 };\n\n    if (!Reflect.has(user_prefs.value, 'soft_drop'))\n      user_prefs.value.soft_drop = 10;\n\n    if (!Reflect.has(user_prefs.value, 'render'))\n      user_prefs.value.render = { size: 24, smooth: false, style: 'pixel', border: 3, ghost_opacity: 0.4 };\n\n    provide('user_prefs', user_prefs);\n\n    watchEffect(() => {\n      make_renderer(user_prefs.value.render).catch(e => {\n        user_prefs.value = {\n          ...user_prefs.value,\n          render: { size: 24, smooth: false, style: 'pixel', border: 3, ghost_opacity: 0.4 },\n        };\n\n        localStorage.setItem('mfro:tetris-user-preferences', JSON.stringify(user_prefs.value));\n      })\n    });\n\n    return {\n      current_room,\n      joining_code,\n      editing_user,\n\n      user_prefs: computed({\n        get: () => user_prefs.value,\n        set: (v) => {\n          user_prefs.value = v;\n          localStorage.setItem('mfro:tetris-user-preferences', JSON.stringify(v));\n        },\n      }),\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\">\n#app {\n  width: 100vw;\n  height: 100vh;\n}\n</style>\n\n<style lang=\"scss\" scoped>\n.user {\n  position: absolute;\n  left: 0;\n  bottom: 0;\n}\n\n.root {\n  // background-color: #020202 !important;\n}\n</style>\n","<template>\n  <v-card style=\"min-width: 60ch\">\n    <template v-slot:title>\n      <v-text title v-if=\"kind == 'game'\">Game rules</v-text>\n      <v-text title v-if=\"kind == 'user'\">User preferences</v-text>\n\n      <v-grow />\n\n      <v-button icon small @click=\"$emit('close')\">\n        <v-icon>close</v-icon>\n      </v-button>\n    </template>\n\n    <config-game-rules v-if=\"kind == 'game'\" v-model=\"value\" />\n    <config-user-prefs v-if=\"kind == 'user'\" v-model=\"value\" />\n\n    <template v-slot:actions>\n      <v-grow />\n\n      <v-button color=\"primary\" @click=\"save()\">\n        <span>Save</span>\n      </v-button>\n    </template>\n  </v-card>\n</template>\n\n<script>\nimport { shallowRef, watch } from 'vue';\nimport configGameRules from './config/config-game-rules';\nimport configUserPrefs from './config/config-user-prefs';\n\nexport default {\n  name: 'edit-config',\n  components: {\n    configGameRules,\n    configUserPrefs,\n  },\n\n  emits: ['close', 'update:modelValue'],\n  props: {\n    kind: String,\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    const value = shallowRef(props.modelValue);\n\n    watch(() => props.modelValue, v => value.value = v);\n\n    return {\n      value,\n\n      save() {\n        emit('update:modelValue', value.value);\n        emit('close');\n      },\n    }\n  },\n};\n</script>\n","<template>\n  <config-rational\n    name=\"Gravity\"\n    description=\"Gravity for falling pieces (tiles per frame)\"\n    v-model=\"gravity\"\n    :filter=\"(v) => v <= 20\"\n  />\n\n  <config-number\n    name=\"Lock delay\"\n    description=\"Delay after touching the ground before a piece locks down (frames)\"\n    v-model=\"lock_delay\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-number\n    name=\"Move reset limit\"\n    description=\"Maximum number of times the lock delay can be reset by successful shifts or rotates\"\n    v-model=\"move_reset_limit\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-number\n    name=\"Preview size\"\n    description=\"Number of pieces in the preview\"\n    v-model=\"bag_preview\"\n    :filter=\"(v) => v >= 0 && v <= 6\"\n  />\n\n  <config-select\n    name=\"Wall kick style\"\n    description=\"Wall kick configuration to use for rotations\"\n    v-model=\"wall_kicks\"\n    :options=\"wallKickOptions\"\n  />\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport { wall_kicks } from '@/tetris/config';\n\nimport configSelect from './config-select';\nimport configNumber from './config-number';\nimport configRational from './config-rational';\n\nconst wallKickOptions = [\n  ['No Kicks', wall_kicks.none],\n  ['Standard', wall_kicks.standard],\n  ['Asira', wall_kicks.asira],\n];\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-game-rules',\n  components: {\n    configSelect,\n    configNumber,\n    configRational,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let gravity = field(emit, () => props.modelValue, 'fall_delay', v => 1 / v, v => 1 / v);\n    let lock_delay = field(emit, () => props.modelValue, 'lock_delay');\n    let move_reset_limit = field(emit, () => props.modelValue, 'move_reset_limit');\n    let bag_preview = field(emit, () => props.modelValue, 'bag_preview');\n    let wall_kicks = field(emit, () => props.modelValue, 'wall_kicks');\n\n    return {\n      gravity,\n      lock_delay,\n      move_reset_limit,\n      bag_preview,\n      wall_kicks,\n      wallKickOptions,\n    };\n  },\n};\n</script>\n","import { Vec } from '@/vec';\n\nimport { TetronimoKind, Tile, Tetronimo } from '.';\n\nexport namespace tetronimos {\n  function define(size: number, raw_tiles: [number, number][]): TetronimoKind {\n    let rotation = raw_tiles.map(t => new Vec(t[0], t[1]));\n    let rotations = [rotation];\n\n    for (let i = 0; i < 3; ++i) {\n      rotation = rotation.map(v => new Vec(size - 1 - v.y, v.x));\n      rotations.push(rotation);\n    }\n\n    return {\n      size,\n      rotations,\n    };\n  }\n\n  export const I = define(4, [[0, 1], [1, 1], [2, 1], [3, 1]]);\n  export const O = define(2, [[0, 0], [0, 1], [1, 0], [1, 1]]);\n  export const T = define(3, [[1, 0], [0, 1], [1, 1], [2, 1]]);\n  export const J = define(3, [[0, 0], [0, 1], [1, 1], [2, 1]]);\n  export const L = define(3, [[2, 0], [0, 1], [1, 1], [2, 1]]);\n  export const S = define(3, [[1, 0], [2, 0], [0, 1], [1, 1]]);\n  export const Z = define(3, [[0, 0], [1, 0], [1, 1], [2, 1]]);\n  export const GARBAGE = define(0, []);\n\n  export const all = [I, O, T, J, L, S, Z];\n}\n\nexport namespace wall_kicks {\n  function define_kick_data(raw: [number, number][][]) {\n    return raw.map(a => [Vec.zero, ...a.map(a => new Vec(a[0], -a[1]))]);\n  }\n\n  const no_kick_data = define_kick_data([\n    [[0, 0]], // 0 -> 1\n    [[0, 0]], // 1 -> 0\n    [[0, 0]], // 1 -> 2\n    [[0, 0]], // 2 -> 1\n    [[0, 0]], // 2 -> 3\n    [[0, 0]], // 3 -> 2\n    [[0, 0]], // 3 -> 0\n    [[0, 0]], // 0 -> 3\n  ]);\n\n  const base_kick_data = define_kick_data([\n    [[0, 0], [-1, 0], [-1, +1], [0, -2], [-1, -2]], // 0 -> 1\n    [[0, 0], [+1, 0], [+1, -1], [0, +2], [+1, +2]], // 1 -> 0\n    [[0, 0], [+1, 0], [+1, -1], [0, +2], [+1, +2]], // 1 -> 2\n    [[0, 0], [-1, 0], [-1, +1], [0, -2], [-1, -2]], // 2 -> 1\n    [[0, 0], [+1, 0], [+1, +1], [0, -2], [+1, -2]], // 2 -> 3\n    [[0, 0], [-1, 0], [-1, -1], [0, +2], [-1, +2]], // 3 -> 2\n    [[0, 0], [-1, 0], [-1, -1], [0, +2], [-1, +2]], // 3 -> 0\n    [[0, 0], [+1, 0], [+1, +1], [0, -2], [+1, -2]], // 0 -> 3\n  ]);\n\n  const base_i_kick_data = define_kick_data([\n    [[0, 0], [-2, 0], [+1, 0], [-2, -1], [+1, +2]], // 0 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 1 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 1 -> 2\n    [[0, 0], [+1, 0], [-2, 0], [+1, -2], [-2, +1]], // 2 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 2 -> 3\n    [[0, 0], [-2, 0], [+1, 0], [-2, -1], [+1, +2]], // 3 -> 2\n    [[0, 0], [+1, 0], [-2, 0], [+1, -2], [-2, +1]], // 3 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 0 -> 3\n  ]);\n\n  const asira_i_kick_data = define_kick_data([\n    [[0, 0], [-2, 0], [+1, 0], [+1, +2], [-2, -1]], // 0 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 1 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 1 -> 2\n    [[0, 0], [-2, 0], [+1, 0], [-2, +1], [+1, -1]], // 2 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -1]], // 2 -> 3\n    [[0, 0], [+1, 0], [-2, 0], [+1, +2], [-2, -1]], // 3 -> 2\n    [[0, 0], [-2, 0], [+1, 0], [-2, +1], [+1, -2]], // 3 -> 0\n    [[0, 0], [+2, 0], [-1, 0], [-1, +2], [+2, -1]], // 0 -> 3\n  ]);\n\n  export const standard = new Map([\n    [tetronimos.I, base_i_kick_data],\n    [tetronimos.O, base_kick_data],\n    [tetronimos.T, base_kick_data],\n    [tetronimos.J, base_kick_data],\n    [tetronimos.L, base_kick_data],\n    [tetronimos.S, base_kick_data],\n    [tetronimos.Z, base_kick_data],\n  ]);\n\n  export const asira = new Map([\n    [tetronimos.I, asira_i_kick_data],\n    [tetronimos.O, base_kick_data],\n    [tetronimos.T, base_kick_data],\n    [tetronimos.J, base_kick_data],\n    [tetronimos.L, base_kick_data],\n    [tetronimos.S, base_kick_data],\n    [tetronimos.Z, base_kick_data],\n  ]);\n\n  export const none = new Map([\n    [tetronimos.I, no_kick_data],\n    [tetronimos.O, no_kick_data],\n    [tetronimos.T, no_kick_data],\n    [tetronimos.J, no_kick_data],\n    [tetronimos.L, no_kick_data],\n    [tetronimos.S, no_kick_data],\n    [tetronimos.Z, no_kick_data],\n  ]);\n\n  export const all = [none, standard, asira];\n}\n\nexport interface GameRules {\n  // size of the visible playfield\n  field_size: Vec;\n\n  // updates between the falling piece moving down\n  fall_delay: number;\n  // delay before the falling pieces locks into place\n  lock_delay: number;\n  // limit on how many times rotating or shifting the piece can reset the lock delay. null indicates no limit\n  move_reset_limit: null | number;\n\n  // wall kick data\n  wall_kicks: Map<TetronimoKind, Vec[][]>;\n\n  // number of Tetronimos to pre-generate in the queue\n  bag_preview: 5,\n}\n\nexport namespace GameRules {\n  export function save(rules: GameRules): any {\n    return {\n      field_size: [rules.field_size.x, rules.field_size.y],\n      fall_delay: rules.fall_delay,\n      lock_delay: rules.lock_delay,\n      move_reset_limit: rules.move_reset_limit,\n      wall_kicks: wall_kicks.all.indexOf(rules.wall_kicks),\n      bag_preview: rules.bag_preview,\n    };\n  }\n\n  export function load(src: any): GameRules {\n    return {\n      field_size: new Vec(src.field_size[0], src.field_size[1]),\n      fall_delay: src.fall_delay,\n      lock_delay: src.lock_delay,\n      move_reset_limit: src.move_reset_limit,\n      wall_kicks: wall_kicks.all[src.wall_kicks],\n      bag_preview: src.bag_preview,\n    };\n  }\n}\n\nexport interface UserPreferences {\n  // autoshift information for repeating shifts while input is held\n  autoshift: null | { delay: number, initial_delay: number };\n  // multiplier for fall_delay while soft drop is held\n  soft_drop: number;\n}\n\nexport type Option =\n  | { type: 'constant', value: any }\n  | { type: 'optional', inner: Option }\n  | { name: string, description: string } & (\n    | { type: 'natural' }\n    | { type: 'rational' }\n    | { type: 'select', options: [string, any][] }\n    | { type: 'object', inner: Definition<any> }\n  );\n\nfunction constant(value: any): Option {\n  return { type: 'constant', value };\n}\n\nfunction optional(inner: Option): Option {\n  return { type: 'optional', inner };\n}\n\nfunction natural(name: string, description: string): Option {\n  return { type: 'natural', name, description };\n}\n\nfunction rational(name: string, description: string): Option {\n  return { type: 'rational', name, description };\n}\n\nfunction select(name: string, description: string, options: [string, any][]): Option {\n  return { type: 'select', name, description, options };\n}\n\nfunction object<T>(name: string, description: string, inner: Definition<T>): Option {\n  return { type: 'object', name, description, inner };\n}\n\ntype Definition<T> = {\n  [K in keyof T]: Option;\n}\n\nexport const GameDefinition: Definition<GameRules> = {\n  field_size: constant(new Vec(10, 40)),\n\n  fall_delay: rational('Drop Delay', 'Drop delay for falling pieces (frames per tile)'),\n\n  lock_delay: rational('Lock Delay', 'Lock down delay (frames)'),\n\n  move_reset_limit: optional(rational('Move Reset Limit', 'Maximum number of times the Lock Delay can be reset by successful shifts or rotates')),\n\n  wall_kicks: select('Wall Kicks', 'Wall kick data', [\n    ['No Kicks', wall_kicks.none],\n    ['Standard', wall_kicks.standard],\n    ['Asira', wall_kicks.asira],\n  ]),\n\n  bag_preview: natural('Preview Size', 'Number of pieces in the preview'),\n};\n\nexport const UserDefinition: Definition<UserPreferences> = {\n  autoshift: optional(object('Autoshift', 'Configure repeated shifts while input is held', {\n    delay: rational('Delay', 'Delay between repeated shifts (frames)'),\n    initial_delay: rational('Initial Delay', 'Delay after first shift before repeating (frames)'),\n  })),\n\n  soft_drop: rational('Soft Drop Multiplier', 'Multiplier for Drop Delay while soft dropping'),\n}\n","export class Vec {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n    get len() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n    get dir() {\n        return Math.atan2(this.y, this.x);\n    }\n    static norm(a) {\n        return Vec.polar(1, a.dir);\n    }\n    static scale(a, scalar) {\n        return new Vec(a.x * scalar, a.y * scalar);\n    }\n    static add(a, b) {\n        return new Vec(a.x + b.x, a.y + b.y);\n    }\n    static dot(a, b) {\n        return a.x * b.x + a.y * b.y;\n    }\n    static eq(a, b) {\n        return a.x == b.x && a.y == b.y;\n    }\n    static delta(a, b) {\n        let dot = Vec.dot(a, b);\n        let abs = Math.acos(dot / a.len / b.len);\n        if (a.y * b.x > a.x * b.y)\n            return -abs;\n        return abs;\n    }\n    static polar(len, dir) {\n        return new Vec(Math.cos(dir) * len, Math.sin(dir) * len);\n    }\n}\nVec.zero = new Vec(0, 0);\n","<template>\n  <v-tooltip right :text=\"description\">\n    <v-input :label=\"name\" @click=\"$refs.select.click()\">\n      <template v-slot=\"{ id }\">\n        <select :id=\"id\" v-model=\"value\" ref=\"select\">\n          <option v-for=\"(option, i) in options\" :key=\"option[0]\" :value=\"i\">\n            {{ option[0] }}\n          </option>\n        </select>\n      </template>\n    </v-input>\n  </v-tooltip>\n\n  <!-- <config-value :name=\"name\" :description=\"description\">\n    <v-select\n      small\n      v-model=\"value\"\n      :options=\"options\"\n      :text=\"(o) => o[0]\"\n      :value=\"(o) => o[1]\"\n    />\n  </config-value> -->\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nexport default {\n  name: 'config-select',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: {},\n    options: Array,\n  },\n\n  setup(props, { emit }) {\n    let value = computed({\n      get: () => props.options.findIndex(pair => pair[1] == props.modelValue),\n      set: (v) => {\n        emit('update:modelValue', props.options[v][1]);\n      },\n    });\n\n    return { value };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\nselect {\n  outline: none;\n  width: calc(100% + 32px);\n  margin: -30px -16px -8px -16px;\n  padding: 30px 16px 7px;\n}\n</style>\n","import { render } from \"./config-select.vue?vue&type=template&id=632a7c32&scoped=true\"\nimport script from \"./config-select.vue?vue&type=script&lang=js\"\nexport * from \"./config-select.vue?vue&type=script&lang=js\"\n\nimport \"./config-select.vue?vue&type=style&index=0&id=632a7c32&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-632a7c32\"\n\nexport default script","<template>\n  <v-tooltip right :text=\"description\">\n    <v-text-field\n      :label=\"name\"\n      :model-value=\"state.editing\"\n      @update:model-value=\"onInput\"\n      :warning=\"state.error\"\n    />\n  </v-tooltip>\n</template>\n\n<script>\nimport { nextTick, shallowReactive, watch } from 'vue';\n\nexport default {\n  name: 'config-number',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: Number,\n    filter: Function,\n  },\n\n  setup(props, { emit }) {\n    let state = shallowReactive({\n      editing: null,\n      error: false,\n    });\n\n    watch(() => props.modelValue, () => {\n      state.editing = props.modelValue.toString();\n    }, { immediate: true });\n\n    return {\n      state,\n\n      onInput(v) {\n        state.editing = v;\n\n        let num = parseFloat(v);\n\n        if (num.toString() != v || props.filter && !props.filter(num)) {\n          state.error = true;\n        } else {\n          state.error = false;\n          nextTick(() => emit('update:modelValue', num));\n        }\n      },\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" module>\ndiv.root :global(input) {\n  width: 10ch;\n}\n</style>\n","import { render } from \"./config-number.vue?vue&type=template&id=316ba812\"\nimport script from \"./config-number.vue?vue&type=script&lang=js\"\nexport * from \"./config-number.vue?vue&type=script&lang=js\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./config-number.vue?vue&type=style&index=0&id=316ba812&lang=scss&module=true\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","<template>\n  <v-tooltip right :text=\"description\">\n    <v-input\n      :label=\"name\"\n      style=\"cursor: text\"\n      @click=\"$refs.top.focus()\"\n      :warning=\"state.error\"\n    >\n      <template v-slot=\"{ id }\">\n        <v-flex>\n          <input\n            ref=\"top\"\n            :id=\"id\"\n            :style=\"{ width: `3ch` }\"\n            :value=\"state.top\"\n            @input=\"setTop($event.target.value)\"\n          />\n\n          <v-flex class=\"mx-2\" column justify-center>\n            <v-text>/</v-text>\n          </v-flex>\n\n          <input\n            @click.stop\n            :value=\"state.bot\"\n            @input=\"setBot($event.target.value)\"\n          />\n        </v-flex>\n      </template>\n    </v-input>\n  </v-tooltip>\n</template>\n\n<script>\nimport { shallowReactive, watch } from 'vue';\n\nexport default {\n  name: 'config-rational',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: Number,\n    filter: Function,\n  },\n\n  setup(props, { emit }) {\n    let state = shallowReactive({\n      top: null,\n      bot: null,\n      error: false,\n    });\n\n    watch(() => props.modelValue, () => {\n      if (props.modelValue > 1) {\n        state.top = props.modelValue.toString();\n        state.bot = '1';\n      } else {\n        state.top = '1';\n        state.bot = 1 / props.modelValue.toString();\n      }\n    }, { immediate: true });\n\n    return {\n      state,\n\n      setTop(v) {\n        state.top = v;\n        state.bot = '1';\n\n        let num = parseInt(v, 10);\n        if (num.toString() != v || props.filter && !props.filter(num)) {\n          state.error = true;\n        } else {\n          state.error = false;\n          emit('update:modelValue', num);\n        }\n      },\n\n      setBot(v) {\n        state.top = '1';\n        state.bot = v;\n\n        let num = 1 / parseInt(v, 10);\n        if ((1 / num).toString() != v || props.filter && !props.filter(num)) {\n          state.error = true;\n        } else {\n          state.error = false;\n          emit('update:modelValue', num);\n        }\n      },\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"@mfro/vue-ui/src/style.scss\";\n\ninput {\n  color: inherit;\n  font-size: $text-unit;\n  outline: none;\n\n  font-family: Roboto;\n  font-weight: normal;\n}\n</style>\n","import { render } from \"./config-rational.vue?vue&type=template&id=0ea7d42c&scoped=true\"\nimport script from \"./config-rational.vue?vue&type=script&lang=js\"\nexport * from \"./config-rational.vue?vue&type=script&lang=js\"\n\nimport \"./config-rational.vue?vue&type=style&index=0&id=0ea7d42c&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-0ea7d42c\"\n\nexport default script","import { render } from \"./config-game-rules.vue?vue&type=template&id=6fe6caeb\"\nimport script from \"./config-game-rules.vue?vue&type=script&lang=js\"\nexport * from \"./config-game-rules.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <config-autoshift v-model=\"autoshift\" />\n\n  <config-number\n    name=\"Soft drop multiplier\"\n    description=\"Gravity multiplier when soft dropping\"\n    v-model=\"soft_drop\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-render v-model=\"render\" />\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport configAutoshift from './config-autoshift';\nimport configNumber from './config-number';\nimport configRender from './config-render';\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-game-rules',\n  components: {\n    configAutoshift,\n    configNumber,\n    configRender,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let autoshift = field(emit, () => props.modelValue, 'autoshift');\n    let soft_drop = field(emit, () => props.modelValue, 'soft_drop');\n    let render = field(emit, () => props.modelValue, 'render');\n\n    return {\n      autoshift,\n      soft_drop,\n      render,\n    };\n  },\n};\n</script>\n","<template>\n  <config-number\n    name=\"Autoshift delay\"\n    description=\"Delay between repeated shifts while input is held (ARR)\"\n    v-model=\"delay\"\n    :filter=\"(v) => v >= 0\"\n  />\n\n  <config-number\n    name=\"Autoshift initial delay\"\n    description=\"Delay after the initial shift when pressing an input before repeating (DAS)\"\n    v-model=\"initial_delay\"\n    :filter=\"(v) => v >= 0\"\n  />\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport configNumber from './config-number';\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-autoshift',\n  components: {\n    configNumber,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let delay = field(emit, () => props.modelValue, 'delay');\n    let initial_delay = field(emit, () => props.modelValue, 'initial_delay');\n\n    return {\n      delay,\n      initial_delay,\n    };\n  },\n};\n</script>\n","import { render } from \"./config-autoshift.vue?vue&type=template&id=1b70b3ed\"\nimport script from \"./config-autoshift.vue?vue&type=script&lang=js\"\nexport * from \"./config-autoshift.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <config-select\n    name=\"Render Style\"\n    description=\"Wall kick configuration to use for rotations\"\n    v-model=\"style\"\n    :options=\"styleOptions\"\n  />\n\n  <template v-if=\"style == 'toon'\">\n    <config-number\n      name=\"Tile size\"\n      description=\"Size in pixels of each square on the field\"\n      v-model=\"size\"\n      :filter=\"(v) => v > 0\"\n    />\n\n    <config-boolean\n      name=\"Smooth rendering\"\n      description=\"Join tiles of the same tetronimo\"\n      v-model=\"smooth\"\n    />\n\n    <config-number\n      name=\"Border width\"\n      description=\"Size of the tile border\"\n      v-model=\"border\"\n      :filter=\"(v) => v >= 0 && v <= size / 2\"\n    />\n  </template>\n\n  <template v-if=\"style == 'pixel'\">\n    <config-number\n      name=\"Tile size\"\n      description=\"Size in pixels of each square on the field\"\n      v-model=\"size\"\n      :filter=\"(v) => v > 0\"\n    />\n\n    <config-boolean\n      name=\"Smooth rendering\"\n      description=\"Join tiles of the same tetronimo\"\n      v-model=\"smooth\"\n    />\n\n    <config-number\n      name=\"Border width\"\n      description=\"Size of the tile border\"\n      v-model=\"border\"\n      :filter=\"(v) => v >= 0 && v <= size / 2\"\n    />\n\n    <config-number\n      name=\"Ghost opacity\"\n      description=\"Opacity of the ghost preview\"\n      v-model=\"ghost_opacity\"\n      :filter=\"(v) => v >= 0 && v <= 1\"\n    />\n  </template>\n\n  <template v-if=\"style == 'tetrio'\">\n    <config-boolean\n      name=\"Ghost color\"\n      description=\"Color the ghost tile\"\n      v-model=\"ghost_color\"\n    />\n  </template>\n</template>\n\n<script>\nimport { computed } from 'vue';\n\nimport configAutoshift from './config-autoshift';\nimport configBoolean from './config-boolean';\nimport configNumber from './config-number';\nimport configSelect from './config-select';\n\nconst styleOptions = [\n  ['toon', 'toon'],\n  ['pixel', 'pixel'],\n  ['tetr.io', 'tetrio'],\n];\n\nfunction field(emit, target, key, get = v => v, set = v => v) {\n  return computed({\n    get: () => get(target()[key]),\n    set: (value) => {\n      let rules = { ...target(), [key]: set(value) };\n      emit('update:modelValue', rules);\n    },\n  });\n}\n\nexport default {\n  name: 'config-render',\n  components: {\n    configAutoshift,\n    configBoolean,\n    configNumber,\n    configSelect,\n  },\n\n  emits: ['update:modelValue'],\n  props: {\n    modelValue: Object,\n  },\n\n  setup(props, { emit }) {\n    let size = field(emit, () => props.modelValue, 'size');\n    let smooth = field(emit, () => props.modelValue, 'smooth');\n    let style = field(emit, () => props.modelValue, 'style');\n    let border = field(emit, () => props.modelValue, 'border');\n    let ghost_opacity = field(emit, () => props.modelValue, 'ghost_opacity');\n    let ghost_color = field(emit, () => props.modelValue, 'ghost_color');\n\n    return {\n      size,\n      smooth,\n      style,\n      border,\n      ghost_opacity,\n      ghost_color,\n      styleOptions,\n    };\n  },\n};\n</script>\n","<template>\n  <v-tooltip right :text=\"description\">\n    <v-input :label=\"name\" @click=\"value = !value\">\n      <template v-slot=\"{ id }\">\n        <v-checkbox :id=\"id\" v-model=\"value\" @click.stop />\n      </template>\n    </v-input>\n    <!-- <\n    <v-checkbox>\n\n    </v-checkbox>\n    <v-text-field\n      :label=\"name\"\n      :model-value=\"state.editing\"\n      @update:model-value=\"onInput\"\n      :warning=\"state.error\"\n    /> -->\n  </v-tooltip>\n</template>\n\n<script>\nimport { computed, nextTick, shallowReactive, watch } from 'vue';\n\nexport default {\n  name: 'config-boolean',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: Boolean,\n  },\n\n  setup(props, { emit }) {\n    const value = computed({\n      get: () => props.modelValue,\n      set: (v) => emit('update:modelValue', v),\n    });\n\n    return {\n      value,\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" module>\ndiv.root :global(input) {\n  width: 10ch;\n}\n</style>\n","import { render } from \"./config-boolean.vue?vue&type=template&id=a2427b56\"\nimport script from \"./config-boolean.vue?vue&type=script&lang=js\"\nexport * from \"./config-boolean.vue?vue&type=script&lang=js\"\n\nconst cssModules = script.__cssModules = {}\nimport style0 from \"./config-boolean.vue?vue&type=style&index=0&id=a2427b56&lang=scss&module=true\"\ncssModules[\"$style\"] = style0\nscript.render = render\n\nexport default script","import { render } from \"./config-render.vue?vue&type=template&id=6de531dc\"\nimport script from \"./config-render.vue?vue&type=script&lang=js\"\nexport * from \"./config-render.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./config-user-prefs.vue?vue&type=template&id=f84b3c0c\"\nimport script from \"./config-user-prefs.vue?vue&type=script&lang=js\"\nexport * from \"./config-user-prefs.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./edit-config.vue?vue&type=template&id=54576fb1\"\nimport script from \"./edit-config.vue?vue&type=script&lang=js\"\nexport * from \"./edit-config.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { emit, Event, off, on } from \"@mfro/ts-common/events\";\n\nexport const\n  SPACE = 32,\n  ENTER = 13,\n  LEFT = 37,\n  UP = 38,\n  SHIFT = 16,\n  DOWN = 40,\n  RIGHT = 39,\n  A = 65,\n  Z = 90,\n  S = 83,\n  X = 88,\n  C = 67,\n  R = 82;\n\nlet holding = new Set<number>();\n\nlet press = new Map<number, Event>();\nlet release = new Map<number, Event>();\n\nwindow.addEventListener('keydown', e => {\n  if (holding.has(e.keyCode))\n    return;\n\n  // console.log(e.keyCode);\n  holding.add(e.keyCode);\n\n  let event = press.get(e.keyCode);\n  if (event) {\n    emit(event);\n    e.preventDefault();\n  }\n});\n\nwindow.addEventListener('keyup', e => {\n  holding.delete(e.keyCode);\n\n  let event = release.get(e.keyCode);\n  if (event) {\n    emit(event);\n    e.preventDefault();\n  }\n});\n\nexport function isKeyDown(k: number) {\n  return holding.has(k);\n}\n\nexport function onKeyDown(key: number, handler: () => void) {\n  let event = press.get(key);\n  if (!event) press.set(key, event = Event());\n\n  on(event, handler);\n  return () => off(event!, handler);\n}\n\nexport function onKeyUp(key: number, handler: () => void) {\n  let event = release.get(key);\n  if (!event) release.set(key, event = Event());\n\n  on(event, handler);\n  return () => off(event!, handler);\n}\n","import alea from 'alea';\nimport { customRef, reactive, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { assert } from '@mfro/ts-common/assert';\nimport { A, C, DOWN, isKeyDown, LEFT, onKeyDown, onKeyUp, RIGHT, S, SHIFT, SPACE, UP, X, Z } from '@/input';\n\nimport { GameRules, tetronimos, UserPreferences } from './config';\n\nconst down = new Vec(0, 1);\n\nexport interface Tile {\n  id: number;\n  kind: TetronimoKind;\n}\n\nexport interface Tetronimo {\n  id: number;\n  kind: TetronimoKind;\n  position: Vec;\n  rotation: number;\n}\n\nexport interface TetronimoKind {\n  size: number;\n  rotations: Vec[][];\n}\n\nexport interface GameState {\n  seed: number;\n  field: (Tile | null)[][],\n\n  falling: Tetronimo | null,\n  fall_queue: TetronimoKind[],\n\n  holding: TetronimoKind | null,\n  hold_available: boolean,\n\n  garbage_ready: number[];\n  garbage_pending: number[];\n\n  dead: boolean;\n}\n\nexport interface Game {\n  rules: GameRules;\n  state: GameState;\n\n  collide(t: Tetronimo): boolean;\n  hard_drop_position(t: Tetronimo): Vec;\n\n  hold(): void;\n  drop(distance: number): number;\n  shift(dir: 1 | -1): boolean;\n  rotate(dir: 1 | -1): boolean;\n  lock_down(): void;\n  clear_lines(indices: number[]): void;\n  new_falling(): boolean;\n  end_game(): void;\n\n  apply_garbage(): void;\n}\n\n/** get the absolute positions of all the pieces of a tetronimo */\nexport function pieces(t: Tetronimo): Vec[] {\n  return t.kind.rotations[t.rotation]\n    .map(v => Vec.add(t.position, v));\n}\n\n/** create an empty row */\nexport function empty_row(rules: GameRules) {\n  let row = [];\n  for (let x = 0; x < rules.field_size.x; ++x) {\n    row[x] = null;\n  }\n  return row;\n}\n\n/** create an empty field */\nexport function empty_field(rules: GameRules) {\n  let field = [];\n  for (let y = 0; y < rules.field_size.y; ++y) {\n    field[y] = empty_row(rules);\n  }\n  return field;\n}\n\n/** create a new game */\nexport function empty_state(rules: GameRules, seed: number | null = null): GameState {\n  if (seed === null)\n    seed = alea(Math.random()).uint32();\n\n  return {\n    seed,\n    field: empty_field(rules),\n\n    falling: null,\n    fall_queue: [],\n    holding: null,\n    hold_available: true,\n    garbage_ready: [],\n    garbage_pending: [],\n    dead: false,\n  };\n}\n\nexport function reactive_state(inner: GameState): GameState {\n  let falling = inner.falling;\n\n  return reactive({\n    seed: inner.seed,\n    field: inner.field.map(row => shallowReactive(row)),\n\n    falling: customRef<typeof falling>((track, trigger) => ({\n      get: () => { track(); return falling; },\n      set: (v) => { falling = v && shallowReactive(v); trigger(); },\n    })),\n    fall_queue: shallowReactive([]),\n    holding: shallowRef(null),\n    hold_available: inner.hold_available,\n    garbage_ready: shallowReactive(inner.garbage_ready),\n    garbage_pending: shallowReactive(inner.garbage_pending),\n    dead: inner.dead,\n  });\n}\n\nexport function new_game(rules: GameRules, state: GameState): Game {\n  let next_id = 0;\n  let holding = false;\n\n  let self: Game;\n\n  function collide(t: Tetronimo) {\n    for (let part of pieces(t)) {\n      if (part.x < 0 || part.x >= rules.field_size.x || part.y >= rules.field_size.y)\n        return true;\n\n      if (part.y < 0)\n        continue;\n\n      let tile = state.field[part.y][part.x];\n      if (tile != null)\n        return true;\n    }\n\n    return false;\n  }\n\n  function hard_drop_position(t: Tetronimo) {\n    let bottom = t.position;\n    while (true) {\n      let position = Vec.add(bottom, down);\n      if (collide({ ...t, position })) break;\n      bottom = position;\n    }\n\n    return bottom;\n  }\n\n  function hold() {\n    if (state.dead || state.falling == null) return;\n\n    let next_fall = state.holding;\n    state.holding = state.falling?.kind ?? null;\n\n    if (next_fall) {\n      state.fall_queue.unshift(next_fall);\n    }\n\n    state.falling = null;\n    state.hold_available = false;\n    holding = true;\n  }\n\n  function drop(distance: number) {\n    if (state.dead || state.falling == null) return 0;\n\n    for (let i = 0; i < distance; ++i) {\n      let position = Vec.add(state.falling.position, down);\n      if (collide({ ...state.falling, position }))\n        return i;\n\n      state.falling.position = position;\n    }\n\n    return distance;\n  }\n\n  function shift(dir: 1 | -1) {\n    if (state.dead || state.falling == null) return false;\n\n    let position = Vec.add(state.falling.position, new Vec(dir, 0));\n    if (!collide({ ...state.falling, position })) {\n      state.falling.position = position;\n      return true;\n    }\n\n    return false;\n  }\n\n  function rotate(dir: 1 | -1) {\n    if (state.dead || state.falling == null) return false;\n\n    let rotation = (state.falling.rotation + dir) % 4;\n    if (rotation < 0) rotation += 4;\n\n    let kick_info = rules.wall_kicks.get(state.falling.kind);\n    assert(kick_info != null, `no kick info for piece`);\n\n    let kicks;\n    if (dir == 1)\n      kicks = kick_info[state.falling.rotation * 2];\n    else\n      kicks = kick_info[rotation * 2 + 1];\n\n    for (let kick of kicks) {\n      let position = Vec.add(state.falling.position, kick)\n\n      if (!collide({ ...state.falling, position, rotation })) {\n        state.falling.position = position;\n        state.falling.rotation = rotation;\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function lock_down() {\n    if (state.dead || state.falling == null) return;\n\n    for (let part of pieces(state.falling)) {\n      state.field[part.y][part.x] = {\n        id: state.falling.id,\n        kind: state.falling.kind,\n      };\n    }\n\n    let indices = [];\n    for (let y = 0; y < rules.field_size.y; ++y) {\n      if (state.field[y].every(t => t != null)) {\n        indices.push(y);\n      }\n    }\n\n    if (indices.length > 0) {\n      self.clear_lines(indices);\n    }\n\n    for (let count of state.garbage_ready) {\n      let random = alea(state.seed);\n      state.seed = random.uint32();\n\n      let column = Math.floor(random() * rules.field_size.x);\n      for (let y = 0; y < rules.field_size.y - count; ++y) {\n        Object.assign(state.field[y], state.field[y + count]);\n      }\n\n      for (let y = rules.field_size.y - count; y < rules.field_size.y; ++y) {\n        for (let x = 0; x < rules.field_size.x; ++x) {\n          if (x == column) state.field[y][x] = null;\n          else state.field[y][x] = { id: -1, kind: tetronimos.GARBAGE };\n        }\n      }\n    }\n    state.garbage_ready.length = 0;\n  }\n\n  function clear_lines(indices: number[]) {\n    for (let index of indices) {\n      for (let i = index; i > 0; --i) {\n        Object.assign(state.field[i], state.field[i - 1]);\n      }\n\n      for (let x = 0; x < rules.field_size.x; ++x) {\n        state.field[0][x] = null;\n      }\n    }\n  }\n\n  function new_falling() {\n    if (state.dead) return false;\n\n    if (state.fall_queue.length - 1 < rules.bag_preview) {\n      let random = alea(state.seed);\n      state.seed = random.uint32();\n\n      let pool = tetronimos.all.slice();\n      while (pool.length > 0) {\n        let i = Math.floor(random() * pool.length);\n        let kind = pool.splice(i, 1)[0];\n        state.fall_queue.push(kind);\n      }\n    }\n\n    let kind = state.fall_queue[0];\n    let position = new Vec(5 - Math.ceil(kind.size / 2), rules.field_size.y / 2 - 3);\n    let rotation = 0;\n\n    let falling = { id: next_id++, kind, position, rotation };\n    state.hold_available = !holding;\n    holding = false;\n\n    if (collide(falling)) {\n      return false;\n    } else {\n      state.fall_queue.shift();\n      state.falling = falling;\n      return true;\n    }\n  }\n\n  function end_game() {\n    state.dead = true;\n    state.falling = null;\n  }\n\n  function apply_garbage() {\n    let count = state.garbage_pending.shift()!;\n    state.garbage_ready.push(count);\n  }\n\n  return self = {\n    rules, state,\n\n    collide,\n    hard_drop_position,\n\n    hold,\n    drop,\n    shift,\n    rotate,\n    lock_down,\n    clear_lines,\n    new_falling,\n    end_game,\n\n    apply_garbage,\n  };\n}\n\nexport function play_local(user: UserPreferences, game: Game) {\n  let move_reset = 0;\n  let lock_progress = 0;\n  let fall_progress = 0;\n\n  let repeating = false;\n  let shift_left = false;\n  let shift_right = false;\n  let repeat_shift = 0 as 0 | 1 | -1;\n  let repeat_delay = 0;\n\n  new_falling();\n\n  /** generate a new falling tetronimo, filling the bag if needed */\n  function new_falling() {\n    if (game.state.dead) return;\n\n    if (game.new_falling()) {\n      move_reset = game.rules.move_reset_limit ?? Infinity;\n      lock_progress = 0;\n      fall_progress = 0;\n      game.drop(1);\n    } else {\n      game.end_game();\n    }\n  }\n\n  /** determine if the falling piece is resting on the ground */\n  function is_on_ground(t: Tetronimo) {\n    let position = Vec.add(t.position, down);\n\n    return game.collide({ ...t, position });\n  }\n\n  /** lock down the falling tetronimo */\n  function lock_down() {\n    game.lock_down();\n    new_falling();\n  }\n\n  /** reset the lock_delay, consuming a move reset */\n  function try_move_reset() {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (lock_progress > 0 && move_reset > 0) {\n      move_reset -= 1;\n      lock_progress = 0;\n    }\n  }\n\n  /** hold a piece */\n  function hold() {\n    if (!game.state.hold_available) return;\n\n    game.hold();\n    new_falling();\n  }\n\n  /** attempt to shift the falling tetronimo */\n  function shift(change: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (game.shift(change)) {\n      try_move_reset();\n\n      if (user.autoshift) {\n        repeat_delay = repeating\n          ? user.autoshift.delay - 1\n          : user.autoshift.initial_delay - 1;\n\n        repeating = true;\n      }\n    }\n  }\n\n  /** attempt to rotate the falling tetronimo */\n  function rotate(change: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (game.rotate(change)) {\n      try_move_reset();\n      return;\n    }\n  }\n\n  /** hard drop the falling tetronimo */\n  function hard_drop() {\n    if (game.state.dead || game.state.falling == null) return;\n\n    game.drop(20);\n    lock_down();\n  }\n\n  /** shift input handler */\n  function press_shift(dir: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    repeating = false;\n    if (dir == 1)\n      shift_right = true;\n    else\n      shift_left = true;\n    repeat_shift = dir;\n    shift(dir);\n  }\n\n  /** shift input handler */\n  function release_shift(dir: 1 | -1) {\n    if (game.state.dead || game.state.falling == null) return;\n\n    if (dir == 1)\n      shift_right = false;\n    else\n      shift_left = false;\n\n    if (user.autoshift && repeat_shift == dir) {\n      repeat_delay = repeating\n        ? user.autoshift.delay\n        : user.autoshift.initial_delay;\n    }\n\n    repeat_shift = shift_left ? -1 : shift_right ? 1 : 0;\n  }\n\n  let cleanup = [\n    onKeyDown(Z, () => rotate(-1)),\n    onKeyDown(A, () => rotate(-1)),\n    onKeyDown(X, () => rotate(1)),\n    onKeyDown(S, () => rotate(1)),\n    onKeyDown(UP, () => rotate(1)),\n\n    onKeyUp(LEFT, () => release_shift(-1)),\n    onKeyDown(LEFT, () => press_shift(-1)),\n    onKeyUp(RIGHT, () => release_shift(1)),\n    onKeyDown(RIGHT, () => press_shift(1)),\n\n    onKeyDown(SPACE, () => hard_drop()),\n\n    onKeyDown(C, () => hold()),\n    onKeyDown(SHIFT, () => hold()),\n  ];\n\n  let garbage_time = 0;\n\n  let cancel = setInterval(update, 1000 / 60);\n  function update() {\n    if (game.state.dead) {\n      return;\n    }\n\n    if (repeat_delay > 0) {\n      repeat_delay -= 1;\n    } else if (user.autoshift && repeat_shift != 0) {\n      shift(repeat_shift);\n    }\n\n    if (game.state.falling != null) {\n      if (is_on_ground(game.state.falling)) {\n        lock_progress += 1 / game.rules.lock_delay;\n        fall_progress = Math.min(fall_progress, Math.ceil(1 / game.rules.fall_delay));\n\n        if (lock_progress >= 1) {\n          fall_progress = 0;\n          lock_progress = 0;\n          lock_down();\n        }\n      } else {\n        if (isKeyDown(DOWN))\n          fall_progress += 1 / game.rules.fall_delay * user.soft_drop;\n        else\n          fall_progress += 1 / game.rules.fall_delay\n\n        if (fall_progress > 1) {\n          let drop = Math.floor(fall_progress);\n          let move = game.drop(drop);\n          if (move > 0)\n            move_reset = game.rules.move_reset_limit ?? Infinity;\n          if (move == drop)\n            fall_progress -= drop;\n          else\n            fall_progress = 0;\n        }\n      }\n    }\n\n    if (game.state.garbage_pending.length > 0) {\n      garbage_time += 1;\n      if (garbage_time == 60) {\n        game.apply_garbage();\n        garbage_time = 0;\n      }\n    }\n  }\n\n  return () => {\n    clearInterval(cancel);\n    for (let fn of cleanup) fn();\n    cleanup.length = 0;\n  };\n}\n","import { Vec } from '@/vec';\nimport { assert } from '@mfro/ts-common/assert';\n\nimport { TetronimoKind, Tetronimo, pieces, Game } from '..';\nimport { GameRules, tetronimos } from '../config';\n\nexport interface Renderer {\n  tile_size: number;\n  smoothing: boolean;\n  render_tile(context: CanvasRenderingContext2D, kind: TetronimoKind, around: boolean[], style: TileStyle): void;\n  render_background(context: CanvasRenderingContext2D, rules: GameRules, origin: Vec): void;\n}\n\nexport type RenderConfig =\n  | { style: 'toon', size: number, smooth: boolean, border: number }\n  | { style: 'pixel', size: number, smooth: boolean, border: number, ghost_opacity: number }\n  | { style: 'tetrio', ghost_color: boolean };\n\nexport async function make_renderer(config: RenderConfig): Promise<Renderer> {\n  function default_background(context: CanvasRenderingContext2D, rules: GameRules, origin: Vec, scale: number) {\n    function draw_ui(size: number, center: Vec) {\n      let topleft = Vec.add(center, new Vec(-2, -2));\n      let botrite = Vec.add(center, new Vec(2, -1 + 3 * size));\n\n      context.lineCap = 'butt';\n      context.lineJoin = 'miter';\n      context.strokeStyle = 'gray'\n      context.beginPath();\n\n      const thickness = 2 * pixel;\n      const length = 8 * pixel;\n\n      context.lineWidth = thickness;\n\n      context.moveTo(topleft.x + thickness / 2, topleft.y + length);\n      context.lineTo(topleft.x + thickness / 2, topleft.y + thickness / 2);\n      context.lineTo(topleft.x + length, topleft.y + thickness / 2);\n\n      context.moveTo(botrite.x - length, topleft.y + thickness / 2);\n      context.lineTo(botrite.x - thickness / 2, topleft.y + thickness / 2);\n      context.lineTo(botrite.x - thickness / 2, topleft.y + length);\n\n      context.moveTo(botrite.x - thickness / 2, botrite.y - length);\n      context.lineTo(botrite.x - thickness / 2, botrite.y - thickness / 2);\n      context.lineTo(botrite.x - length, botrite.y - thickness / 2);\n\n      context.moveTo(topleft.x + length, botrite.y - thickness / 2);\n      context.lineTo(topleft.x + thickness / 2, botrite.y - thickness / 2);\n      context.lineTo(topleft.x + thickness / 2, botrite.y - length);\n\n      context.stroke();\n    }\n\n    const pixel = 1 / scale;\n\n    context.save();\n\n    context.scale(scale, scale);\n    context.translate(origin.x, origin.y);\n\n    draw_ui(1, new Vec(-3, 3));\n    draw_ui(rules.bag_preview, new Vec(rules.field_size.x + 3, 3));\n\n    context.fillStyle = 'white';\n    context.fillRect(0, 0, rules.field_size.x, rules.field_size.y / 2);\n\n    context.lineWidth = 1 * pixel;\n    context.strokeStyle = '#f4f4f4';\n    for (let x = 0; x < rules.field_size.x - 1; ++x) {\n      context.beginPath();\n      // context.moveTo(x + 0.5 * pixel, 0);\n      // context.lineTo(x + 0.5 * pixel, rules.field_size.y);\n      context.moveTo((x + 1) - 0.5 * pixel, 0);\n      context.lineTo((x + 1) - 0.5 * pixel, rules.field_size.y / 2);\n      context.stroke();\n    }\n\n    for (let y = 0; y < rules.field_size.y / 2 - 1; ++y) {\n      context.beginPath();\n      // context.moveTo(0, y + 0.5 * pixel);\n      // context.lineTo(rules.field_size.x, y + 0.5 * pixel);\n      context.moveTo(0, (y + 1) - 0.5 * pixel);\n      context.lineTo(rules.field_size.x, (y + 1) - 0.5 * pixel);\n      context.stroke();\n    }\n\n    context.translate(0, -rules.field_size.y / 2);\n\n    context.restore();\n  }\n\n  if (config.style == 'toon') return {\n    tile_size: config.size,\n    smoothing: config.smooth,\n    render_tile(context, kind, around, style) {\n      const colors = new Map([\n        [tetronimos.I, '#31c7ef'],\n        [tetronimos.O, '#e39f02'],\n        [tetronimos.T, '#af298a'],\n        [tetronimos.J, '#2141c6'],\n        [tetronimos.L, '#e35b02'],\n        [tetronimos.S, '#59b101'],\n        [tetronimos.Z, '#d70f37'],\n        [tetronimos.GARBAGE, 'gray'],\n      ]);\n\n      context.save();\n      if (style == TileStyle.ghost) {\n        context.fillStyle = 'white';\n        context.fillRect(0, 0, 1, 1);\n      } else if (style == TileStyle.disabled) {\n        context.filter = 'grayscale(100%)';\n      } else {\n        let color = colors.get(kind);\n        assert(color != null, `no color for piece`);\n        context.fillStyle = color;\n        context.fillRect(0, 0, 1, 1);\n      }\n\n      const border = config.border / config.size;\n\n      context.beginPath();\n      context.lineCap = 'butt';\n      context.lineWidth = border;\n      context.strokeStyle = '#00000040';\n\n      if (around[0]) {\n        context.moveTo(0, border / 2);\n        context.lineTo(border / 2, border / 2);\n        context.lineTo(border / 2, 0);\n      }\n\n      if (around[1]) {\n        context.moveTo(0, border / 2);\n        context.lineTo(1, border / 2);\n      }\n\n      if (around[2]) {\n        context.moveTo(1 - border / 2, 0);\n        context.lineTo(1 - border / 2, border / 2);\n        context.lineTo(1, border / 2);\n      }\n\n      if (around[3]) {\n        context.moveTo(-border / 2 + 1, 0);\n        context.lineTo(-border / 2 + 1, 1);\n      }\n\n      if (around[4]) {\n        context.moveTo(1, 1 - border / 2);\n        context.lineTo(1 - border / 2, 1 - border / 2);\n        context.lineTo(1 - border / 2, 1);\n      }\n\n      if (around[5]) {\n        context.moveTo(1, -border / 2 + 1);\n        context.lineTo(0, -border / 2 + 1);\n      }\n\n      if (around[6]) {\n        context.moveTo(border / 2, 1);\n        context.lineTo(border / 2, 1 - border / 2);\n        context.lineTo(0, 1 - border / 2);\n      }\n\n      if (around[7]) {\n        context.moveTo(border / 2, 1);\n        context.lineTo(border / 2, 0);\n      }\n\n      // context.strokeStyle = kind.color;\n      // context.stroke();\n\n      context.strokeStyle = '#00000040';\n      context.stroke();\n\n      context.filter = 'none';\n      context.restore();\n    },\n    render_background: (c, r, o) => default_background(c, r, o, config.size),\n  };\n\n  if (config.style == 'pixel') return {\n    tile_size: config.size,\n    smoothing: config.smooth,\n    render_tile(context, kind, around, style) {\n      const border = config.border / config.size;\n\n      const colors = new Map([\n        [tetronimos.I, ['#31c7ef', '#48e0ff', '#20b0e0']],\n        [tetronimos.O, ['#f7d308', '#ffec1c', '#e8c000']],\n        [tetronimos.T, ['#ad4d9c', '#c658b4', '#983888']],\n        [tetronimos.J, ['#5a65ad', '#6680cc', '#4857a0']],\n        [tetronimos.L, ['#ef7921', '#ff9030', '#e06810']],\n        [tetronimos.S, ['#42b642', '#48d048', '#30a030']],\n        [tetronimos.Z, ['#ef2029', '#ff4848', '#d01818']],\n        [tetronimos.GARBAGE, ['#42b642', '#48d048', '#30a030']],\n        // [tetronimos.GARBAGE, ['#9e9e9e', '#bdbdbd', '#757575']],\n      ]);\n\n      let color = colors.get(kind);\n      assert(color != null, `no color for piece`);\n\n      context.save();\n      if (style == TileStyle.ghost) {\n        context.fillStyle = 'white';\n        context.fillRect(0, 0, 1, 1);\n        context.globalAlpha = config.ghost_opacity;\n      }\n\n      if (style == TileStyle.disabled || kind == tetronimos.GARBAGE) {\n        context.filter = 'grayscale(100%)';\n      }\n\n      context.fillStyle = color[0];\n      context.fillRect(border, border, 1 - 2 * border, 1 - 2 * border);\n\n      if (border > 0) {\n        context.lineCap = 'butt';\n        context.lineJoin = 'miter';\n        context.lineWidth = border;\n\n        context.fillStyle = around[7] ? color[1] : color[0];\n        context.fillRect(0, border, border, 1 - 2 * border);\n\n        context.fillStyle = around[1] ? color[1] : color[0];\n        context.fillRect(border, 0, 1 - 2 * border, border);\n\n        context.fillStyle = around[0] || around[7] || around[1] ? color[1] : color[0];\n        context.fillRect(0, 0, border, border);\n\n        context.fillStyle = around[3] ? color[2] : color[0];\n        context.fillRect(1 - border, border, border, 1 - 2 * border);\n\n        context.fillStyle = around[5] ? color[2] : color[0];\n        context.fillRect(border, 1 - border, 1 - 2 * border, border);\n\n        context.fillStyle = around[4] || around[3] || around[5] ? color[2] : color[0];\n        context.fillRect(1 - border, 1 - border, border, border);\n\n        context.fillStyle = around[2] && around[1] && around[3] ? color[0]\n          : around[1] ? color[1]\n            : around[3] ? color[2]\n              : around[2] ? color[2]\n                : color[0];\n        context.fillRect(1 - border, 0, border, border);\n\n        context.fillStyle = around[6] && around[7] && around[5] ? color[0]\n          : around[7] ? color[1]\n            : around[5] ? color[2]\n              : around[6] ? color[1]\n                : color[0];\n        context.fillRect(0, 1 - border, border, border);\n      }\n\n      context.filter = 'none';\n      context.restore();\n    },\n    render_background: (c, r, o) => default_background(c, r, o, config.size),\n  };\n\n  if (config.style == 'tetrio') {\n    const sprites = new Image();\n    sprites.src = require('@/assets/tetrio.png');\n\n    const background = new Image();\n    background.src = require('@/assets/tetrio-bg.png');\n\n    const order = [\n      tetronimos.Z,\n      tetronimos.L,\n      tetronimos.O,\n      tetronimos.S,\n      tetronimos.I,\n      tetronimos.J,\n      tetronimos.T,\n    ];\n\n    let p1 = new Promise(resolve => sprites.onload = resolve);\n    let p2 = new Promise(resolve => background.onload = resolve);\n    await p1;\n    await p2;\n\n    return {\n      tile_size: 30,\n      smoothing: false,\n      render_tile(context, kind, around, style) {\n        context.save();\n\n        let index;\n        if (style == TileStyle.disabled || kind == tetronimos.GARBAGE) {\n          index = 9;\n        } else {\n          index = order.indexOf(kind);\n        }\n\n        if (style == TileStyle.ghost) {\n          context.globalAlpha = 0.2;\n          context.drawImage(sprites, 7 * 31, 0, 30, 30, 0, 0, 1, 1);\n          if (config.ghost_color) {\n            context.globalAlpha = 1;\n            context.globalCompositeOperation = 'source-atop';\n            context.drawImage(sprites, index * 31, 0, 30, 30, 0, 0, 1, 1);\n          }\n        } else {\n          context.drawImage(sprites, index * 31, 0, 30, 30, 0, 0, 1, 1);\n        }\n\n        context.restore();\n      },\n      render_background(context, rules, origin) {\n        function draw_ui(size: number, center: Vec) {\n          context.fillStyle = '#000000e0';\n          context.fillRect(center.x - 2, center.y - 2, 4, 1 + 3 * size);\n\n          const thickness = 0.125;\n          context.strokeStyle = '#ffffffe0';\n          context.lineJoin = 'round';\n          context.lineWidth = thickness;\n          context.strokeRect(center.x - 2 - thickness / 2, center.y - 2 - thickness / 2, 4 + thickness, 1 + 3 * size + thickness);\n        }\n\n        const pixel = 1 / 30;\n\n        context.save();\n\n        context.drawImage(background, 0, 0, 2000, 1333, 30 * (origin.x + rules.field_size.x / 2) - 1000, 0, 2000, 1333);\n\n        context.fillStyle = '#000000a0';\n        context.fillRect(0, 0, 2000, 1333);\n\n        context.scale(30, 30);\n        context.translate(origin.x, origin.y);\n\n        const thickness = 0.125;\n        context.strokeStyle = '#ffffffe0';\n        context.lineCap = 'butt';\n        context.lineJoin = 'round';\n        context.lineWidth = thickness;\n        context.beginPath();\n        context.moveTo(0, thickness / 2);\n        context.lineTo(-thickness / 2, thickness / 2);\n        context.lineTo(-thickness / 2, rules.field_size.y / 2 + thickness / 2);\n        context.lineTo(rules.field_size.x + thickness / 2, rules.field_size.y / 2 + thickness / 2);\n        context.lineTo(rules.field_size.x + thickness / 2, thickness / 2);\n        context.lineTo(rules.field_size.x, thickness / 2);\n        context.stroke();\n\n        draw_ui(1, new Vec(-3, 3));\n        draw_ui(rules.bag_preview, new Vec(rules.field_size.x + 3, 3));\n\n        context.fillStyle = '#000000e0';\n        context.fillRect(0, 0, rules.field_size.x, rules.field_size.y / 2);\n\n        context.lineWidth = 1 * pixel;\n        context.strokeStyle = '#ffffff14';\n        for (let x = 0; x < rules.field_size.x - 1; ++x) {\n          context.beginPath();\n          // context.moveTo(x + 0.5 * pixel, 0);\n          // context.lineTo(x + 0.5 * pixel, rules.field_size.y);\n          context.moveTo((x + 1) - 0.5 * pixel, 0);\n          context.lineTo((x + 1) - 0.5 * pixel, rules.field_size.y / 2);\n          context.stroke();\n        }\n\n        for (let y = 0; y < rules.field_size.y / 2 - 1; ++y) {\n          context.beginPath();\n          // context.moveTo(0, y + 0.5 * pixel);\n          // context.lineTo(rules.field_size.x, y + 0.5 * pixel);\n          context.moveTo(0, (y + 1) - 0.5 * pixel);\n          context.lineTo(rules.field_size.x, (y + 1) - 0.5 * pixel);\n          context.stroke();\n        }\n\n        context.translate(0, -rules.field_size.y / 2);\n\n        context.restore();\n      },\n    };\n  }\n\n  throw new Error('invalid render config');\n}\n\nexport enum TileStyle {\n  normal,\n  ghost,\n  disabled,\n}\n\ninterface ImageCache {\n  hash: string;\n  images: string[];\n}\n\nexport async function render_tilesheets(config: RenderConfig) {\n  const renderer = await make_renderer(config);\n  const styles = [TileStyle.normal, TileStyle.ghost, TileStyle.disabled];\n\n  const canvas = document.createElement('canvas');\n\n  let offset_fn: (around: number, style: TileStyle) => Vec;\n  if (renderer.smoothing) {\n    const IMAGE_STRIDE = 256;\n\n    canvas.width = renderer.tile_size * IMAGE_STRIDE;\n    canvas.height = renderer.tile_size * styles.length * (256 / IMAGE_STRIDE);\n\n    offset_fn = (around, style) => {\n      let index = (around) | (style << 8);\n      return new Vec(index % IMAGE_STRIDE, Math.floor(index / IMAGE_STRIDE));\n    };\n  } else {\n    canvas.width = renderer.tile_size * styles.length;\n    canvas.height = renderer.tile_size;\n\n    offset_fn = (around, style) => new Vec(style, 0);\n  }\n\n  const lookup = (around: boolean[], style: TileStyle) => {\n    let index = 0;\n\n    for (let i = 0; i < 8; ++i) {\n      if (around[i]) {\n        index |= (1 << i);\n      }\n    }\n\n    return Vec.scale(offset_fn(index, style), renderer.tile_size);\n  };\n\n  let bytes = new TextEncoder().encode(JSON.stringify(config) + renderer.render_tile.toString());\n  let hash_raw = await window.crypto.subtle.digest('SHA-256', bytes);\n  let hash = Array.from(new Uint8Array(hash_raw))\n    .map(b => b.toString(16).padStart(2, '0'))\n    .join('');\n\n  let raw = localStorage.getItem('mfro:tetris-tilesheet');\n  if (raw) {\n    let cache: ImageCache = JSON.parse(raw);\n    if (cache.hash == hash) {\n      // console.log(`tilesheet hash match ${hash}`);\n      return [lookup, cache.images] as const;\n    } else {\n      console.log(`tilesheet cache miss ${cache.hash} expected ${hash}`);\n    }\n  }\n\n  const context = canvas.getContext('2d');\n  assert(context != null, 'no context');\n\n  context.scale(renderer.tile_size, renderer.tile_size);\n\n  let images = [];\n  let kinds = [...tetronimos.all, tetronimos.GARBAGE];\n  for (let kind of kinds) {\n    context.clearRect(0, 0, canvas.width, canvas.height);\n\n    for (let style of styles) {\n      if (renderer.smoothing) {\n        for (let i = 0; i < 256; ++i) {\n          let around = [];\n          for (let j = 0; j < 8; ++j) around[j] = (i & (1 << j)) != 0;\n\n          let offset = offset_fn(i, style);\n          context.translate(offset.x, offset.y);\n          renderer.render_tile(context, kind, around, style);\n          context.translate(-offset.x, -offset.y);\n        }\n      } else {\n        let around = [true, true, true, true, true, true, true, true];\n        let offset = offset_fn(0, style);\n        context.translate(offset.x, offset.y);\n        renderer.render_tile(context, kind, around, style);\n        context.translate(-offset.x, -offset.y);\n      }\n    }\n\n    let url = canvas.toDataURL();\n    images.push(url);\n    // console.log(url);\n  }\n\n  if (images.length == kinds.length) {\n    localStorage.setItem('mfro:tetris-tilesheet', JSON.stringify({ hash, images }))\n  }\n\n  return [lookup, images] as const;\n}\n\nasync function prerender(config: RenderConfig): Promise<Renderer> {\n  let base = await make_renderer(config);\n  let [lookup, data] = await render_tilesheets(config);\n\n  let images = data.map(url => {\n    let image = new Image();\n    image.src = url;\n    return image;\n  });\n\n  return {\n    ...base,\n    render_tile(context, kind, around, style) {\n      let sheet = images[kind == tetronimos.GARBAGE ? tetronimos.all.length : tetronimos.all.indexOf(kind)];\n      let offset = lookup(around, style);\n\n      context.drawImage(sheet, offset.x, offset.y, base.tile_size, base.tile_size, 0, 0, 1, 1)\n    },\n  };\n}\n\nexport async function render(canvas: HTMLCanvasElement, config: RenderConfig, game: Game) {\n  const renderer = await prerender(config);\n\n  const unit_size = renderer.tile_size;\n\n  canvas.width = (game.rules.field_size.x + 14) * unit_size;\n  canvas.height = (game.rules.field_size.y / 2) * unit_size + 2;\n  canvas.style.width = `${canvas.width}px`;\n  canvas.style.height = `${canvas.height}px`;\n\n  const context = canvas.getContext('2d')!;\n  assert(context != null, 'no context');\n\n  context.imageSmoothingEnabled = false;\n\n  function tile_at(pos: Vec) {\n    if (pos.x < 0 || pos.x >= game.rules.field_size.x\n      || pos.y < 0 || pos.y >= game.rules.field_size.y)\n      return null;\n\n    return game.state.field[pos.y][pos.x];\n  }\n\n  const adj8 = [\n    new Vec(-1, -1),\n    new Vec(0, -1),\n    new Vec(1, -1),\n    new Vec(1, 0),\n    new Vec(1, 1),\n    new Vec(0, 1),\n    new Vec(-1, 1),\n    new Vec(-1, 0),\n  ];\n\n  /** draw a a tetronimo */\n  function draw_tetronimo(t: Tetronimo, style: TileStyle) {\n    for (let offset of t.kind.rotations[t.rotation]) {\n      let position = Vec.add(t.position, offset);\n\n      let diff = adj8.map(adj =>\n        t.kind.rotations[t.rotation]\n          .every(v => !Vec.eq(v, Vec.add(offset, adj)))\n      );\n\n      context.translate(position.x, position.y);\n      renderer.render_tile(context, t.kind, diff, style);\n      context.translate(-position.x, -position.y);\n    }\n  }\n\n  /** draw a tetronimo in the UI */\n  function draw_ui(kinds: TetronimoKind[], center: Vec, hold = false) {\n    for (let kind of kinds) {\n      let parts = pieces({ id: -1, kind, position: Vec.zero, rotation: 0 });\n\n      let minX = parts.reduce((m, v) => Math.min(m, v.x), Infinity) + 0.5;\n      let minY = parts.reduce((m, v) => Math.min(m, v.y), Infinity) + 0.5;\n      let maxX = parts.reduce((m, v) => Math.max(m, v.x), -Infinity) + 0.5;\n      let maxY = parts.reduce((m, v) => Math.max(m, v.y), -Infinity) + 0.5;\n\n      let offset = new Vec(-(minX + maxX) / 2, -(minY + maxY) / 2);\n      let position = Vec.add(center, offset);\n\n      let style = hold && !game.state.hold_available ? TileStyle.disabled : TileStyle.normal;\n      draw_tetronimo({ id: -1, kind, position, rotation: 0 }, style);\n\n      center = Vec.add(center, new Vec(0, 3));\n    }\n  }\n\n  let cancel = requestAnimationFrame(tick);\n  function tick() {\n    cancel = requestAnimationFrame(tick);\n\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    context.save();\n\n    renderer.render_background(context, game.rules, new Vec(7, 1));\n\n    context.scale(renderer.tile_size, renderer.tile_size);\n    context.translate(7, 1);\n\n    if (game.state.holding) {\n      draw_ui([game.state.holding], new Vec(-3, 3), true);\n    }\n\n    if (game.rules.bag_preview > 0) {\n      draw_ui(game.state.fall_queue.slice(0, game.rules.bag_preview), new Vec(game.rules.field_size.x + 3, 3));\n    }\n\n    context.translate(0, -game.rules.field_size.y / 2);\n\n    if (game.state.falling) {\n      let position = game.hard_drop_position(game.state.falling);\n      draw_tetronimo({ ...game.state.falling, position }, TileStyle.ghost);\n\n      draw_tetronimo(game.state.falling, TileStyle.normal);\n    }\n\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      for (let y = 0; y < game.rules.field_size.y; ++y) {\n        let t = game.state.field[y][x];\n        if (t == null) continue;\n\n        let position = new Vec(x, y);\n\n        let diff = adj8.map(adj => tile_at(Vec.add(position, adj))?.id != t!.id);\n\n        context.translate(x, y);\n        renderer.render_tile(context, game.state.field[y][x]!.kind, diff, TileStyle.normal);\n        context.translate(-x, -y);\n      }\n    }\n\n    context.restore();\n  }\n\n  return () => cancelAnimationFrame(cancel);\n}\n","<template>\n  <v-dialog :model-value=\"editing\">\n    <edit-config kind=\"game\" v-model=\"game_rules\" @close=\"editing = false\" />\n  </v-dialog>\n\n  <v-flex column grow align-center class=\"mt-6\">\n    <v-card v-if=\"!room.local\">\n      <template v-slot:title>\n        <v-flex grow align-start>\n          <v-text title>Tetris Lobby</v-text>\n\n          <v-grow class=\"mx-6\" />\n          <v-grow class=\"mx-6\" />\n\n          <clipboard :value=\"link\" />\n        </v-flex>\n      </template>\n\n      <v-flex column class=\"pt-4\">\n        <v-flex v-for=\"member in room.members\" :key=\"member\" class=\"px-4\">\n          <v-icon class=\"mr-3\" v-if=\"member.winner\" style=\"color: #ffc107\"\n            >emoji_events</v-icon\n          >\n          <v-text class=\"my-3\">{{ member.name }}</v-text>\n        </v-flex>\n      </v-flex>\n\n      <template v-slot:actions v-if=\"room.index == 0\">\n        <v-button text @click=\"editing = true\" class=\"mr-3\">\n          <v-icon class=\"mr-3\">settings</v-icon>\n          <span>Game rules</span>\n        </v-button>\n\n        <v-grow />\n\n        <v-button @click=\"start()\" color=\"primary\">\n          <span>Start game</span>\n        </v-button>\n      </template>\n    </v-card>\n\n    <v-flex column v-else>\n      <v-flex>\n        <game :value=\"before.game\" v-if=\"before\" />\n\n        <game :value=\"room.local\" />\n\n        <game :value=\"after.game\" v-if=\"after\" />\n      </v-flex>\n\n      <v-flex>\n        <game v-for=\"member in others\" :key=\"member\" :value=\"member.game\" />\n      </v-flex>\n    </v-flex>\n  </v-flex>\n</template>\n\n<script>\nimport { computed, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { wall_kicks } from '@/tetris/config';\n\nimport game from '@/ui/game';\nimport clipboard from '@/ui/clipboard';\nimport editConfig from '@/ui/edit-config';\n\nexport default {\n  name: 'room',\n  components: {\n    game,\n    clipboard,\n    editConfig,\n  },\n\n  props: ['room'],\n\n  setup(props) {\n    const base = window.location;\n    const link = computed(() => `${base.origin}${base.pathname}?code=${props.room.code}`);\n\n    const editing = shallowRef(false);\n    const game_rules = shallowReactive({\n      field_size: new Vec(10, 40),\n      fall_delay: 50,\n      lock_delay: 30,\n      move_reset_limit: 15,\n\n      wall_kicks: wall_kicks.standard,\n\n      bag_preview: 5,\n    });\n\n    const before = computed(() => {\n      if (props.room.members.length < 3)\n        return;\n\n      let index = props.room.index - 1;\n      if (index == -1) index = props.room.members.length - 1;\n\n      return props.room.members[index];\n    });\n\n    const after = computed(() => {\n      if (props.room.members.length < 2)\n        return;\n\n      let index = props.room.index + 1;\n      if (index == props.room.members.length) index = 0;\n\n      return props.room.members[index];\n    });\n\n    const others = computed(() => {\n      return props.room.members.filter((m, i) => i != props.room.index && m != before.value && m != after.value);\n    });\n\n    return {\n      link,\n\n      editing,\n      game_rules,\n      others,\n      after,before,\n\n      start() {\n        props.room.start_game(game_rules);\n      },\n    };\n  },\n};\n</script>\n","<template>\n  <canvas ref=\"canvas\" />\n</template>\n\n<script>\nimport { inject, onBeforeUnmount, onMounted, ref, toRef, watch } from 'vue';\n\nimport { render } from '@/tetris/render/pixi';\n// import { render } from '@/tetris/render/basic';\n\nexport default {\n  name: 'game',\n\n  props: {\n    value: Object,\n  },\n\n  setup(props) {\n    const value = toRef(props, 'value');\n    const canvas = ref(null);\n    let cleanup;\n\n    const user_prefs = inject('user_prefs');\n\n    let prevCanvas, prevGame, prevPrefs;\n    function reset() {\n      if (canvas.value == prevCanvas && value.value == prevGame && user_prefs.value.render == prevPrefs) {\n        return;\n      }\n\n      cleanup?.();\n      cleanup = null;\n\n      prevCanvas = canvas.value;\n      prevGame = value.value;\n      prevPrefs = user_prefs.value.render;\n\n      if (canvas.value && value.value) {\n        render(canvas.value, user_prefs.value.render, value.value).then(c => cleanup = c);\n      }\n    }\n\n    watch(value, reset);\n    watch(canvas, reset);\n    watch(user_prefs, reset);\n    onMounted(reset);\n\n    onBeforeUnmount(() => {\n      cleanup?.();\n    });\n\n    return { canvas };\n  },\n};\n</script>\n","import { Application, BaseTexture, Container, Graphics, Point, Rectangle, SCALE_MODES, settings as pixi_settings, Sprite, Texture } from 'pixi.js';\nimport { watch, watchEffect } from 'vue';\n\nimport { Vec } from '@/vec';\n\nimport { TetronimoKind, Game, Tetronimo, pieces } from '..';\nimport { GameRules, tetronimos } from '../config';\n\nimport { make_renderer, RenderConfig, Renderer, render_tilesheets, TileStyle } from './basic';\nimport { assert } from '@mfro/ts-common/assert';\n\nconst padding = new Vec(1, 3);\n\nconst adj8 = [\n  new Vec(-1, -1),\n  new Vec(0, -1),\n  new Vec(1, -1),\n  new Vec(1, 0),\n  new Vec(1, 1),\n  new Vec(0, 1),\n  new Vec(-1, 1),\n  new Vec(-1, 0),\n];\n\nfunction prerender_background(renderer: Renderer, rules: GameRules) {\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  assert(context != null, 'context');\n\n  canvas.width = renderer.tile_size * (rules.field_size.x + 12 + padding.x * 2);\n  canvas.height = renderer.tile_size * (rules.field_size.y / 2 + padding.y * 2);\n\n  renderer.render_background(context, rules, Vec.add(padding, new Vec(6, 0)));\n\n  return canvas.toDataURL();\n}\n\nexport async function render(canvas: HTMLCanvasElement, config: RenderConfig, game: Game) {\n  const renderer = await make_renderer(config);\n\n  const unit_size = renderer.tile_size;\n\n  const textures = new Map<TetronimoKind, BaseTexture>();\n\n  canvas.width = (game.rules.field_size.x + 12 + padding.x * 2) * unit_size;\n  canvas.height = (game.rules.field_size.y / 2 + padding.y * 2) * unit_size;\n  canvas.style.width = `${canvas.width}px`;\n  canvas.style.height = `${canvas.height}px`;\n  canvas.style.marginBottom = `${-padding.y * unit_size}px`;\n\n  pixi_settings.SCALE_MODE = SCALE_MODES.NEAREST;\n\n  function tile_at(pos: Vec) {\n    if (pos.x < 0 || pos.x >= game.rules.field_size.x\n      || pos.y < 0 || pos.y >= game.rules.field_size.y)\n      return null;\n\n    return game.state.field[pos.y][pos.x];\n  }\n\n  function draw_tile(position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) {\n    let base = textures.get(kind)!;\n    let index = lookup(around, style);\n\n    let sprite = new Sprite();\n    sprite.scale = new Point(1 / renderer.tile_size, 1 / renderer.tile_size);\n    sprite.texture = new Texture(base, new Rectangle(index.x, index.y, renderer.tile_size, renderer.tile_size));\n    sprite.position = new Point(position.x, position.y);\n\n    return sprite;\n  }\n\n  class SpritePool {\n    sprites: Sprite[] = [];\n\n    constructor(\n      readonly container: Container,\n    ) { }\n\n    clear() {\n      for (let sprite of this.sprites)\n        this.container.removeChild(sprite);\n      this.sprites = [];\n    }\n\n    draw_tile(position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) {\n      let sprite = draw_tile(position, kind, around, style);\n      this.sprites.push(sprite);\n      this.container.addChild(sprite);\n    }\n\n    draw_tetronimo(t: Tetronimo, style: TileStyle) {\n      let offsets = t.kind.rotations[t.rotation];\n\n      for (let offset of t.kind.rotations[t.rotation]) {\n        let position = Vec.add(t.position, offset);\n\n        let around = adj8.map(adj =>\n          offsets\n            .every(v => !Vec.eq(v, Vec.add(offset, adj)))\n        );\n\n        this.draw_tile(position, t.kind, around, style);\n      }\n    }\n  }\n\n  function draw_ui(src: () => (TetronimoKind | null)[], isHold: boolean) {\n    let field = new Container();\n    let pool = new SpritePool(field);\n    watch(() => [src(), game.state.hold_available] as const, ([list, hold_available]) => {\n      pool.clear();\n\n      let center = new Vec(2, 2);\n\n      for (let kind of list) {\n        if (!kind) continue;\n\n        let parts = pieces({ id: -1, kind, position: Vec.zero, rotation: 0 });\n\n        let minX = parts.reduce((m, v) => Math.min(m, v.x), Infinity) + 0.5;\n        let minY = parts.reduce((m, v) => Math.min(m, v.y), Infinity) + 0.5;\n        let maxX = parts.reduce((m, v) => Math.max(m, v.x), -Infinity) + 0.5;\n        let maxY = parts.reduce((m, v) => Math.max(m, v.y), -Infinity) + 0.5;\n\n        let offset = new Vec(-(minX + maxX) / 2, -(minY + maxY) / 2);\n        let position = Vec.add(center, offset);\n\n        let style = isHold && !hold_available ? TileStyle.disabled : TileStyle.normal;\n\n        pool.draw_tetronimo({ id: -1, kind, position, rotation: 0 }, style);\n        center = Vec.add(center, new Vec(0, 3));\n      }\n    }, { immediate: true });\n\n    return field;\n  }\n\n  const app = new Application({\n    view: canvas,\n    width: unit_size * (game.rules.field_size.x + 12 + padding.x * 2),\n    height: unit_size * (game.rules.field_size.y / 2 + padding.y * 2),\n    transparent: true,\n  });\n\n  let [lookup, tilesheets] = await render_tilesheets(config);\n  tilesheets.forEach((sheet, i) => {\n    app.loader.add(i.toString(), sheet);\n  });\n  app.loader.add('background', prerender_background(renderer, game.rules));\n  app.loader.load();\n\n  app.loader.onLoad.once(() => {\n    for (let i = 0; i < 7; ++i) {\n      let base = app.loader.resources[i]!.texture.baseTexture;\n      textures.set(tetronimos.all[i], base);\n    }\n    let base = app.loader.resources[tetronimos.all.length]!.texture.baseTexture;\n    textures.set(tetronimos.GARBAGE, base);\n\n    const root = new Container();\n    root.scale = new Point(unit_size, unit_size);\n\n    const field = new Container();\n    field.position = new Point(6 + padding.x, (-game.rules.field_size.y / 2) + padding.y);\n\n    const background = new Sprite(app.loader.resources['background'].texture);\n    background.width = game.rules.field_size.x + 12 + padding.x * 2;\n    background.height = game.rules.field_size.y / 2 + padding.y * 2;\n\n    const holding = draw_ui(() => [game.state.holding], true);\n    holding.position = new Point(1 + padding.x, 1 + padding.y);\n\n    const queue = draw_ui(() => game.state.fall_queue.slice(0, 5), false);\n    queue.position = new Point((7 + padding.x + game.rules.field_size.x), 1 + padding.y);\n\n    const garbage = new Container();\n    garbage.position = new Point(4 + padding.x, padding.y);\n\n    root.addChild(background);\n    root.addChild(field);\n    root.addChild(queue);\n    root.addChild(holding);\n    root.addChild(garbage);\n    app.stage.addChild(root);\n\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      for (let y = 0; y < game.rules.field_size.y; ++y) {\n        let position = new Vec(x, y);\n        let sprite: Sprite | null = null;\n\n        watchEffect(() => {\n          if (sprite != null) {\n            field.removeChild(sprite);\n            sprite = null;\n          }\n\n          let t = game.state.field[y][x];\n          if (t != null) {\n            let around = adj8.map(adj => tile_at(Vec.add(position, adj))?.id != t!.id);\n            sprite = draw_tile(new Vec(x, y), t.kind, around, TileStyle.normal);\n            field.addChild(sprite);\n          }\n        });\n      }\n    }\n\n    let falling = new SpritePool(field);\n    watchEffect(() => {\n      falling.clear();\n\n      if (game.state.falling) {\n        let position = game.hard_drop_position(game.state.falling);\n        let ghost = { ...game.state.falling, position };\n        falling.draw_tetronimo(ghost, TileStyle.ghost);\n        falling.draw_tetronimo(game.state.falling, TileStyle.normal);\n      }\n    });\n\n    let garbage_pool = new SpritePool(garbage);\n    watchEffect(() => {\n      garbage_pool.clear();\n      let y = game.rules.field_size.y / 2;\n\n      for (let count of game.state.garbage_ready) {\n        y -= count;\n        for (let i = 0; i < count; ++i) {\n          let position = new Vec(0, y + i);\n          garbage_pool.draw_tile(position, tetronimos.GARBAGE, [true, i == 0, true, true, true, i + 1 == count, true, true], TileStyle.normal);\n        }\n      }\n\n      for (let count of game.state.garbage_pending) {\n        y -= count;\n        for (let i = 0; i < count; ++i) {\n          let position = new Vec(0, y + i);\n          garbage_pool.draw_tile(position, tetronimos.GARBAGE, [true, i == 0, true, true, true, i + 1 == count, true, true], TileStyle.ghost);\n        }\n      }\n    });\n  });\n\n  return () => app.destroy();\n}\n","import { render } from \"./game.vue?vue&type=template&id=414fd869\"\nimport script from \"./game.vue?vue&type=script&lang=js\"\nexport * from \"./game.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-flex align-center justify-center>\n    <v-button small icon @click=\"copy()\" @mouseleave=\"copied = false\">\n      <v-icon small v-if=\"!copied\">content_paste</v-icon>\n      <v-icon small v-else bold style=\"color: #4caf50\">check</v-icon>\n    </v-button>\n\n    <v-text-field small class=\"mt-0 ml-4\" ref=\"input\" solo :model-value=\"value\" />\n  </v-flex>\n</template>\n\n<script>\nimport { shallowRef } from 'vue';\n\nexport default {\n  name: 'clipboard',\n\n  props: {\n    value: String,\n  },\n\n  setup(props) {\n    const input = shallowRef(null);\n    const copied = shallowRef(false);\n\n    return {\n      input, copied,\n      copy: () => {\n        input.value.select();\n        document.execCommand('copy');\n        copied.value = true;\n      },\n    };\n  },\n};\n</script>\n","import { render } from \"./clipboard.vue?vue&type=template&id=65564d5c\"\nimport script from \"./clipboard.vue?vue&type=script&lang=js\"\nexport * from \"./clipboard.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./room.vue?vue&type=template&id=aa6ea21a\"\nimport script from \"./room.vue?vue&type=script&lang=js\"\nexport * from \"./room.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-dialog :model-value=\"editing\">\n    <edit-config kind=\"game\" v-model=\"game_rules\" @close=\"editing = false\" />\n  </v-dialog>\n\n  <v-flex column grow align-center>\n    <game :value=\"local_game\" />\n\n    <v-grow />\n\n    <!-- <v-flex justify-center>\n      <v-button @click=\"editing = true\">\n        <v-icon class=\"mr-3\">settings</v-icon>\n        <span>Game rules</span>\n      </v-button>\n    </v-flex> -->\n\n    <v-card class=\"mt-4\">\n      <v-text-field label=\"Name\" v-model=\"name\" />\n\n      <v-flex justify-center class=\"my-2\">\n        <v-button\n          text\n          color=\"primary\"\n          :disabled=\"!valid\"\n          @click=\"create_room()\"\n        >\n          <span>Create lobby</span>\n          <v-icon class=\"ml-3\">arrow_forward</v-icon>\n        </v-button>\n      </v-flex>\n    </v-card>\n  </v-flex>\n</template>\n\n<script>\nimport { computed, inject, onBeforeUnmount, onMounted, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { onKeyDown, R } from '@/input';\nimport { play_local, new_game, reactive_state, empty_state } from '@/tetris';\nimport { wall_kicks } from '@/tetris/config';\nimport { create_room } from '@/tetris/remote';\n\nimport game from '@/ui/game';\nimport editConfig from '@/ui/edit-config';\nimport configGameRules from '@/ui/config/config-game-rules';\nimport configUserPrefs from '@/ui/config/config-user-prefs';\n\nexport default {\n  name: 'landing',\n  components: {\n    game,\n    editConfig,\n    configGameRules,\n    configUserPrefs,\n  },\n\n  emits: ['room'],\n\n  setup(props, { emit }) {\n    const editing = shallowRef(null);\n    const game_rules = shallowReactive({\n      field_size: new Vec(10, 40),\n      fall_delay: 50,\n      lock_delay: 30,\n      move_reset_limit: 15,\n\n      wall_kicks: wall_kicks.standard,\n\n      bag_preview: 5,\n    });\n\n    const user_prefs = inject('user_prefs');\n\n    const local_game = shallowRef(null);\n\n    let local_cleanup;\n    const start_game = () => {\n      local_cleanup?.();\n\n      const state = reactive_state(empty_state(game_rules));\n      local_game.value = new_game(game_rules, state);\n      local_cleanup = play_local(user_prefs.value, local_game.value);\n    };\n\n    onMounted(() => {\n      start_game();\n    });\n\n    onBeforeUnmount(() => local_cleanup?.());\n\n    onKeyDown(R, () => start_game());\n\n    const name = shallowRef(localStorage.getItem('mfro:user-name') ?? '');\n    const valid = computed(() => {\n      return name.value != '';\n    });\n\n    return {\n      local_game,\n\n      editing,\n      game_rules,\n\n      name,\n      valid,\n\n      create_room() {\n        localStorage.setItem('mfro:user-name', name.value);\n        let room = create_room(name.value, user_prefs.value);\n        emit('room', room);\n      },\n\n      edit(name) {\n        editing.value = name;\n      },\n    };\n  },\n};\n</script>\n","import alea from 'alea';\nimport { shallowReactive } from 'vue';\n\nimport { on } from '@mfro/ts-common/events';\nimport { receive, send } from '@mfro/ts-common/sockets/client';\nimport { BroadcastUpdate, ClientUpdate, RoomCode, RoomState, StartGame, StartGameRequest } from 'common';\n\nimport { empty_state, Game, new_game, play_local, reactive_state } from '.';\nimport { GameRules, UserPreferences } from './config';\n\ninterface Member {\n  name: string;\n  game: Game | null;\n  winner: boolean;\n}\n\ninterface RemoteState {\n  code: string | null;\n\n  local: Game | null;\n  index: number;\n  members: Member[];\n\n  start_game(rules: GameRules): void;\n}\n\ntype Hook<T> = T extends (...args: infer T) => infer R ? (...args: T) => void : never;\n\nfunction observe<Args extends any[], R, O extends { [k in K]: (...args: Args) => R }, K extends keyof O>(target: O, key: K, hook: Hook<O[K]>) {\n  let original = target[key];\n  target[key] = ((...args) => {\n    let result = original(...args);\n    hook(...args);\n    return result;\n  }) as O[K];\n}\n\nexport function create_room(name: string, user: UserPreferences, code: string | null) {\n  const url = new URL(localStorage.getItem('mfro:tetris-server')\n    ?? 'wss://api.mfro.me/tetris/join');\n\n  const state: RemoteState = shallowReactive({\n    local: null,\n    index: 0,\n    members: [],\n\n    code: code,\n    state: 0,\n\n    start_game(rules: GameRules) {\n      let seed = alea(Math.random()).uint32();\n      send(socket, StartGameRequest, { seed, rules: GameRules.save(rules) });\n    },\n  });\n\n  url.searchParams.set('name', name);\n  if (state.code) {\n    url.searchParams.set('code', state.code);\n  }\n\n  let socket = new WebSocket(url.toString());\n\n  function check_exit() {\n    let playing = state.members.filter((m, i) => m.game && !m.game.state.dead);\n    if (playing.length == 1) {\n      playing[0].winner = true;\n    }\n\n    if (playing.length == 0 || (playing.length == 1 && state.members.length > 1)) {\n      state.local = null;\n      for (let member of state.members) {\n        member.game = null;\n      }\n    }\n  }\n\n  let cleanup: (() => void) | null = null;\n  on(receive(socket, StartGame), (config) => {\n    cleanup?.();\n\n    let rules = GameRules.load(config.rules);\n\n    let s = reactive_state(empty_state(rules, config.seed))\n    state.local = new_game(rules, s);\n\n    observe(state.local, 'hold', () => send(socket, ClientUpdate, { type: 'hold' }));\n    observe(state.local, 'drop', (distance) => send(socket, ClientUpdate, { type: 'drop', distance }));\n    observe(state.local, 'shift', (dir) => send(socket, ClientUpdate, { type: 'shift', dir }));\n    observe(state.local, 'rotate', (dir) => send(socket, ClientUpdate, { type: 'rotate', dir }));\n    observe(state.local, 'lock_down', () => send(socket, ClientUpdate, { type: 'lock_down' }));\n    observe(state.local, 'clear_lines', (i) => send(socket, ClientUpdate, { type: 'send_lines', count: garbage(i.length) }));\n    observe(state.local, 'apply_garbage', () => send(socket, ClientUpdate, { type: 'apply_garbage' }));\n    observe(state.local, 'new_falling', () => send(socket, ClientUpdate, { type: 'new_falling' }));\n    observe(state.local, 'end_game', () => {\n      send(socket, ClientUpdate, { type: 'end_game' });\n      check_exit();\n    });\n\n    for (let i = 0; i < config.players; ++i) {\n      state.members[i].winner = false;\n\n      if (i == state.index) {\n        state.members[i].game = state.local;\n      } else {\n        let s = reactive_state(empty_state(rules, config.seed))\n        state.members[i].game = new_game(rules, s);\n      }\n    }\n\n    cleanup = play_local(user, state.local);\n  });\n\n  on(receive(socket, BroadcastUpdate), ([index, update]) => {\n    let target = state.members[index].game!;\n    if (target == state.local && update.type != 'send_lines') return;\n\n    switch (update.type) {\n      case 'hold': target.hold(); break;\n      case 'drop': target.drop(update.distance); break;\n      case 'shift': target.shift(update.dir); break;\n      case 'rotate': target.rotate(update.dir); break;\n      case 'lock_down': target.lock_down(); break;\n      case 'apply_garbage': target.apply_garbage(); break;\n      case 'new_falling': target.new_falling(); break;\n      case 'end_game': target.end_game(); check_exit(); break;\n\n      case 'send_lines':\n        let next = state.members[(index + 1) % state.members.length].game!;\n        next.state.garbage_pending.push(update.count);\n        break;\n    }\n  });\n\n  on(receive(socket, RoomCode), code => {\n    if (code != state.code) {\n      const url = new URL(window.location.href);\n      url.searchParams.delete('code');\n      window.history.replaceState(null, document.title, url.pathname + url.search);\n    }\n\n    state.code = code;\n  });\n\n  on(receive(socket, RoomState), ({ index, names }) => {\n    cleanup?.();\n\n    state.members = names.map(name => ({ name, game: null, winner: false }));\n    state.index = index;\n\n    if (state.members.length > 1) {\n      const url = new URL(window.location.href);\n      url.searchParams.set('code', state.code!);\n      window.history.replaceState(null, document.title, url.pathname + url.search);\n    }\n\n    check_exit();\n  });\n\n  return state;\n}\n\nfunction garbage(count: number) {\n  if (count == 4)\n    return 4;\n\n  return count - 1;\n}\n","import { render } from \"./landing.vue?vue&type=template&id=46a41d5a\"\nimport script from \"./landing.vue?vue&type=script&lang=js\"\nexport * from \"./landing.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","<template>\n  <v-flex column grow align-center class=\"mt-6\">\n    <v-card class=\"mb-4\">\n      <v-text-field label=\"Code\" v-model=\"code\" />\n\n      <v-text-field label=\"Name\" v-model=\"name\" />\n\n      <v-flex justify-center class=\"my-2\">\n        <v-button text color=\"primary\" :disabled=\"!valid\" @click=\"submit()\">\n          <span>Join lobby</span>\n          <v-icon class=\"ml-3\">arrow_forward</v-icon>\n        </v-button>\n      </v-flex>\n    </v-card>\n  </v-flex>\n</template>\n\n<script>\nimport { computed, inject, shallowRef } from 'vue';\n\nimport { create_room } from '@/tetris/remote';\n\nexport default {\n  name: 'joining',\n\n  emits: ['room'],\n  props: {\n    code: String,\n  },\n\n  setup(props, { emit }) {\n    const name = shallowRef(localStorage.getItem('mfro:user-name') ?? '');\n    const code = shallowRef(props.code);\n\n    const valid = computed(() => {\n      return name.value != '';\n    });\n\n    const user_prefs = inject('user_prefs');\n\n    return {\n      name,\n      code,\n      valid,\n\n      submit() {\n        localStorage.setItem('mfro:user-name', name.value);\n        let room = create_room(name.value, user_prefs.value, code.value);\n        emit('room', room);\n      },\n    };\n  },\n};\n</script>\n","import { render } from \"./joining.vue?vue&type=template&id=6b363fe4\"\nimport script from \"./joining.vue?vue&type=script&lang=js\"\nexport * from \"./joining.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./main.vue?vue&type=template&id=45e58851&scoped=true\"\nimport script from \"./main.vue?vue&type=script&lang=js\"\nexport * from \"./main.vue?vue&type=script&lang=js\"\n\nimport \"./main.vue?vue&type=style&index=0&id=45e58851&lang=scss\"\nimport \"./main.vue?vue&type=style&index=1&id=45e58851&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-45e58851\"\n\nexport default script","import { createApp } from 'vue'\nimport { framework } from '@mfro/vue-ui';\n\nimport root from './main.vue'\n\ncreateApp(root)\n  .use(framework)\n  .mount('#app')\n","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-0-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-0-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-0-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-boolean.vue?vue&type=style&index=0&id=a2427b56&lang=scss&module=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-0-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-0-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-0-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./config-boolean.vue?vue&type=style&index=0&id=a2427b56&lang=scss&module=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./main.vue?vue&type=style&index=0&id=45e58851&lang=scss\""],"sourceRoot":""}