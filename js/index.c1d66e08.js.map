{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/main.vue?6cd4","webpack:///./src/main.vue?1274","webpack:////home/mfro/code/web-apps/chess/vue-next/packages/vue/dist/vue.runtime.esm-bundler.js","webpack:///./src/main.vue","webpack:///./src/vec.ts","webpack:///./src/util.ts","webpack:///./src/input.ts","webpack:///./src/tetris/config.ts","webpack:///./src/tetris/render/basic.ts","webpack:///./src/tetris/render/pixi.ts","webpack:///./src/tetris/index.ts","webpack:///./src/view/config/config-game-rules.vue","webpack:///./src/view/config/config-rational.vue","webpack:///./src/view/config/config-rational.vue?a3e9","webpack:///./src/view/config/config-game-rules.vue?7b06","webpack:///./src/main.vue?7ad1","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","ref","align-center","class","x","y","Math","sqrt","this","atan2","a","Vec","polar","dir","scalar","b","dot","abs","acos","len","cos","sin","assert","condition","message","Error","zero","SPACE","LEFT","UP","SHIFT","DOWN","RIGHT","A","Z","S","X","C","Set","up_listeners","Map","down_listeners","isKeyDown","k","has","onKeyDown","handler","list","set","onKeyUp","addEventListener","e","keyCode","add","item","delete","constant","type","optional","inner","natural","description","rational","options","tetronimos","define","size","raw_tiles","rotation","map","rotations","v","I","O","T","J","L","all","wall_kicks","define_kick_data","raw","no_kick_data","base_kick_data","base_i_kick_data","asira_i_kick_data","standard","asira","none","delay","initial_delay","TileStyle","draw_styles","v1","context","position","kind","surroundings","style","colors","save","ghost","fillStyle","fillRect","disabled","filter","color","border","beginPath","lineCap","lineWidth","strokeStyle","moveTo","lineTo","stroke","restore","v2","globalAlpha","translate","left_inner","left_outer","right_inner","right_outer","IMAGE_STRIDE","image_offset","around","index","scale","floor","render_tilesheets","render","callback","bytes","TextEncoder","encode","toString","crypto","subtle","digest","then","hash_raw","hash","Array","from","Uint8Array","padStart","join","localStorage","getItem","cache","JSON","parse","console","log","styles","normal","canvas","document","createElement","width","height","getContext","clearRect","offset","url","toDataURL","setItem","stringify","game","unit_size","pixel","textures","tile_at","pos","rules","field_size","state","field","draw_tile","base","sprite","texture","SpritePool","container","sprites","removeChild","offsets","adj","every","eq","addChild","draw_ui","src","g","topleft","botrite","thickness","lineStyle","pool","hold_available","clear","center","parts","pieces","id","minX","reduce","min","Infinity","minY","maxX","max","maxY","draw_tetronimo","immediate","draw_background","beginFill","drawRect","endFill","app","view","transparent","performance","now","tilesheets","forEach","sheet","loader","load","onLoad","once","resources","baseTexture","root","background","holding","queue","fall_queue","stage","falling","hard_drop_position","empty_row","row","empty_field","new_game","reactive_game","track","trigger","run_game","user","down","next_id","fall_time","move_reset","repeating","shift_left","shift_right","repeat_shift","repeat_delay","dead","new_falling","bag_preview","random","ceil","move_reset_limit","collide","clearInterval","cancel","try_drop","part","tile","bottom","lock_down","is_on_ground","try_move_reset","hold","next_fall","unshift","change","autoshift","rotate","kicks","kick_info","kick","hard_drop","press_shift","release_shift","setInterval","update","fall_delay","lock_delay","soft_drop","cleared","assign","tetris","pixi_render","title","column","align-baseline","grow","justify-center","modelValue","solo","small","top","bot","emits","props","String","Number","setup","emit","num","parseInt","components","configRational","configGameRules","__scopeId","use","mount"],"mappings":"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","file":"js/index.c1d66e08.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"index\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./main.vue?vue&type=style&index=0&id=52d46b64&lang=scss\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./main.vue?vue&type=style&index=1&id=52d46b64&lang=scss&scoped=true\"","import { setDevtoolsHook, initCustomFormatter, warn } from '@vue/runtime-dom';\nexport * from '@vue/runtime-dom';\nimport { getGlobalThis } from '@vue/shared';\n\nfunction initDev() {\r\n    const target = getGlobalThis();\r\n    target.__VUE__ = true;\r\n    setDevtoolsHook(target.__VUE_DEVTOOLS_GLOBAL_HOOK__);\r\n    {\r\n        initCustomFormatter();\r\n    }\r\n}\n\n// This entry exports the runtime only, and is built as\r\nif ((process.env.NODE_ENV !== 'production') || __VUE_PROD_DEVTOOLS__) {\r\n    initDev();\r\n}\r\nconst compile = () => {\r\n    if ((process.env.NODE_ENV !== 'production')) {\r\n        warn(`Runtime compilation is not supported in this build of Vue.` +\r\n            ( ` Configure your bundler to alias \"vue\" to \"vue/dist/vue.esm-bundler.js\".`\r\n                ) /* should not happen */);\r\n    }\r\n};\n\nexport { compile };\n","<template>\n  <v-app align-center class=\"pa-6\">\n    <!-- <config-game-rules /> -->\n    <canvas ref=\"canvas\" />\n  </v-app>\n</template>\n\n<script>\nimport { onMounted, shallowRef } from 'vue';\n\nimport { tetris } from './tetris';\n\nimport configGameRules from './view/config/config-game-rules';\n\nexport default {\n  name: 'tetris',\n\n  components: {\n    configGameRules\n  },\n\n  setup() {\n    let canvas = shallowRef();\n\n    onMounted(() => {\n      tetris(canvas.value);\n    });\n\n    return { canvas };\n  },\n};\n</script>\n\n<style lang=\"scss\">\n#app {\n  width: 100vw;\n  height: 100vh;\n}\n</style>\n\n<style lang=\"scss\" scoped>\ncanvas {\n}\n</style>\n","export class Vec {\n  static zero = new Vec(0, 0);\n\n  constructor(\n    readonly x: number,\n    readonly y: number,\n  ) { }\n\n  get len() {\n    return Math.sqrt(this.x * this.x + this.y * this.y);\n  }\n\n  get dir() {\n    return Math.atan2(this.y, this.x);\n  }\n\n  static norm(a: Vec) {\n    return Vec.polar(1, a.dir);\n  }\n\n  static scale(a: Vec, scalar: number) {\n    return new Vec(a.x * scalar, a.y * scalar);\n  }\n\n  static add(a: Vec, b: Vec) {\n    return new Vec(a.x + b.x, a.y + b.y);\n  }\n\n  static dot(a: Vec, b: Vec) {\n    return a.x * b.x + a.y * b.y;\n  }\n\n  static eq(a: Vec, b: Vec) {\n    return a.x == b.x && a.y == b.y;\n  }\n\n  static delta(a: Vec, b: Vec) {\n    let dot = Vec.dot(a, b);\n    let abs = Math.acos(dot / a.len / b.len);\n    if (a.y * b.x > a.x * b.y)\n      return -abs;\n    return abs;\n  }\n\n  static polar(len: number, dir: number) {\n    return new Vec(\n      Math.cos(dir) * len,\n      Math.sin(dir) * len\n    );\n  }\n}\n","export function assert(condition: boolean, message: string): asserts condition {\n  if (!condition) {\n    debugger;\n    throw new Error(message);\n  }\n}\n\nexport function zip<T1, T2>(a: T1[], b: T2[]): [T1, T2][] {\n  if (a.length != b.length)\n    throw new Error('invalid zip');\n\n  return a.map((v, i) => [v, b[i]]);\n}\n","export const\n  SPACE = 32,\n  ENTER = 13,\n  LEFT = 37,\n  UP = 38,\n  SHIFT = 16,\n  DOWN = 40,\n  RIGHT = 39,\n  A = 65,\n  Z = 90,\n  S = 83,\n  X = 88,\n  C = 67;\n\nlet down = new Set<number>();\n\nlet up_listeners = new Map<number, (() => void)[]>();\nlet down_listeners = new Map<number, (() => void)[]>();\n\nwindow.addEventListener('keydown', e => {\n  if (down.has(e.keyCode))\n    return;\n\n  // console.log(e.keyCode);\n  down.add(e.keyCode);\n\n  let list = down_listeners.get(e.keyCode);\n  if (!list) return;\n\n  for (let item of list) {\n    item();\n  }\n});\n\nwindow.addEventListener('keyup', e => {\n  down.delete(e.keyCode);\n\n  let list = up_listeners.get(e.keyCode);\n  if (!list) return;\n\n  for (let item of list) {\n    item();\n  }\n});\n\nexport function isKeyDown(k: number) {\n  return down.has(k);\n}\n\nexport function onKeyDown(key: number, handler: () => void) {\n  let list = down_listeners.get(key);\n  if (!list) down_listeners.set(key, list = []);\n  list.push(handler);\n}\n\nexport function onKeyUp(key: number, handler: () => void) {\n  let list = up_listeners.get(key);\n  if (!list) up_listeners.set(key, list = []);\n  list.push(handler);\n}\n","import { Vec } from '@/vec';\n\nimport { TetronimoKind, Tile, Tetronimo } from '.';\n\nexport namespace tetronimos {\n  function define(size: number, raw_tiles: [number, number][]): TetronimoKind {\n    let rotation = raw_tiles.map(t => new Vec(t[0], t[1]));\n    let rotations = [rotation];\n\n    for (let i = 0; i < 3; ++i) {\n      rotation = rotation.map(v => new Vec(size - 1 - v.y, v.x));\n      rotations.push(rotation);\n    }\n\n    return {\n      size,\n      rotations,\n    };\n  }\n\n  export const I = define(4, [[0, 1], [1, 1], [2, 1], [3, 1]]);\n  export const O = define(2, [[0, 0], [0, 1], [1, 0], [1, 1]]);\n  export const T = define(3, [[1, 0], [0, 1], [1, 1], [2, 1]]);\n  export const J = define(3, [[0, 0], [0, 1], [1, 1], [2, 1]]);\n  export const L = define(3, [[2, 0], [0, 1], [1, 1], [2, 1]]);\n  export const S = define(3, [[1, 0], [2, 0], [0, 1], [1, 1]]);\n  export const Z = define(3, [[0, 0], [1, 0], [1, 1], [2, 1]]);\n\n  export const all = [I, O, T, J, L, S, Z];\n}\n\nexport namespace wall_kicks {\n  function define_kick_data(raw: [number, number][][]) {\n    return raw.map(a => [Vec.zero, ...a.map(a => new Vec(a[0], -a[1]))]);\n  }\n\n  const no_kick_data = define_kick_data([\n    [[0, 0]], // 0 -> 1\n    [[0, 0]], // 1 -> 0\n    [[0, 0]], // 1 -> 2\n    [[0, 0]], // 2 -> 1\n    [[0, 0]], // 2 -> 3\n    [[0, 0]], // 3 -> 2\n    [[0, 0]], // 3 -> 0\n    [[0, 0]], // 0 -> 3\n  ]);\n\n  const base_kick_data = define_kick_data([\n    [[0, 0], [-1, 0], [-1, +1], [0, -2], [-1, -2]], // 0 -> 1\n    [[0, 0], [+1, 0], [+1, -1], [0, +2], [+1, +2]], // 1 -> 0\n    [[0, 0], [+1, 0], [+1, -1], [0, +2], [+1, +2]], // 1 -> 2\n    [[0, 0], [-1, 0], [-1, +1], [0, -2], [-1, -2]], // 2 -> 1\n    [[0, 0], [+1, 0], [+1, +1], [0, -2], [+1, -2]], // 2 -> 3\n    [[0, 0], [-1, 0], [-1, -1], [0, +2], [-1, +2]], // 3 -> 2\n    [[0, 0], [-1, 0], [-1, -1], [0, +2], [-1, +2]], // 3 -> 0\n    [[0, 0], [+1, 0], [+1, +1], [0, -2], [+1, -2]], // 0 -> 3\n  ]);\n\n  const base_i_kick_data = define_kick_data([\n    [[0, 0], [-2, 0], [+1, 0], [-2, -1], [+1, +2]], // 0 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 1 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 1 -> 2\n    [[0, 0], [+1, 0], [-2, 0], [+1, -2], [-2, +1]], // 2 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 2 -> 3\n    [[0, 0], [-2, 0], [+1, 0], [-2, -1], [+1, +2]], // 3 -> 2\n    [[0, 0], [+1, 0], [-2, 0], [+1, -2], [-2, +1]], // 3 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 0 -> 3\n  ]);\n\n  const asira_i_kick_data = define_kick_data([\n    [[0, 0], [-2, 0], [+1, 0], [+1, +2], [-2, -1]], // 0 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -2]], // 1 -> 0\n    [[0, 0], [-1, 0], [+2, 0], [-1, +2], [+2, -1]], // 1 -> 2\n    [[0, 0], [-2, 0], [+1, 0], [-2, +1], [+1, -1]], // 2 -> 1\n    [[0, 0], [+2, 0], [-1, 0], [+2, +1], [-1, -1]], // 2 -> 3\n    [[0, 0], [+1, 0], [-2, 0], [+1, +2], [-2, -1]], // 3 -> 2\n    [[0, 0], [-2, 0], [+1, 0], [-2, +1], [+1, -2]], // 3 -> 0\n    [[0, 0], [+2, 0], [-1, 0], [-1, +2], [+2, -1]], // 0 -> 3\n  ]);\n\n  export const standard = new Map([\n    [tetronimos.I, base_i_kick_data],\n    [tetronimos.O, base_kick_data],\n    [tetronimos.T, base_kick_data],\n    [tetronimos.J, base_kick_data],\n    [tetronimos.L, base_kick_data],\n    [tetronimos.S, base_kick_data],\n    [tetronimos.Z, base_kick_data],\n  ]);\n\n  export const asira = new Map([\n    [tetronimos.I, asira_i_kick_data],\n    [tetronimos.O, base_kick_data],\n    [tetronimos.T, base_kick_data],\n    [tetronimos.J, base_kick_data],\n    [tetronimos.L, base_kick_data],\n    [tetronimos.S, base_kick_data],\n    [tetronimos.Z, base_kick_data],\n  ]);\n\n  export const none = new Map([\n    [tetronimos.I, no_kick_data],\n    [tetronimos.O, no_kick_data],\n    [tetronimos.T, no_kick_data],\n    [tetronimos.J, no_kick_data],\n    [tetronimos.L, no_kick_data],\n    [tetronimos.S, no_kick_data],\n    [tetronimos.Z, no_kick_data],\n  ]);\n}\n\nexport interface GameRules {\n  // size of the visible playfield\n  field_size: Vec;\n\n  // updates between the falling piece moving down\n  fall_delay: number;\n  // delay before the falling pieces locks into place\n  lock_delay: number;\n  // limit on how many times rotating or shifting the piece can reset the lock delay. null indicates no limit\n  move_reset_limit: null | number;\n\n  // wall kick data\n  wall_kicks: Map<TetronimoKind, Vec[][]>;\n\n  // number of Tetronimos to pre-generate in the queue\n  bag_preview: 5,\n}\n\nexport interface UserConfig {\n  // autoshift information for repeating shifts while input is held\n  autoshift: null | { delay: number, initial_delay: number };\n  // multiplier for fall_delay while soft drop is held\n  soft_drop: number;\n}\n\nexport interface GameState {\n  field: (Tile | null)[][],\n\n  falling: Tetronimo | null,\n  fall_queue: TetronimoKind[],\n\n  holding: TetronimoKind | null,\n  hold_available: boolean,\n}\n\nexport type Option =\n  | { type: 'constant', value: any }\n  | { type: 'optional', inner: Option }\n  | { name: string, description: string } & (\n    | { type: 'natural' }\n    | { type: 'rational' }\n    | { type: 'select', options: [string, any][] }\n    | { type: 'object', inner: Definition<any> }\n  );\n\nfunction constant(value: any): Option {\n  return { type: 'constant', value };\n}\n\nfunction optional(inner: Option): Option {\n  return { type: 'optional', inner };\n}\n\nfunction natural(name: string, description: string): Option {\n  return { type: 'natural', name, description };\n}\n\nfunction rational(name: string, description: string): Option {\n  return { type: 'rational', name, description };\n}\n\nfunction select(name: string, description: string, options: [string, any][]): Option {\n  return { type: 'select', name, description, options };\n}\n\nfunction object<T>(name: string, description: string, inner: Definition<T>): Option {\n  return { type: 'object', name, description, inner };\n}\n\ntype Definition<T> = {\n  [K in keyof T]: Option;\n}\n\nexport const GameDefinition: Definition<GameRules> = {\n  field_size: constant(new Vec(10, 40)),\n\n  fall_delay: rational('Drop Delay', 'Drop delay for falling pieces (frames per tile)'),\n\n  lock_delay: rational('Lock Delay', 'Lock down delay (frames)'),\n\n  move_reset_limit: optional(rational('Move Reset Limit', 'Maximum number of times the Lock Delay can be reset by successful shifts or rotates')),\n\n  wall_kicks: select('Wall Kicks', 'Wall kick data', [\n    ['No Kicks', wall_kicks.none],\n    ['Standard', wall_kicks.standard],\n    ['Asira', wall_kicks.asira],\n  ]),\n\n  bag_preview: natural('Preview Size', 'Number of pieces in the preview'),\n};\n\nexport const UserDefinition: Definition<UserConfig> = {\n  autoshift: optional(object('Autoshift', 'Configure repeated shifts while input is held', {\n    delay: rational('Delay', 'Delay between repeated shifts (frames)'),\n    initial_delay: rational('Initial Delay', 'Delay after first shift before repeating (frames)'),\n  })),\n\n  soft_drop: rational('Soft Drop Multiplier', 'Multiplier for Drop Delay while soft dropping'),\n}\n","import { Vec } from '@/vec';\nimport { assert } from '@/util';\n\nimport { TetronimoKind, Tetronimo, pieces, Game } from '..';\nimport { tetronimos } from '../config';\n\n/** draw a single tile of a tetronimo */\nexport const draw_styles = {\n  v1(context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, surroundings: boolean[], style: TileStyle) {\n    const colors = new Map([\n      [tetronimos.I, '#31c7ef'],\n      [tetronimos.O, '#e39f02'],\n      [tetronimos.T, '#af298a'],\n      [tetronimos.J, '#2141c6'],\n      [tetronimos.L, '#e35b02'],\n      [tetronimos.S, '#59b101'],\n      [tetronimos.Z, '#d70f37'],\n    ]);\n\n    const p = position;\n\n    context.save();\n    if (style == TileStyle.ghost) {\n      context.fillStyle = 'white';\n      context.fillRect(p.x, p.y, 1, 1);\n    } else if (style == TileStyle.disabled) {\n      context.filter = 'grayscale(100%)';\n    } else {\n      let color = colors.get(kind);\n      assert(color != null, `no color for piece`);\n      context.fillStyle = color;\n      context.fillRect(p.x, p.y, 1, 1);\n    }\n\n    const border = 1 / 8;\n\n    context.beginPath();\n    context.lineCap = 'butt';\n    context.lineWidth = border;\n    context.strokeStyle = '#00000040';\n\n    if (surroundings[0]) {\n      context.moveTo(p.x, p.y + border / 2);\n      context.lineTo(p.x + border / 2, p.y + border / 2);\n      context.lineTo(p.x + border / 2, p.y);\n    }\n\n    if (surroundings[1]) {\n      context.moveTo(p.x, p.y + border / 2);\n      context.lineTo(p.x + 1, p.y + border / 2);\n    }\n\n    if (surroundings[2]) {\n      context.moveTo(p.x + 1 - border / 2, p.y);\n      context.lineTo(p.x + 1 - border / 2, p.y + border / 2);\n      context.lineTo(p.x + 1, p.y + border / 2);\n    }\n\n    if (surroundings[3]) {\n      context.moveTo(p.x - border / 2 + 1, p.y);\n      context.lineTo(p.x - border / 2 + 1, p.y + 1);\n    }\n\n    if (surroundings[4]) {\n      context.moveTo(p.x + 1, p.y + 1 - border / 2);\n      context.lineTo(p.x + 1 - border / 2, p.y + 1 - border / 2);\n      context.lineTo(p.x + 1 - border / 2, p.y + 1);\n    }\n\n    if (surroundings[5]) {\n      context.moveTo(p.x + 1, p.y - border / 2 + 1);\n      context.lineTo(p.x, p.y - border / 2 + 1);\n    }\n\n    if (surroundings[6]) {\n      context.moveTo(p.x + border / 2, p.y + 1);\n      context.lineTo(p.x + border / 2, p.y + 1 - border / 2);\n      context.lineTo(p.x, p.y + 1 - border / 2);\n    }\n\n    if (surroundings[7]) {\n      context.moveTo(p.x + border / 2, p.y + 1);\n      context.lineTo(p.x + border / 2, p.y);\n    }\n\n    // context.strokeStyle = kind.color;\n    // context.stroke();\n\n    context.strokeStyle = '#00000040';\n    context.stroke();\n\n    context.filter = 'none';\n    context.restore();\n  },\n\n  v2(context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, surroundings: boolean[], style: TileStyle) {\n    const border = 1 / 8;\n\n    const colors = new Map([\n      [tetronimos.I, ['#31c7ef', '#48e0ff', '#20b0e0']],\n      [tetronimos.O, ['#f7d308', '#ffec1c', '#e8c000']],\n      [tetronimos.T, ['#ad4d9c', '#c658b4', '#983888']],\n      [tetronimos.J, ['#5a65ad', '#6680cc', '#4857a0']],\n      [tetronimos.L, ['#ef7921', '#ff9030', '#e06810']],\n      [tetronimos.S, ['#42b642', '#48d048', '#30a030']],\n      [tetronimos.Z, ['#ef2029', '#ff4848', '#d01818']],\n    ]);\n\n    const p = position;\n\n    let color = colors.get(kind);\n    assert(color != null, `no color for piece`);\n\n    context.save();\n    if (style == TileStyle.ghost) {\n      context.fillStyle = 'white';\n      context.fillRect(p.x, p.y, 1, 1);\n      context.globalAlpha = 0.4;\n    } else if (style == TileStyle.disabled) {\n      context.filter = 'grayscale(100%)';\n    }\n\n    context.translate(p.x, p.y);\n\n    const left_inner = border;\n    const left_outer = border / 2;\n    const right_inner = 1 - border;\n    const right_outer = 1 - border / 2;\n\n    context.fillStyle = color[0];\n    context.fillRect(left_inner, left_inner, 1 - 2 * border, 1 - 2 * border);\n\n    context.lineCap = 'butt';\n    context.lineWidth = border;\n\n    context.beginPath();\n    context.moveTo(left_outer, right_inner);\n    context.lineTo(left_outer, left_inner);\n    context.strokeStyle = surroundings[7] ? color[1] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(left_inner, left_outer);\n    context.lineTo(right_inner, left_outer);\n    context.strokeStyle = surroundings[1] ? color[1] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(0, left_outer);\n    context.lineTo(left_outer, left_outer);\n    context.lineTo(left_outer, 0);\n    context.strokeStyle = surroundings[0] || surroundings[7] || surroundings[1] ? color[1] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(right_outer, left_inner);\n    context.lineTo(right_outer, right_inner);\n    context.strokeStyle = surroundings[3] ? color[2] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(right_inner, right_outer);\n    context.lineTo(left_inner, right_outer);\n    context.strokeStyle = surroundings[5] ? color[2] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(1, right_outer);\n    context.lineTo(right_outer, right_outer);\n    context.lineTo(right_outer, 1);\n    context.strokeStyle = surroundings[4] || surroundings[3] || surroundings[5] ? color[2] : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(right_outer, 0);\n    context.lineTo(right_outer, left_outer);\n    context.lineTo(1, left_outer);\n    context.strokeStyle = surroundings[2] && surroundings[1] && surroundings[3] ? color[0]\n      : surroundings[1] ? color[1]\n        : surroundings[3] ? color[2]\n          : surroundings[2] ? color[2]\n            : color[0];\n    context.stroke();\n\n    context.beginPath();\n    context.moveTo(left_outer, 1);\n    context.lineTo(left_outer, right_outer);\n    context.lineTo(0, right_outer);\n    context.strokeStyle = surroundings[6] && surroundings[7] && surroundings[5] ? color[0]\n      : surroundings[7] ? color[1]\n        : surroundings[5] ? color[2]\n          : surroundings[6] ? color[1]\n            : color[0];\n    context.stroke();\n\n    context.filter = 'none';\n    context.restore();\n  },\n};\n\nexport enum TileStyle {\n  normal,\n  ghost,\n  disabled,\n}\n\nconst IMAGE_STRIDE = 256;\nexport function image_offset(around: boolean[], style: TileStyle, size: number) {\n  let index = style << 8;\n\n  for (let i = 0; i < 8; ++i) {\n    if (around[i]) {\n      index |= (1 << i);\n    }\n  }\n\n  // return Vec.scale(new Vec(x, style), size);\n  return Vec.scale(new Vec(index % IMAGE_STRIDE, Math.floor(index / IMAGE_STRIDE)), size);\n}\n\ninterface ImageCache {\n  hash: string;\n  list: string[];\n}\n\nexport function render_tilesheets(size: number, render: (context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) => void, callback: (s: string[]) => void) {\n  let bytes = new TextEncoder().encode(render.toString());\n  window.crypto.subtle.digest('SHA-256', bytes).then(hash_raw => {\n    let hash = Array.from(new Uint8Array(hash_raw))\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n    // let hash = crypto.createHash('sha256')\n    //   .update(render.toString())\n    //   .digest('hex');\n\n    let raw = localStorage.getItem('mfro:tetris-tilesheet');\n    if (raw) {\n      let cache: ImageCache = JSON.parse(raw);\n      if (cache.hash == hash) {\n        console.log(`tilesheet hash match ${hash}`);\n        callback(cache.list);\n        return;\n      } else {\n        console.log(`tilesheet hash match ${cache.hash} expected ${hash}`);\n      }\n    }\n\n    const styles = [TileStyle.normal, TileStyle.ghost, TileStyle.disabled];\n\n    let canvas = document.createElement('canvas');\n    canvas.width = size * IMAGE_STRIDE;\n    canvas.height = size * styles.length * (256 / IMAGE_STRIDE);\n\n    let context = canvas.getContext('2d');\n    assert(context != null, 'no context');\n\n    context.scale(size, size);\n\n    let list: string[] = [];\n\n    for (let kind of tetronimos.all) {\n      context!.clearRect(0, 0, canvas.width, canvas.height);\n\n      for (let style of styles) {\n        for (let i = 0; i < 256; ++i) {\n          let around = [];\n          for (let j = 0; j < 8; ++j) around[j] = (i & (1 << j)) != 0;\n\n          let offset = image_offset(around, style, 1);\n          render(context!, offset, kind, around, style);\n        }\n      }\n\n      let url = canvas.toDataURL();\n      list.push(url);\n      if (list.length == tetronimos.all.length) {\n        localStorage.setItem('mfro:tetris-tilesheet', JSON.stringify({ hash, list }))\n        callback(list);\n      }\n    }\n  });\n}\n\nfunction prerender(size: number, render: (context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) => void) {\n  let images: HTMLImageElement[] = [];\n  // let images = render_tilesheets(size, render).map(s => {\n  //   let image = new Image();\n  //   image.src = s;\n  //   return image;\n  // });\n\n  return (context: CanvasRenderingContext2D, position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) => {\n    let sheet = images[tetronimos.all.indexOf(kind)];\n    let offset = image_offset(around, style, size);\n\n    context.drawImage(sheet, offset.x, offset.y, size, size, position.x, position.y, 1, 1)\n  };\n}\n\nexport function render(canvas: HTMLCanvasElement, game: Game) {\n  const unit_size = 32;\n  const pixel = 1 / unit_size;\n\n  // const render_tile = draw_tile.v2;\n  const render_tile = prerender(unit_size, draw_styles.v2);\n\n  canvas.width = (game.rules.field_size.x + 12) * unit_size;\n  canvas.height = (game.rules.field_size.y / 2) * unit_size;\n  canvas.style.width = `${canvas.width}px`;\n  canvas.style.height = `${canvas.height}px`;\n\n  const context = canvas.getContext('2d')!;\n  assert(context != null, 'no context');\n\n  context.imageSmoothingEnabled = false;\n\n  function tile_at(pos: Vec) {\n    if (pos.x < 0 || pos.x >= game.rules.field_size.x\n      || pos.y < 0 || pos.y >= game.rules.field_size.y)\n      return null;\n\n    return game.state.field[pos.y][pos.x];\n  }\n\n  const adj8 = [\n    new Vec(-1, -1),\n    new Vec(0, -1),\n    new Vec(1, -1),\n    new Vec(1, 0),\n    new Vec(1, 1),\n    new Vec(0, 1),\n    new Vec(-1, 1),\n    new Vec(-1, 0),\n  ];\n\n  /** draw a a tetronimo */\n  function draw_tetronimo(t: Tetronimo, style: TileStyle) {\n    for (let offset of t.kind.rotations[t.rotation]) {\n      let position = Vec.add(t.position, offset);\n\n      let diff = adj8.map(adj =>\n        t.kind.rotations[t.rotation]\n          .every(v => !Vec.eq(v, Vec.add(offset, adj)))\n      );\n\n      render_tile(context, position, t.kind, diff, style);\n    }\n  }\n\n  /** draw a tetronimo in the UI */\n  function draw_ui(kinds: TetronimoKind[], center: Vec) {\n    let topleft = Vec.add(center, new Vec(-2, -2));\n    let botrite = Vec.add(center, new Vec(2, -1 + 3 * kinds.length));\n\n    context.lineCap = 'butt';\n    context.lineJoin = 'miter';\n    context.strokeStyle = 'gray'\n    context.beginPath();\n\n    const thickness = 2 * pixel;\n    const length = 8 * pixel;\n\n    context.lineWidth = thickness;\n\n    context.moveTo(topleft.x + thickness / 2, topleft.y + length);\n    context.lineTo(topleft.x + thickness / 2, topleft.y + thickness / 2);\n    context.lineTo(topleft.x + length, topleft.y + thickness / 2);\n\n    context.moveTo(botrite.x - length, topleft.y + thickness / 2);\n    context.lineTo(botrite.x - thickness / 2, topleft.y + thickness / 2);\n    context.lineTo(botrite.x - thickness / 2, topleft.y + length);\n\n    context.moveTo(botrite.x - thickness / 2, botrite.y - length);\n    context.lineTo(botrite.x - thickness / 2, botrite.y - thickness / 2);\n    context.lineTo(botrite.x - length, botrite.y - thickness / 2);\n\n    context.moveTo(topleft.x + length, botrite.y - thickness / 2);\n    context.lineTo(topleft.x + thickness / 2, botrite.y - thickness / 2);\n    context.lineTo(topleft.x + thickness / 2, botrite.y - length);\n\n    context.stroke();\n\n    for (let kind of kinds) {\n      let parts = pieces({ id: -1, kind, position: Vec.zero, rotation: 0 });\n\n      let minX = parts.reduce((m, v) => Math.min(m, v.x), Infinity) + 0.5;\n      let minY = parts.reduce((m, v) => Math.min(m, v.y), Infinity) + 0.5;\n      let maxX = parts.reduce((m, v) => Math.max(m, v.x), -Infinity) + 0.5;\n      let maxY = parts.reduce((m, v) => Math.max(m, v.y), -Infinity) + 0.5;\n\n      let offset = new Vec(-(minX + maxX) / 2, -(minY + maxY) / 2);\n      let position = Vec.add(center, offset);\n\n      draw_tetronimo({ id: -1, kind, position, rotation: 0 }, TileStyle.normal);\n\n      center = Vec.add(center, new Vec(0, 3));\n    }\n  }\n\n  requestAnimationFrame(tick);\n  function tick() {\n    requestAnimationFrame(tick);\n\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    context.save();\n\n    context.scale(unit_size, unit_size);\n    context.translate(6, 0);\n\n    if (game.state.holding) {\n      context.save();\n      draw_ui([game.state.holding], new Vec(-3, 3));\n      context.restore();\n    }\n\n    if (game.rules.bag_preview > 0) {\n      draw_ui(game.state.fall_queue.slice(0, game.rules.bag_preview), new Vec(game.rules.field_size.x + 3, 3));\n    }\n\n    context.fillStyle = 'white';\n    context.fillRect(0, 0, game.rules.field_size.x, game.rules.field_size.y);\n\n    context.lineWidth = 1 * pixel;\n    context.strokeStyle = '#f4f4f4';\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      context.beginPath();\n      context.moveTo(x + 0.5 * pixel, 0);\n      context.lineTo(x + 0.5 * pixel, game.rules.field_size.y);\n      context.moveTo((x + 1) - 0.5 * pixel, 0);\n      context.lineTo((x + 1) - 0.5 * pixel, game.rules.field_size.y);\n      context.stroke();\n    }\n\n    for (let y = 0; y < game.rules.field_size.y; ++y) {\n      context.beginPath();\n      context.moveTo(0, y + 0.5 * pixel);\n      context.lineTo(game.rules.field_size.x, y + 0.5 * pixel);\n      context.moveTo(0, (y + 1) - 0.5 * pixel);\n      context.lineTo(game.rules.field_size.x, (y + 1) - 0.5 * pixel);\n      context.stroke();\n    }\n\n    context.translate(0, -game.rules.field_size.y / 2);\n\n    if (game.state.falling) {\n      let position = game.hard_drop_position(game.state.falling);\n      draw_tetronimo({ ...game.state.falling, position }, TileStyle.ghost);\n\n      draw_tetronimo(game.state.falling, TileStyle.normal);\n    }\n\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      for (let y = 0; y < game.rules.field_size.y; ++y) {\n        let t = game.state.field[y][x];\n        if (t == null) continue;\n\n        let position = new Vec(x, y);\n\n        let diff = adj8.map(adj => tile_at(Vec.add(position, adj))?.id != t!.id);\n\n        render_tile(context, new Vec(x, y), game.state.field[y][x]!.kind, diff, TileStyle.normal);\n      }\n    }\n\n    context.restore();\n  }\n}\n","import { Application, BaseTexture, Container, Graphics, Point, Rectangle, Sprite, Texture } from 'pixi.js';\nimport { watch, watchEffect } from 'vue';\n\nimport { Vec } from '@/vec';\n\nimport { TetronimoKind, Game, Tetronimo, pieces } from '..';\nimport { tetronimos } from '../config';\n\nimport { draw_styles, image_offset, render_tilesheets, TileStyle } from './basic';\n\nconst adj8 = [\n  new Vec(-1, -1),\n  new Vec(0, -1),\n  new Vec(1, -1),\n  new Vec(1, 0),\n  new Vec(1, 1),\n  new Vec(0, 1),\n  new Vec(-1, 1),\n  new Vec(-1, 0),\n];\n\nexport function render(canvas: HTMLCanvasElement, game: Game) {\n  const unit_size = 32;\n  const pixel = 1 / unit_size;\n\n  const textures = new Map<TetronimoKind, BaseTexture>();\n\n  function tile_at(pos: Vec) {\n    if (pos.x < 0 || pos.x >= game.rules.field_size.x\n      || pos.y < 0 || pos.y >= game.rules.field_size.y)\n      return null;\n\n    return game.state.field[pos.y][pos.x];\n  }\n\n  function draw_tile(position: Vec, kind: TetronimoKind, around: boolean[], style: TileStyle) {\n    let base = textures.get(kind)!;\n    let index = image_offset(around, style, unit_size);\n\n    let sprite = new Sprite();\n    sprite.scale = new Point(1 / unit_size, 1 / unit_size);\n    sprite.texture = new Texture(base, new Rectangle(index.x, index.y, unit_size, unit_size));\n    sprite.position = new Point(position.x, position.y);\n\n    return sprite;\n  }\n\n  class SpritePool {\n    sprites: Sprite[] = [];\n\n    constructor(\n      readonly container: Container,\n    ) { }\n\n    clear() {\n      for (let sprite of this.sprites)\n        this.container.removeChild(sprite);\n      this.sprites = [];\n    }\n\n    draw_tetronimo(t: Tetronimo, style: TileStyle) {\n      let offsets = t.kind.rotations[t.rotation];\n\n      for (let offset of t.kind.rotations[t.rotation]) {\n        let position = Vec.add(t.position, offset);\n\n        let around = adj8.map(adj =>\n          offsets\n            .every(v => !Vec.eq(v, Vec.add(offset, adj)))\n        );\n\n        let sprite = draw_tile(position, t.kind, around, style);\n        this.sprites.push(sprite);\n        this.container.addChild(sprite);\n      }\n    }\n  }\n\n  function draw_ui(src: () => (TetronimoKind | null)[]) {\n    let size = src().length;\n\n    let field = new Container();\n    field.scale = new Point(unit_size, unit_size);\n\n    let g = new Graphics();\n    field.addChild(g);\n    g.scale = new Point(1 / 32, 1 / 32);\n\n    let topleft = Vec.scale(new Vec(0, 0), unit_size);\n    let botrite = Vec.scale(new Vec(4, 1 + 3 * size), unit_size);\n\n    const thickness = 2;\n    const length = 8;\n\n    g.lineStyle(thickness, 0x808080, 1, 0);\n\n    g.moveTo(topleft.x, topleft.y + length);\n    g.lineTo(topleft.x, topleft.y);\n    g.lineTo(topleft.x + length, topleft.y);\n\n    g.moveTo(botrite.x - length, topleft.y);\n    g.lineTo(botrite.x, topleft.y);\n    g.lineTo(botrite.x, topleft.y + length);\n\n    g.moveTo(botrite.x, botrite.y - length);\n    g.lineTo(botrite.x, botrite.y);\n    g.lineTo(botrite.x - length, botrite.y);\n\n    g.moveTo(topleft.x + length, botrite.y);\n    g.lineTo(topleft.x, botrite.y);\n    g.lineTo(topleft.x, botrite.y - length);\n\n    let pool = new SpritePool(field);\n    watch(() => [src(), game.state.hold_available] as const, ([list, hold_available]) => {\n      pool.clear();\n\n      let center = new Vec(2, 2);\n\n      for (let kind of list) {\n        if (!kind) continue;\n\n        let parts = pieces({ id: -1, kind, position: Vec.zero, rotation: 0 });\n\n        let minX = parts.reduce((m, v) => Math.min(m, v.x), Infinity) + 0.5;\n        let minY = parts.reduce((m, v) => Math.min(m, v.y), Infinity) + 0.5;\n        let maxX = parts.reduce((m, v) => Math.max(m, v.x), -Infinity) + 0.5;\n        let maxY = parts.reduce((m, v) => Math.max(m, v.y), -Infinity) + 0.5;\n\n        let offset = new Vec(-(minX + maxX) / 2, -(minY + maxY) / 2);\n        let position = Vec.add(center, offset);\n\n        let style = list.length == 1 && !hold_available ? TileStyle.disabled : TileStyle.normal;\n\n        pool.draw_tetronimo({ id: -1, kind, position, rotation: 0 }, style);\n        center = Vec.add(center, new Vec(0, 3));\n      }\n    }, { immediate: true });\n\n    return field;\n  }\n\n  function draw_background(g: Graphics) {\n    g.beginFill(0xFFFFFF);\n    g.drawRect(0, 0, game.rules.field_size.x, game.rules.field_size.y);\n    g.endFill();\n\n    g.lineStyle(pixel, 0xf4f4f4);\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      g.moveTo(x + 0.5 * pixel, 0);\n      g.lineTo(x + 0.5 * pixel, game.rules.field_size.y);\n      g.moveTo((x + 1) - 0.5 * pixel, 0);\n      g.lineTo((x + 1) - 0.5 * pixel, game.rules.field_size.y);\n    }\n\n    for (let y = 0; y < game.rules.field_size.y; ++y) {\n      g.moveTo(0, y + 0.5 * pixel);\n      g.lineTo(game.rules.field_size.x, y + 0.5 * pixel);\n      g.moveTo(0, (y + 1) - 0.5 * pixel);\n      g.lineTo(game.rules.field_size.x, (y + 1) - 0.5 * pixel);\n    }\n  }\n\n  const app = new Application({\n    view: canvas,\n    width: unit_size * (game.rules.field_size.x + 12),\n    height: unit_size * (game.rules.field_size.y / 2),\n    transparent: true,\n  });\n\n  let s = performance.now();\n  render_tilesheets(unit_size, draw_styles.v2, tilesheets => {\n    let e = performance.now();\n    console.log(e - s);\n    tilesheets.forEach((sheet, i) => {\n      app.loader.add(i.toString(), sheet);\n    });\n    app.loader.load();\n  });\n\n  app.loader.onLoad.once(() => {\n    for (let i = 0; i < 7; ++i) {\n      let base = app.loader.resources[i]!.texture.baseTexture;\n      textures.set(tetronimos.all[i], base);\n    }\n\n    const root = new Container();\n\n    let field = new Container();\n    field.scale = new Point(unit_size, unit_size);\n    field.position = new Point(unit_size * 6, unit_size * (-game.rules.field_size.y / 2));\n\n    const background = new Graphics();\n    draw_background(background);\n\n    const holding = draw_ui(() => [game.state.holding]);\n    holding.position = new Point(unit_size * 1, unit_size * 1);\n\n    const queue = draw_ui(() => game.state.fall_queue.slice(0, 5));\n    queue.position = new Point(unit_size * (7 + game.rules.field_size.x), unit_size * 1);\n\n    field.addChild(background);\n    root.addChild(field);\n    root.addChild(queue);\n    root.addChild(holding);\n    app.stage.addChild(root);\n\n    for (let x = 0; x < game.rules.field_size.x; ++x) {\n      for (let y = 0; y < game.rules.field_size.y; ++y) {\n        let position = new Vec(x, y);\n        let sprite: Sprite | null = null;\n\n        watchEffect(() => {\n          if (sprite != null) {\n            field.removeChild(sprite);\n            sprite = null;\n          }\n\n          let t = game.state.field[y][x];\n          if (t != null) {\n            let around = adj8.map(adj => tile_at(Vec.add(position, adj))?.id != t!.id);\n            sprite = draw_tile(new Vec(x, y), t.kind, around, TileStyle.normal);\n            field.addChild(sprite);\n          }\n        });\n      }\n    }\n\n    let falling = new SpritePool(field);\n    watchEffect(() => {\n      falling.clear();\n\n      if (game.state.falling) {\n        let position = game.hard_drop_position(game.state.falling);\n        let ghost = { ...game.state.falling, position };\n        falling.draw_tetronimo(ghost, TileStyle.ghost);\n        falling.draw_tetronimo(game.state.falling, TileStyle.normal);\n      }\n    });\n  });\n}\n","import { customRef, reactive, shallowReactive, shallowRef } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { assert } from '@/util';\nimport { A, C, DOWN, isKeyDown, LEFT, onKeyDown, onKeyUp, RIGHT, S, SHIFT, SPACE, UP, X, Z } from '@/input';\n\nimport { GameRules, GameState, tetronimos, UserConfig, wall_kicks } from './config';\n\nimport { render as basic_render } from './render/basic';\nimport { render as pixi_render } from './render/pixi';\n\nexport interface Tile {\n  id: number;\n  kind: TetronimoKind;\n}\n\nexport interface Tetronimo {\n  id: number;\n  kind: TetronimoKind;\n  position: Vec;\n  rotation: number;\n}\n\nexport interface TetronimoKind {\n  size: number;\n  rotations: Vec[][];\n}\n\nexport interface Game {\n  rules: GameRules,\n  state: GameState,\n  hard_drop_position(t: Tetronimo): Vec;\n}\n\n/** get the absolute positions of all the pieces of a tetronimo */\nexport function pieces(t: Tetronimo): Vec[] {\n  return t.kind.rotations[t.rotation]\n    .map(v => Vec.add(t.position, v));\n}\n\n/** create an empty row */\nfunction empty_row(rules: GameRules) {\n  let row = [];\n  for (let x = 0; x < rules.field_size.x; ++x) {\n    row[x] = null;\n  }\n  return row;\n}\n\n/** create an empty field */\nfunction empty_field(rules: GameRules) {\n  let field = [];\n  for (let y = 0; y < rules.field_size.y; ++y) {\n    field[y] = empty_row(rules);\n  }\n  return field;\n}\n\n/** create a new game */\nfunction new_game(rules: GameRules): GameState {\n  return {\n    field: empty_field(rules),\n\n    falling: null,\n    fall_queue: [],\n    holding: null,\n    hold_available: true,\n  };\n}\n\nfunction reactive_game(inner: GameState): GameState {\n  let falling = inner.falling;\n\n  return reactive({\n    field: inner.field.map(row => shallowReactive(row)),\n\n    falling: customRef<typeof falling>((track, trigger) => ({\n      get: () => { track(); return falling; },\n      set: (v) => { falling = v && shallowReactive(v); trigger(); },\n    })),\n    fall_queue: shallowReactive([]),\n    holding: shallowRef(null),\n    hold_available: true,\n  });\n}\n\nfunction run_game(rules: GameRules, user: UserConfig, game: GameState): Game {\n  const down = new Vec(0, 1);\n  let next_id = 0;\n\n  let fall_time = 0;\n  let move_reset = 0;\n\n  let repeating = false;\n  let shift_left = false;\n  let shift_right = false;\n  let repeat_shift = 0 as 0 | 1 | -1;\n  let repeat_delay = 0;\n\n  let dead = false;\n\n  new_falling();\n\n  /** generate a new falling tetronimo, filling the bag if needed */\n  function new_falling() {\n    if (game.fall_queue.length - 1 < rules.bag_preview) {\n      let pool = tetronimos.all.slice();\n      while (pool.length > 0) {\n        let i = Math.floor(Math.random() * pool.length);\n        let kind = pool.splice(i, 1)[0];\n        game.fall_queue.push(kind);\n      }\n    }\n\n    let kind = game.fall_queue.shift()!;\n    let position = new Vec(5 - Math.ceil(kind.size / 2), rules.field_size.y / 2 - 2);\n    let rotation = 0;\n\n    game.falling = { id: next_id++, kind, position, rotation };\n    game.hold_available = true;\n    move_reset = rules.move_reset_limit ?? Infinity;\n\n    if (collide(game.falling)) {\n      console.log('collide', game.falling);\n      game.falling = null;\n      dead = true;\n      clearInterval(cancel);\n    } else {\n      try_drop();\n    }\n  }\n\n  /** detect collisions of a tetronimo with the field, checking contents and borders */\n  function collide(t: Tetronimo) {\n    for (let part of pieces(t)) {\n      if (part.x < 0 || part.x >= rules.field_size.x || part.y >= rules.field_size.y)\n        return true;\n\n      if (part.y < 0)\n        continue;\n\n      let tile = game.field[part.y][part.x];\n      if (tile != null)\n        return true;\n    }\n\n    return false;\n  }\n\n  /** find the position that the tetronimo would hard drop to */\n  function hard_drop_position(t: Tetronimo) {\n    let bottom = t.position;\n    while (true) {\n      let position = Vec.add(bottom, down);\n      if (collide({ ...t, position })) break;\n      bottom = position;\n    }\n\n    return bottom;\n  }\n\n  /** lock down the falling tetronimo */\n  function lock_down() {\n    if (game.falling == null) return;\n\n    for (let part of pieces(game.falling)) {\n      game.field[part.y][part.x] = {\n        id: game.falling.id,\n        kind: game.falling.kind,\n      };\n    }\n\n    new_falling();\n  }\n\n  /** determine if the falling piece is resting on the ground */\n  function is_on_ground(t: Tetronimo) {\n    let position = Vec.add(t.position, down);\n\n    return collide({ ...t, position });\n  }\n\n  /** try to drop the falling tetronimo one tile */\n  function try_drop() {\n    if (!game.falling) return false;\n\n    fall_time = 0;\n\n    let position = Vec.add(game.falling.position, down);\n    if (!collide({ ...game.falling, position })) {\n      game.falling.position = position;\n      move_reset = rules.move_reset_limit ?? Infinity;\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /** reset the lock_delay, consuming a move reset */\n  function try_move_reset() {\n    if (game.falling == null) return;\n\n    if (is_on_ground(game.falling) && move_reset > 0) {\n      move_reset -= 1;\n      fall_time = 0;\n    }\n  }\n\n  /** hold a tetronimo, swapping the held piece out if one exists */\n  function hold() {\n    if (dead) return;\n\n    let next_fall = game.holding;\n    game.holding = game.falling?.kind ?? null;\n\n    if (next_fall) {\n      game.fall_queue.unshift(next_fall);\n    }\n\n    new_falling();\n    game.hold_available = false;\n  }\n\n  /** attempt to shift the falling tetronimo */\n  function shift(change: 1 | -1) {\n    if (dead || game.falling == null) return;\n\n    let position = Vec.add(game.falling.position, new Vec(change, 0));\n    if (!collide({ ...game.falling, position })) {\n      game.falling.position = position;\n\n      if (user.autoshift) {\n        repeat_delay = repeating\n          ? user.autoshift.delay\n          : user.autoshift.initial_delay;\n\n        repeating = true;\n      }\n\n      try_move_reset();\n    }\n  }\n\n  /** attempt to rotate the falling tetronimo */\n  function rotate(change: 1 | -1) {\n    if (dead || game.falling == null) return;\n\n    let rotation = (game.falling.rotation + change) % 4;\n    if (rotation < 0) rotation += 4;\n\n    let kick_info = rules.wall_kicks.get(game.falling.kind);\n    assert(kick_info != null, `no kick info for piece`);\n\n    let kicks;\n    if (change == 1)\n      kicks = kick_info[game.falling.rotation * 2];\n    else\n      kicks = kick_info[rotation * 2 + 1];\n\n    for (let kick of kicks) {\n      let position = Vec.add(game.falling.position, kick)\n\n      if (!collide({ ...game.falling, position, rotation })) {\n        game.falling.position = position;\n        game.falling.rotation = rotation;\n        try_move_reset();\n        return;\n      }\n    }\n  }\n\n  /** hard drop the falling tetronimo */\n  function hard_drop() {\n    if (dead || game.falling == null) return;\n\n    game.falling.position = hard_drop_position(game.falling);\n    lock_down();\n  }\n\n  /** shift input handler */\n  function press_shift(dir: 1 | -1) {\n    if (dead || game.falling == null) return;\n\n    repeating = false;\n    if (dir == 1)\n      shift_right = true;\n    else\n      shift_left = true;\n    repeat_shift = dir;\n    shift(dir);\n  }\n\n  /** shift input handler */\n  function release_shift(dir: 1 | -1) {\n    if (dead || game.falling == null) return;\n\n    if (dir == 1)\n      shift_right = false;\n    else\n      shift_left = false;\n\n    if (user.autoshift && repeat_shift == dir) {\n      repeat_delay = repeating\n        ? user.autoshift.delay\n        : user.autoshift.initial_delay;\n    }\n\n    repeat_shift = shift_left ? -1 : shift_right ? 1 : 0;\n  }\n\n  onKeyDown(Z, () => rotate(-1));\n  onKeyDown(A, () => rotate(-1));\n  onKeyDown(X, () => rotate(1));\n  onKeyDown(S, () => rotate(1));\n  onKeyDown(UP, () => rotate(1));\n\n  onKeyUp(LEFT, () => release_shift(-1));\n  onKeyDown(LEFT, () => press_shift(-1));\n  onKeyUp(RIGHT, () => release_shift(1));\n  onKeyDown(RIGHT, () => press_shift(1));\n\n  onKeyDown(DOWN, () => try_drop());\n\n  onKeyDown(SPACE, () => hard_drop());\n\n  onKeyDown(C, () => game.hold_available && hold());\n  onKeyDown(SHIFT, () => game.hold_available && hold());\n\n  let cancel = setInterval(update, 1000 / 60);\n  function update() {\n    if (repeat_delay > 0) {\n      repeat_delay -= 1;\n    } else if (user.autoshift && repeat_shift != 0) {\n      shift(repeat_shift);\n    }\n\n    while (game.falling) {\n      let fall_delay;\n      if (is_on_ground(game.falling))\n        fall_delay = rules.lock_delay;\n      else if (isKeyDown(DOWN))\n        fall_delay = rules.fall_delay / user.soft_drop;\n      else\n        fall_delay = rules.fall_delay;\n\n      if (fall_time < fall_delay) break;\n\n      let position = Vec.add(game.falling.position, down);\n      if (!collide({ ...game.falling, position })) {\n        game.falling.position = position;\n        move_reset = rules.move_reset_limit ?? Infinity;\n        fall_time -= fall_delay;\n      } else {\n        fall_time = 0;\n        lock_down();\n      }\n    }\n\n    fall_time += 1;\n\n    let cleared = 0;\n    for (let y = 0; y < rules.field_size.y; ++y) {\n      if (game.field[y].every(t => t != null)) {\n        for (let i = y; i > 0; --i) {\n          Object.assign(game.field[i], game.field[i - 1]);\n        }\n\n        Object.assign(game.field[0], empty_row(rules));\n        cleared += 1;\n      }\n    }\n\n    if (cleared > 0) {\n      console.log(`cleared ${cleared} lines`);\n    }\n  }\n\n  return { rules, state: game, hard_drop_position };\n}\n\nexport function tetris(canvas: HTMLCanvasElement) {\n  const rules: GameRules = {\n    field_size: new Vec(10, 40),\n    fall_delay: 30,\n    lock_delay: 30,\n    move_reset_limit: 15,\n\n    wall_kicks: wall_kicks.asira,\n\n    bag_preview: 5,\n  };\n\n  const user: UserConfig = {\n    autoshift: { delay: 2, initial_delay: 10 },\n    soft_drop: 10,\n  };\n\n  const state = reactive_game(new_game(rules));\n  const game = run_game(rules, user, state);\n\n  // basic_render(canvas, game);\n  pixi_render(canvas, game);\n}\n","<template>\n  <v-card>\n    <template v-slot:title>\n      <v-text title>Game Rules</v-text>\n    </template>\n\n    <v-flex column class=\"pa-4\">\n      <config-rational\n        name=\"Drop Delay\"\n        description=\"Drop delay for falling pieces (frames per tile)\"\n        v-model=\"rules.fall_delay\"\n      />\n\n      <config-rational\n        name=\"Lock Delay\"\n        description=\"Delay after hitting the floor before a piece locks down (frames)\"\n        v-model=\"rules.lock_delay\"\n      />\n    </v-flex>\n  </v-card>\n</template>\n\n<script>\nimport { shallowReactive } from 'vue';\n\nimport { Vec } from '@/vec';\nimport { wall_kicks } from '@/tetris/config';\n\nimport configRational from './config-rational';\n\nexport default {\n  name: 'config-game-rules',\n\n  components: {\n    configRational,\n  },\n\n  setup() {\n    let rules = shallowReactive({\n      field_size: new Vec(10, 40),\n      fall_delay: 30,\n      lock_delay: 30,\n      move_reset_limit: 15,\n\n      wall_kicks: wall_kicks.asira,\n\n      bag_preview: 5,\n    });\n\n    return { rules };\n  },\n};\n</script>\n\n<style>\n</style>\n","<template>\n  <v-flex column class=\"mt-4\">\n    <v-flex align-baseline>\n      <v-text>{{ name }}</v-text>\n      <v-flex grow class=\"mx-4\" />\n      <v-text>{{ description }}</v-text>\n    </v-flex>\n\n    <v-flex>\n      <v-flex class=\"mt-4\" column justify-center>\n        <v-text>{{ modelValue }}</v-text>\n      </v-flex>\n\n      <v-flex grow class=\"mx-4\" />\n\n      <v-text-field solo small v-model=\"top\" />\n\n      <v-flex class=\"mt-4 mx-2\" column justify-center>\n        <v-text title> / </v-text>\n      </v-flex>\n\n      <v-text-field solo small v-model=\"bot\" />\n    </v-flex>\n  </v-flex>\n</template>\n\n<script>\nimport { computed } from 'vue';\nexport default {\n  name: 'config-rational',\n\n  emits: ['update:modelValue'],\n  props: {\n    name: String,\n    description: String,\n    modelValue: Number,\n  },\n\n  setup(props, { emit }) {\n    let top = computed({\n      get: () => {\n        if (props.modelValue > 1) {\n          return props.modelValue.toString();\n        } else {\n          return '1';\n        }\n      },\n\n      set: (v) => {\n        let num = parseInt(v);\n        emit('update:modelValue', num);\n      },\n    });\n\n    let bot = computed({\n      get: () => {\n        if (props.modelValue < 1) {\n          return (1 / props.modelValue).toString();\n        } else {\n          return '1';\n        }\n      },\n\n      set: (v) => {\n        let num = parseInt(v);\n        emit('update:modelValue', 1 / num);\n      },\n    });\n\n    return { top, bot };\n  },\n};\n</script>\n\n<style>\n</style>\n","import { render } from \"./config-rational.vue?vue&type=template&id=46e9d6b2\"\nimport script from \"./config-rational.vue?vue&type=script&lang=js\"\nexport * from \"./config-rational.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./config-game-rules.vue?vue&type=template&id=133017fc\"\nimport script from \"./config-game-rules.vue?vue&type=script&lang=js\"\nexport * from \"./config-game-rules.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./main.vue?vue&type=template&id=52d46b64&scoped=true\"\nimport script from \"./main.vue?vue&type=script&lang=js\"\nexport * from \"./main.vue?vue&type=script&lang=js\"\n\nimport \"./main.vue?vue&type=style&index=0&id=52d46b64&lang=scss\"\nimport \"./main.vue?vue&type=style&index=1&id=52d46b64&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-52d46b64\"\n\nexport default script","import { createApp } from 'vue'\nimport { framework } from '@mfro/vue-ui';\n\nimport root from './main.vue'\n\ncreateApp(root)\n  .use(framework)\n  .mount('#app')\n"],"sourceRoot":""}