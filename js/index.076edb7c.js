(function(e){function t(t){for(var r,a,i=t[0],c=t[1],u=t[2],d=0,s=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&s.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);f&&f(t);while(s.length)s.shift()();return l.push.apply(l,u||[]),n()}function n(){for(var e,t=0;t<l.length;t++){for(var n=l[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==o[c]&&(r=!1)}r&&(l.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={index:0},l=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var f=c;l.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"13e7":function(e,t,n){},"162c":function(e,t,n){},"1f42":function(e,t,n){"use strict";n("162c")},2195:function(e,t,n){"use strict";n("7557")},"50a0":function(e,t,n){"use strict";n("e70f")},7557:function(e,t,n){},8227:function(e,t,n){"use strict";var r=n("afc4"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},afc4:function(e,t,n){e.exports={root:"config-number_root_1JO2c"}},cbc2:function(e,t,n){"use strict";n("81b1");var r=n("fee1");n.d(t,"a",(function(){return r["a"]})),n.d(t,"b",(function(){return r["b"]})),n.d(t,"c",(function(){return r["c"]})),n.d(t,"d",(function(){return r["d"]})),n.d(t,"e",(function(){return r["e"]})),n.d(t,"f",(function(){return r["f"]})),n.d(t,"g",(function(){return r["g"]})),n.d(t,"h",(function(){return r["h"]})),n.d(t,"i",(function(){return r["i"]})),n.d(t,"j",(function(){return r["j"]})),n.d(t,"k",(function(){return r["k"]})),n.d(t,"l",(function(){return r["l"]})),n.d(t,"m",(function(){return r["m"]})),n.d(t,"n",(function(){return r["n"]})),n.d(t,"o",(function(){return r["o"]})),n.d(t,"p",(function(){return r["p"]})),n.d(t,"q",(function(){return r["q"]})),n.d(t,"r",(function(){return r["r"]})),n.d(t,"s",(function(){return r["s"]})),n.d(t,"t",(function(){return r["t"]})),n.d(t,"u",(function(){return r["u"]})),n.d(t,"v",(function(){return r["v"]})),n.d(t,"w",(function(){return r["w"]})),n.d(t,"x",(function(){return r["x"]})),n.d(t,"y",(function(){return r["y"]})),n.d(t,"z",(function(){return r["z"]})),n.d(t,"A",(function(){return r["A"]})),n.d(t,"B",(function(){return r["B"]})),n.d(t,"C",(function(){return r["C"]})),n.d(t,"D",(function(){return r["D"]})),n.d(t,"E",(function(){return r["E"]})),n.d(t,"F",(function(){return r["F"]})),n.d(t,"G",(function(){return r["G"]})),n.d(t,"H",(function(){return r["H"]})),n.d(t,"I",(function(){return r["I"]})),n.d(t,"J",(function(){return r["J"]}));n("669d")},cd49:function(e,t,n){"use strict";n.r(t);n("fd85"),n("15db"),n("c026"),n("4031");var r=n("cbc2"),o=n("34c7"),l=Object(r["J"])("data-v-3ed78246");Object(r["s"])("data-v-3ed78246");var a=Object(r["i"])("settings"),i=Object(r["j"])("span",null,"User preferences",-1);Object(r["q"])();var c=l((function(e,t,n,o,c,u){var f=Object(r["x"])("edit-config"),d=Object(r["x"])("v-dialog"),s=Object(r["x"])("v-icon"),b=Object(r["x"])("v-button"),v=Object(r["x"])("v-flex"),j=Object(r["x"])("room"),m=Object(r["x"])("joining"),p=Object(r["x"])("landing"),O=Object(r["x"])("v-app");return Object(r["p"])(),Object(r["f"])(O,{"align-center":"",class:"pa-6"},{default:l((function(){return[Object(r["j"])(d,{"model-value":o.editing_user},{default:l((function(){return[Object(r["j"])(f,{kind:"user",modelValue:o.user_prefs,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.user_prefs=e}),onClose:t[2]||(t[2]=function(e){return o.editing_user=!1})},null,8,["modelValue"])]})),_:1},8,["model-value"]),Object(r["j"])(v,{class:"user pa-4"},{default:l((function(){return[Object(r["j"])(b,{onClick:t[3]||(t[3]=function(e){return o.editing_user=!0})},{default:l((function(){return[Object(r["j"])(s,{class:"mr-3"},{default:l((function(){return[a]})),_:1}),i]})),_:1})]})),_:1}),null!=o.current_room?(Object(r["p"])(),Object(r["f"])(j,{key:0,room:o.current_room},null,8,["room"])):null!=o.joining_code?(Object(r["p"])(),Object(r["f"])(m,{key:1,code:o.joining_code,onRoom:t[4]||(t[4]=function(e){return o.current_room=e})},null,8,["code"])):(Object(r["p"])(),Object(r["f"])(p,{key:2,onRoom:t[5]||(t[5]=function(e){return o.current_room=e})}))]})),_:1})})),u=(n("241c"),n("5a85"),n("534d"),n("f432"),Object(r["i"])("Game rules")),f=Object(r["i"])("User preferences"),d=Object(r["i"])("close"),s=Object(r["j"])("span",null,"Save",-1);function b(e,t,n,o,l,a){var i=Object(r["x"])("v-text"),c=Object(r["x"])("v-grow"),b=Object(r["x"])("v-icon"),v=Object(r["x"])("v-button"),j=Object(r["x"])("config-game-rules"),m=Object(r["x"])("config-user-prefs"),p=Object(r["x"])("v-card");return Object(r["p"])(),Object(r["f"])(p,{style:{"min-width":"60ch"}},{title:Object(r["G"])((function(){return["game"==n.kind?(Object(r["p"])(),Object(r["f"])(i,{key:0,title:""},{default:Object(r["G"])((function(){return[u]})),_:1})):Object(r["g"])("",!0),"user"==n.kind?(Object(r["p"])(),Object(r["f"])(i,{key:1,title:""},{default:Object(r["G"])((function(){return[f]})),_:1})):Object(r["g"])("",!0),Object(r["j"])(c),Object(r["j"])(v,{icon:"",small:"",onClick:t[1]||(t[1]=function(t){return e.$emit("close")})},{default:Object(r["G"])((function(){return[Object(r["j"])(b,null,{default:Object(r["G"])((function(){return[d]})),_:1})]})),_:1})]})),actions:Object(r["G"])((function(){return[Object(r["j"])(c),Object(r["j"])(v,{color:"primary",onClick:t[4]||(t[4]=function(e){return o.save()})},{default:Object(r["G"])((function(){return[s]})),_:1})]})),default:Object(r["G"])((function(){return["game"==n.kind?(Object(r["p"])(),Object(r["f"])(j,{key:0,modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.value=e})},null,8,["modelValue"])):Object(r["g"])("",!0),"user"==n.kind?(Object(r["p"])(),Object(r["f"])(m,{key:1,modelValue:o.value,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.value=e})},null,8,["modelValue"])):Object(r["g"])("",!0)]})),_:1})}function v(e,t,n,o,l,a){var i=Object(r["x"])("config-rational"),c=Object(r["x"])("config-number"),u=Object(r["x"])("config-select");return Object(r["p"])(),Object(r["f"])(r["a"],null,[Object(r["j"])(i,{name:"Gravity",description:"Gravity for falling pieces (tiles per frame)",modelValue:o.gravity,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.gravity=e}),filter:function(e){return e<=20}},null,8,["modelValue","filter"]),Object(r["j"])(c,{name:"Lock delay",description:"Delay after touching the ground before a piece locks down (frames)",modelValue:o.lock_delay,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.lock_delay=e}),filter:function(e){return e>=0}},null,8,["modelValue","filter"]),Object(r["j"])(c,{name:"Move reset limit",description:"Maximum number of times the lock delay can be reset by successful shifts or rotates",modelValue:o.move_reset_limit,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.move_reset_limit=e}),filter:function(e){return e>=0}},null,8,["modelValue","filter"]),Object(r["j"])(c,{name:"Preview size",description:"Number of pieces in the preview",modelValue:o.bag_preview,"onUpdate:modelValue":t[4]||(t[4]=function(e){return o.bag_preview=e}),filter:function(e){return e>=0&&e<=6}},null,8,["modelValue","filter"]),Object(r["j"])(u,{name:"Wall kick style",description:"Wall kick configuration to use for rotations",modelValue:o.wall_kicks,"onUpdate:modelValue":t[5]||(t[5]=function(e){return o.wall_kicks=e}),options:o.wallKickOptions},null,8,["modelValue","options"])],64)}var j,m,p,O=n("98ad"),g=n("2e1a"),y=(n("862d"),n("b902"),n("966c"),n("d50c"),n("e82c")),_=n("862b"),h=n("c812"),x=function(){function e(t,n){Object(_["a"])(this,e),this.x=t,this.y=n}return Object(h["a"])(e,[{key:"len",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"dir",get:function(){return Math.atan2(this.y,this.x)}}],[{key:"norm",value:function(t){return e.polar(1,t.dir)}},{key:"scale",value:function(t,n){return new e(t.x*n,t.y*n)}},{key:"add",value:function(t,n){return new e(t.x+n.x,t.y+n.y)}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y}},{key:"eq",value:function(e,t){return e.x==t.x&&e.y==t.y}},{key:"delta",value:function(t,n){var r=e.dot(t,n),o=Math.acos(r/t.len/n.len);return t.y*n.x>t.x*n.y?-o:o}},{key:"polar",value:function(t,n){return new e(Math.cos(n)*t,Math.sin(n)*t)}}]),e}();function w(e){return{type:"constant",value:e}}function k(e){return{type:"optional",inner:e}}function V(e,t){return{type:"natural",name:e,description:t}}function S(e,t){return{type:"rational",name:e,description:t}}function T(e,t,n){return{type:"select",name:e,description:t,options:n}}function G(e,t,n){return{type:"object",name:e,description:t,inner:n}}x.zero=new x(0,0),function(e){function t(e,t){for(var n=t.map((function(e){return new x(e[0],e[1])})),r=[n],o=0;o<3;++o)n=n.map((function(t){return new x(e-1-t.y,t.x)})),r.push(n);return{size:e,rotations:r}}e.I=t(4,[[0,1],[1,1],[2,1],[3,1]]),e.O=t(2,[[0,0],[0,1],[1,0],[1,1]]),e.T=t(3,[[1,0],[0,1],[1,1],[2,1]]),e.J=t(3,[[0,0],[0,1],[1,1],[2,1]]),e.L=t(3,[[2,0],[0,1],[1,1],[2,1]]),e.S=t(3,[[1,0],[2,0],[0,1],[1,1]]),e.Z=t(3,[[0,0],[1,0],[1,1],[2,1]]),e.GARBAGE=t(0,[]),e.all=[e.I,e.O,e.T,e.J,e.L,e.S,e.Z]}(j||(j={})),function(e){function t(e){return e.map((function(e){return[x.zero].concat(Object(y["a"])(e.map((function(e){return new x(e[0],-e[1])}))))}))}var n=t([[[0,0]],[[0,0]],[[0,0]],[[0,0]],[[0,0]],[[0,0]],[[0,0]],[[0,0]]]),r=t([[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]]]),o=t([[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]]]),l=t([[[0,0],[-2,0],[1,0],[1,2],[-2,-1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],[[0,0],[-2,0],[1,0],[-2,1],[1,-1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-1]],[[0,0],[1,0],[-2,0],[1,2],[-2,-1]],[[0,0],[-2,0],[1,0],[-2,1],[1,-2]],[[0,0],[2,0],[-1,0],[-1,2],[2,-1]]]);e.standard=new Map([[j.I,o],[j.O,r],[j.T,r],[j.J,r],[j.L,r],[j.S,r],[j.Z,r]]),e.asira=new Map([[j.I,l],[j.O,r],[j.T,r],[j.J,r],[j.L,r],[j.S,r],[j.Z,r]]),e.none=new Map([[j.I,n],[j.O,n],[j.T,n],[j.J,n],[j.L,n],[j.S,n],[j.Z,n]]),e.all=[e.none,e.standard,e.asira]}(m||(m={})),function(e){function t(e){return{field_size:[e.field_size.x,e.field_size.y],fall_delay:e.fall_delay,lock_delay:e.lock_delay,move_reset_limit:e.move_reset_limit,wall_kicks:m.all.indexOf(e.wall_kicks),bag_preview:e.bag_preview}}function n(e){return{field_size:new x(e.field_size[0],e.field_size[1]),fall_delay:e.fall_delay,lock_delay:e.lock_delay,move_reset_limit:e.move_reset_limit,wall_kicks:m.all[e.wall_kicks],bag_preview:e.bag_preview}}e.save=t,e.load=n}(p||(p={}));w(new x(10,40)),S("Drop Delay","Drop delay for falling pieces (frames per tile)"),S("Lock Delay","Lock down delay (frames)"),k(S("Move Reset Limit","Maximum number of times the Lock Delay can be reset by successful shifts or rotates")),T("Wall Kicks","Wall kick data",[["No Kicks",m.none],["Standard",m.standard],["Asira",m.asira]]),V("Preview Size","Number of pieces in the preview"),k(G("Autoshift","Configure repeated shifts while input is held",{delay:S("Delay","Delay between repeated shifts (frames)"),initial_delay:S("Initial Delay","Delay after first shift before repeating (frames)")})),S("Soft Drop Multiplier","Multiplier for Drop Delay while soft dropping"),n("88f6"),n("932a"),n("0ffc");var z=Object(r["J"])("data-v-632a7c32"),C=z((function(e,t,n,o,l,a){var i=Object(r["x"])("v-input"),c=Object(r["x"])("v-tooltip");return Object(r["p"])(),Object(r["f"])(c,{right:"",text:n.description},{default:z((function(){return[Object(r["j"])(i,{label:n.name,onClick:t[2]||(t[2]=function(t){return e.$refs.select.click()})},{default:z((function(e){var l=e.id;return[Object(r["H"])(Object(r["j"])("select",{id:l,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.value=e}),ref:"select"},[(Object(r["p"])(!0),Object(r["f"])(r["a"],null,Object(r["v"])(n.options,(function(e,t){return Object(r["p"])(),Object(r["f"])("option",{key:e[0],value:t},Object(r["B"])(e[0]),9,["value"])})),128))],8,["id"]),[[r["D"],o.value]])]})),_:1},8,["label"])]})),_:1},8,["text"])})),A=(n("156c"),{name:"config-select",emits:["update:modelValue"],props:{name:String,description:String,modelValue:{},options:Array},setup:function(e,t){var n=t.emit,o=Object(r["d"])({get:function(){return e.options.findIndex((function(t){return t[1]==e.modelValue}))},set:function(t){n("update:modelValue",e.options[t][1])}});return{value:o}}});n("1f42");A.render=C,A.__scopeId="data-v-632a7c32";var M=A;function U(e,t,n,o,l,a){var i=Object(r["x"])("v-text-field"),c=Object(r["x"])("v-tooltip");return Object(r["p"])(),Object(r["f"])(c,{right:"",text:n.description},{default:Object(r["G"])((function(){return[Object(r["j"])(i,{label:n.name,"model-value":o.state.editing,"onUpdate:modelValue":o.onInput,onBlur:e.onBlur,warning:o.state.error},null,8,["label","model-value","onUpdate:modelValue","onBlur","warning"])]})),_:1},8,["text"])}n("9588"),n("7e9e"),n("f542");var I={name:"config-number",emits:["update:modelValue"],props:{name:String,description:String,modelValue:Number,filter:Function},setup:function(e,t){var n=t.emit,o=Object(r["z"])({editing:null,error:!1});return Object(r["E"])((function(){return e.modelValue}),(function(){o.editing=e.modelValue.toString()}),{immediate:!0}),{state:o,onInput:function(t){o.editing=t;var l=parseInt(t,10);l.toString()!=t||e.filter&&!e.filter(l)?o.error=!0:(o.error=!1,Object(r["m"])((function(){return n("update:modelValue",l)})))}}}},R=n("8227");const P=I.__cssModules={};P["$style"]=R["default"],I.render=U;var D=I,E=Object(r["J"])("data-v-305fcda5");Object(r["s"])("data-v-305fcda5");var J=Object(r["i"])("/");Object(r["q"])();var L=E((function(e,t,n,o,l,a){var i=Object(r["x"])("v-text"),c=Object(r["x"])("v-flex"),u=Object(r["x"])("v-input"),f=Object(r["x"])("v-tooltip");return Object(r["p"])(),Object(r["f"])(f,{right:"",text:n.description},{default:E((function(){return[Object(r["j"])(u,{label:n.name,style:{cursor:"text"},onClick:t[4]||(t[4]=function(t){return e.$refs.top.focus()}),warning:o.state.error},{default:E((function(e){var n=e.id;return[Object(r["j"])(c,null,{default:E((function(){return[Object(r["j"])("input",{ref:"top",id:n,style:{width:"3ch"},value:o.state.top,onInput:t[1]||(t[1]=function(e){return o.setTop(e.target.value)})},null,40,["id","value"]),Object(r["j"])(c,{class:"mx-2",column:"","justify-center":""},{default:E((function(){return[Object(r["j"])(i,null,{default:E((function(){return[J]})),_:1})]})),_:1}),Object(r["j"])("input",{onClick:t[2]||(t[2]=Object(r["I"])((function(){}),["stop"])),value:o.state.bot,onInput:t[3]||(t[3]=function(e){return o.setBot(e.target.value)})},null,40,["value"])]})),_:2},1024)]})),_:1},8,["label","warning"])]})),_:1},8,["text"])})),B={name:"config-rational",emits:["update:modelValue"],props:{name:String,description:String,modelValue:Number,filter:Function},setup:function(e,t){var n=t.emit,o=Object(r["z"])({top:null,bot:null,error:!1});return Object(r["E"])((function(){return e.modelValue}),(function(){e.modelValue>1?(o.top=e.modelValue.toString(),o.bot="1"):(o.top="1",o.bot=1/e.modelValue.toString())}),{immediate:!0}),{state:o,setTop:function(t){o.top=t,o.bot="1";var r=parseInt(t,10);r.toString()!=t||e.filter&&!e.filter(r)?o.error=!0:(o.error=!1,n("update:modelValue",r))},setBot:function(t){o.top="1",o.bot=t;var r=1/parseInt(t,10);console.log(t,r),(1/r).toString()!=t||e.filter&&!e.filter(r)?o.error=!0:(o.error=!1,n("update:modelValue",r))}}}};n("d92e");B.render=L,B.__scopeId="data-v-305fcda5";var q=B,N=[["No Kicks",m.none],["Standard",m.standard],["Asira",m.asira]];function F(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(e){return e};return Object(r["d"])({get:function(){return o(t()[n])},set:function(r){var o=Object(g["a"])(Object(g["a"])({},t()),{},Object(O["a"])({},n,l(r)));e("update:modelValue",o)}})}var W={name:"config-game-rules",components:{configSelect:M,configNumber:D,configRational:q},emits:["update:modelValue"],props:{modelValue:Object},setup:function(e,t){var n=t.emit,r=F(n,(function(){return e.modelValue}),"fall_delay",(function(e){return 1/e}),(function(e){return 1/e})),o=F(n,(function(){return e.modelValue}),"lock_delay"),l=F(n,(function(){return e.modelValue}),"move_reset_limit"),a=F(n,(function(){return e.modelValue}),"bag_preview"),i=F(n,(function(){return e.modelValue}),"wall_kicks");return{gravity:r,lock_delay:o,move_reset_limit:l,bag_preview:a,wall_kicks:i,wallKickOptions:N}}};W.render=v;var Z=W;function K(e,t,n,o,l,a){var i=Object(r["x"])("config-autoshift"),c=Object(r["x"])("config-number");return Object(r["p"])(),Object(r["f"])(r["a"],null,[Object(r["j"])(i,{modelValue:o.autoshift,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.autoshift=e})},null,8,["modelValue"]),Object(r["j"])(c,{name:"Soft drop multiplier",description:"Gravity multiplier when soft dropping",modelValue:o.soft_drop,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.soft_drop=e}),filter:function(e){return e>=0}},null,8,["modelValue","filter"])],64)}function H(e,t,n,o,l,a){var i=Object(r["x"])("config-number");return Object(r["p"])(),Object(r["f"])(r["a"],null,[Object(r["j"])(i,{name:"Autoshift delay",description:"Delay between repeated shifts while input is held (ARR)",modelValue:o.delay,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.delay=e}),filter:function(e){return e>=0}},null,8,["modelValue","filter"]),Object(r["j"])(i,{name:"Autoshift initial delay",description:"Delay after the initial shift when pressing an input before repeating (DAS)",modelValue:o.initial_delay,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.initial_delay=e}),filter:function(e){return e>=0}},null,8,["modelValue","filter"])],64)}function $(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(e){return e};return Object(r["d"])({get:function(){return o(t()[n])},set:function(r){var o=Object(g["a"])(Object(g["a"])({},t()),{},Object(O["a"])({},n,l(r)));e("update:modelValue",o)}})}var Q={name:"config-autoshift",components:{configNumber:D},emits:["update:modelValue"],props:{modelValue:Object},setup:function(e,t){var n=t.emit,r=$(n,(function(){return e.modelValue}),"delay"),o=$(n,(function(){return e.modelValue}),"initial_delay");return{delay:r,initial_delay:o}}};Q.render=H;var X=Q;function Y(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(e){return e};return Object(r["d"])({get:function(){return o(t()[n])},set:function(r){var o=Object(g["a"])(Object(g["a"])({},t()),{},Object(O["a"])({},n,l(r)));e("update:modelValue",o)}})}var ee={name:"config-game-rules",components:{configAutoshift:X,configNumber:D},emits:["update:modelValue"],props:{modelValue:Object},setup:function(e,t){var n=t.emit,r=Y(n,(function(){return e.modelValue}),"autoshift"),o=Y(n,(function(){return e.modelValue}),"soft_drop");return{autoshift:r,soft_drop:o}}};ee.render=K;var te=ee,ne={name:"edit-config",components:{configGameRules:Z,configUserPrefs:te},emits:["close","update:modelValue"],props:{kind:String,modelValue:Object},setup:function(e,t){var n=t.emit,o=Object(r["A"])(e.modelValue);return Object(r["E"])((function(){return e.modelValue}),(function(e){return o.value=e})),{value:o,save:function(){n("update:modelValue",o.value),n("close")}}}};ne.render=b;var re=ne,oe=(n("cbc2f"),Object(r["i"])("Tetris Lobby")),le=Object(r["i"])("emoji_events"),ae=Object(r["i"])("settings"),ie=Object(r["j"])("span",null,"Game rules",-1),ce=Object(r["j"])("span",null,"Start game",-1);function ue(e,t,n,o,l,a){var i=Object(r["x"])("edit-config"),c=Object(r["x"])("v-dialog"),u=Object(r["x"])("v-text"),f=Object(r["x"])("v-grow"),d=Object(r["x"])("clipboard"),s=Object(r["x"])("v-flex"),b=Object(r["x"])("v-icon"),v=Object(r["x"])("v-button"),j=Object(r["x"])("v-card"),m=Object(r["x"])("game");return Object(r["p"])(),Object(r["f"])(r["a"],null,[Object(r["j"])(c,{"model-value":o.editing},{default:Object(r["G"])((function(){return[Object(r["j"])(i,{kind:"game",modelValue:o.game_rules,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.game_rules=e}),onClose:t[2]||(t[2]=function(e){return o.editing=!1})},null,8,["modelValue"])]})),_:1},8,["model-value"]),Object(r["j"])(s,{column:"",grow:"","align-center":""},{default:Object(r["G"])((function(){return[n.room.local?(Object(r["p"])(),Object(r["f"])(s,{key:1},{default:Object(r["G"])((function(){return[Object(r["j"])(m,{value:n.room.local},null,8,["value"]),Object(r["j"])(s,null,{default:Object(r["G"])((function(){return[(Object(r["p"])(!0),Object(r["f"])(r["a"],null,Object(r["v"])(o.others,(function(e){return Object(r["p"])(),Object(r["f"])(m,{key:e,value:e.game},null,8,["value"])})),128))]})),_:1})]})),_:1})):(Object(r["p"])(),Object(r["f"])(j,{key:0},Object(r["h"])({title:Object(r["G"])((function(){return[Object(r["j"])(s,{grow:"","align-start":""},{default:Object(r["G"])((function(){return[Object(r["j"])(u,{title:""},{default:Object(r["G"])((function(){return[oe]})),_:1}),Object(r["j"])(f,{class:"mx-6"}),Object(r["j"])(f,{class:"mx-6"}),Object(r["j"])(d,{value:o.link},null,8,["value"])]})),_:1})]})),default:Object(r["G"])((function(){return[Object(r["j"])(s,{column:"",class:"pt-4"},{default:Object(r["G"])((function(){return[(Object(r["p"])(!0),Object(r["f"])(r["a"],null,Object(r["v"])(n.room.members,(function(e){return Object(r["p"])(),Object(r["f"])(s,{key:e,class:"px-4"},{default:Object(r["G"])((function(){return[e.winner?(Object(r["p"])(),Object(r["f"])(b,{key:0,class:"mr-3",style:{color:"#ffc107"}},{default:Object(r["G"])((function(){return[le]})),_:1})):Object(r["g"])("",!0),Object(r["j"])(u,{class:"my-3"},{default:Object(r["G"])((function(){return[Object(r["i"])(Object(r["B"])(e.name),1)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:1})]})),_:2},[0==n.room.index?{name:"actions",fn:Object(r["G"])((function(){return[Object(r["j"])(v,{text:"",onClick:t[3]||(t[3]=function(e){return o.editing=!0}),class:"mr-3"},{default:Object(r["G"])((function(){return[Object(r["j"])(b,{class:"mr-3"},{default:Object(r["G"])((function(){return[ae]})),_:1}),ie]})),_:1}),Object(r["j"])(f),Object(r["j"])(v,{onClick:t[4]||(t[4]=function(e){return o.start()}),color:"primary"},{default:Object(r["G"])((function(){return[ce]})),_:1})]}))}:void 0]),1024))]})),_:1})],64)}var fe={ref:"canvas"};function de(e,t,n,o,l,a){return Object(r["p"])(),Object(r["f"])("canvas",fe,null,512)}n("eea7"),n("46d4"),n("c770"),n("581e"),n("dddc");var se=n("68d6"),be=n("57d2"),ve=n("19a6"),je=(n("5e5b"),n("b2f1")),me=n.n(je),pe=n("9a81"),Oe=(n("46c3"),32),ge=37,ye=38,_e=16,he=40,xe=39,we=65,ke=90,Ve=83,Se=88,Te=67,Ge=82,ze=new Set,Ce=new Map,Ae=new Map;function Me(e){return ze.has(e)}function Ue(e,t){var n=Ae.get(e);n||Ae.set(e,n=[]),n.push(t)}function Ie(e,t){var n=Ce.get(e);n||Ce.set(e,n=[]),n.push(t)}window.addEventListener("keydown",(function(e){if(!ze.has(e.keyCode)){ze.add(e.keyCode);var t=Ae.get(e.keyCode);if(t){var n,r=Object(be["a"])(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o()}}catch(l){r.e(l)}finally{r.f()}}}})),window.addEventListener("keyup",(function(e){ze.delete(e.keyCode);var t=Ce.get(e.keyCode);if(t){var n,r=Object(be["a"])(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o()}}catch(l){r.e(l)}finally{r.f()}}}));var Re=new x(0,1);function Pe(e){return e.kind.rotations[e.rotation].map((function(t){return x.add(e.position,t)}))}function De(e){for(var t=[],n=0;n<e.field_size.x;++n)t[n]=null;return t}function Ee(e){for(var t=[],n=0;n<e.field_size.y;++n)t[n]=De(e);return t}function Je(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=me()(Math.random()).uint32()),{seed:t,field:Ee(e),falling:null,fall_queue:[],holding:null,hold_available:!0,garbage:[],dead:!1}}function Le(e){var t=e.falling;return Object(r["t"])({seed:e.seed,field:e.field.map((function(e){return Object(r["z"])(e)})),falling:Object(r["k"])((function(e,n){return{get:function(){return e(),t},set:function(e){t=e&&Object(r["z"])(e),n()}}})),fall_queue:Object(r["z"])([]),holding:Object(r["A"])(null),hold_available:e.hold_available,garbage:[],dead:e.dead})}function Be(e,t){var n,r=0,o=!1;function l(n){var r,o=Object(be["a"])(Pe(n));try{for(o.s();!(r=o.n()).done;){var l=r.value;if(l.x<0||l.x>=e.field_size.x||l.y>=e.field_size.y)return!0;if(!(l.y<0)){var a=t.field[l.y][l.x];if(null!=a)return!0}}}catch(i){o.e(i)}finally{o.f()}return!1}function a(e){var t=e.position;while(1){var n=x.add(t,Re);if(l(Object(g["a"])(Object(g["a"])({},e),{},{position:n})))break;t=n}return t}function i(){var e,n;if(!t.dead&&null!=t.falling){var r=t.holding;t.holding=null!==(e=null===(n=t.falling)||void 0===n?void 0:n.kind)&&void 0!==e?e:null,r&&t.fall_queue.unshift(r),t.falling=null,t.hold_available=!1,o=!0}}function c(e){if(t.dead||null==t.falling)return 0;for(var n=0;n<e;++n){var r=x.add(t.falling.position,Re);if(l(Object(g["a"])(Object(g["a"])({},t.falling),{},{position:r})))return n;t.falling.position=r}return e}function u(e){if(t.dead||null==t.falling)return!1;var n=x.add(t.falling.position,new x(e,0));return!l(Object(g["a"])(Object(g["a"])({},t.falling),{},{position:n}))&&(t.falling.position=n,!0)}function f(n){if(t.dead||null==t.falling)return!1;var r=(t.falling.rotation+n)%4;r<0&&(r+=4);var o,a=e.wall_kicks.get(t.falling.kind);Object(pe["a"])(null!=a,"no kick info for piece"),o=1==n?a[2*t.falling.rotation]:a[2*r+1];var i,c=Object(be["a"])(o);try{for(c.s();!(i=c.n()).done;){var u=i.value,f=x.add(t.falling.position,u);if(!l(Object(g["a"])(Object(g["a"])({},t.falling),{},{position:f,rotation:r})))return t.falling.position=f,t.falling.rotation=r,!0}}catch(d){c.e(d)}finally{c.f()}return!1}function d(){if(!t.dead&&null!=t.falling){var r,o=Object(be["a"])(Pe(t.falling));try{for(o.s();!(r=o.n()).done;){var l=r.value;t.field[l.y][l.x]={id:t.falling.id,kind:t.falling.kind}}}catch(p){o.e(p)}finally{o.f()}for(var a=[],i=0;i<e.field_size.y;++i)t.field[i].every((function(e){return null!=e}))&&a.push(i);a.length>0&&n.clear_lines(a);var c,u=Object(be["a"])(t.garbage);try{for(u.s();!(c=u.n()).done;){var f=c.value,d=me()(t.seed);t.seed=d.uint32();for(var s=Math.floor(d()*e.field_size.x),b=0;b<e.field_size.y-f;++b)Object.assign(t.field[b],t.field[b+f]);for(var v=e.field_size.y-f;v<e.field_size.y;++v)for(var m=0;m<e.field_size.x;++m)t.field[v][m]=m==s?null:{id:-1,kind:j.GARBAGE}}}catch(p){u.e(p)}finally{u.f()}t.garbage.length=0}}function s(n){console.log("cleared ".concat(n.length," lines"));var r,o=Object(be["a"])(n);try{for(o.s();!(r=o.n()).done;){for(var l=r.value,a=l;a>0;--a)Object.assign(t.field[a],t.field[a-1]);for(var i=0;i<e.field_size.x;++i)t.field[0][i]=null}}catch(c){o.e(c)}finally{o.f()}}function b(){if(t.dead)return!1;if(t.fall_queue.length-1<e.bag_preview){var n=me()(t.seed);t.seed=n.uint32();var a=j.all.slice();while(a.length>0){var i=Math.floor(n()*a.length),c=a.splice(i,1)[0];t.fall_queue.push(c)}}var u=t.fall_queue[0],f=new x(5-Math.ceil(u.size/2),e.field_size.y/2-2),d=0,s={id:r++,kind:u,position:f,rotation:d};return t.hold_available=!o,o=!1,!l(s)&&(t.fall_queue.shift(),t.falling=s,!0)}function v(){t.dead=!0,t.falling=null}function m(e){t.garbage.push(e)}return n={rules:e,state:t,collide:l,hard_drop_position:a,hold:i,drop:c,shift:u,rotate:f,lock_down:d,clear_lines:s,new_falling:b,end_game:v,add_garbage:m}}function qe(e,t){var n=0,r=0,o=0,l=!1,a=!1,i=!1,c=0,u=0;function f(){var e;t.state.dead||(t.new_falling()?(n=null!==(e=t.rules.move_reset_limit)&&void 0!==e?e:1/0,r=0,o=0,t.drop(1)):t.end_game())}function d(e){var n=x.add(e.position,Re);return t.collide(Object(g["a"])(Object(g["a"])({},e),{},{position:n}))}function s(){t.lock_down(),f()}function b(){t.state.dead||null==t.state.falling||r>0&&n>0&&(n-=1,r=0)}function v(){t.state.hold_available&&(t.hold(),f())}function j(n){t.state.dead||null==t.state.falling||t.shift(n)&&(b(),e.autoshift&&(u=l?e.autoshift.delay:e.autoshift.initial_delay,l=!0))}function m(e){t.state.dead||null==t.state.falling||t.rotate(e)&&b()}function p(){t.state.dead||null==t.state.falling||(t.drop(20),s())}function O(e){t.state.dead||null==t.state.falling||(l=!1,1==e?i=!0:a=!0,c=e,j(e))}function y(n){t.state.dead||null==t.state.falling||(1==n?i=!1:a=!1,e.autoshift&&c==n&&(u=l?e.autoshift.delay:e.autoshift.initial_delay),c=a?-1:i?1:0)}f(),Ue(ke,(function(){return m(-1)})),Ue(we,(function(){return m(-1)})),Ue(Se,(function(){return m(1)})),Ue(Ve,(function(){return m(1)})),Ue(ye,(function(){return m(1)})),Ie(ge,(function(){return y(-1)})),Ue(ge,(function(){return O(-1)})),Ie(xe,(function(){return y(1)})),Ue(xe,(function(){return O(1)})),Ue(Oe,(function(){return p()})),Ue(Te,(function(){return v()})),Ue(_e,(function(){return v()}));var _=setInterval(h,1e3/60);function h(){if(t.state.dead)return clearInterval(_);if(u>0?u-=1:e.autoshift&&0!=c&&j(c),null!=t.state.falling)if(d(t.state.falling))r+=1/t.rules.lock_delay,o=Math.min(o,Math.ceil(1/t.rules.fall_delay)),r>=1&&(o=0,r=0,s());else if(Me(he)?o+=1/t.rules.fall_delay*e.soft_drop:o+=1/t.rules.fall_delay,o>1){var l,a=Math.floor(o),i=t.drop(a);i>0&&(n=null!==(l=t.rules.move_reset_limit)&&void 0!==l?l:1/0),i==a?o-=a:o=0}}return function(){return clearInterval(_)}}n("e28c"),n("f1c6"),n("7bea"),n("90fa"),n("feeb"),n("1c98"),n("06a3"),n("1ca0"),n("3a0c"),n("9426"),n("100a"),n("3051"),n("9598"),n("2731"),n("587f"),n("c60d"),n("b285"),n("6a35"),n("b391"),n("1234"),n("dfa9"),n("7c3f"),n("2d6b"),n("0312"),n("1f3b"),n("c666"),n("705d");var Ne,Fe={v1:function(e,t,n,r,o){var l=new Map([[j.I,"#31c7ef"],[j.O,"#e39f02"],[j.T,"#af298a"],[j.J,"#2141c6"],[j.L,"#e35b02"],[j.S,"#59b101"],[j.Z,"#d70f37"],[j.GARBAGE,"gray"]]),a=t;if(e.save(),o==Ne.ghost)e.fillStyle="white",e.fillRect(a.x,a.y,1,1);else if(o==Ne.disabled)e.filter="grayscale(100%)";else{var i=l.get(n);Object(pe["a"])(null!=i,"no color for piece"),e.fillStyle=i,e.fillRect(a.x,a.y,1,1)}var c=1/8;e.beginPath(),e.lineCap="butt",e.lineWidth=c,e.strokeStyle="#00000040",r[0]&&(e.moveTo(a.x,a.y+c/2),e.lineTo(a.x+c/2,a.y+c/2),e.lineTo(a.x+c/2,a.y)),r[1]&&(e.moveTo(a.x,a.y+c/2),e.lineTo(a.x+1,a.y+c/2)),r[2]&&(e.moveTo(a.x+1-c/2,a.y),e.lineTo(a.x+1-c/2,a.y+c/2),e.lineTo(a.x+1,a.y+c/2)),r[3]&&(e.moveTo(a.x-c/2+1,a.y),e.lineTo(a.x-c/2+1,a.y+1)),r[4]&&(e.moveTo(a.x+1,a.y+1-c/2),e.lineTo(a.x+1-c/2,a.y+1-c/2),e.lineTo(a.x+1-c/2,a.y+1)),r[5]&&(e.moveTo(a.x+1,a.y-c/2+1),e.lineTo(a.x,a.y-c/2+1)),r[6]&&(e.moveTo(a.x+c/2,a.y+1),e.lineTo(a.x+c/2,a.y+1-c/2),e.lineTo(a.x,a.y+1-c/2)),r[7]&&(e.moveTo(a.x+c/2,a.y+1),e.lineTo(a.x+c/2,a.y)),e.strokeStyle="#00000040",e.stroke(),e.filter="none",e.restore()},v2:function(e,t,n,r,o){var l=1/8,a=new Map([[j.I,["#31c7ef","#48e0ff","#20b0e0"]],[j.O,["#f7d308","#ffec1c","#e8c000"]],[j.T,["#ad4d9c","#c658b4","#983888"]],[j.J,["#5a65ad","#6680cc","#4857a0"]],[j.L,["#ef7921","#ff9030","#e06810"]],[j.S,["#42b642","#48d048","#30a030"]],[j.Z,["#ef2029","#ff4848","#d01818"]],[j.GARBAGE,["#42b642","#48d048","#30a030"]]]),i=t,c=a.get(n);Object(pe["a"])(null!=c,"no color for piece"),e.save(),o==Ne.ghost?(e.fillStyle="white",e.fillRect(i.x,i.y,1,1),e.globalAlpha=.4):o!=Ne.disabled&&n!=j.GARBAGE||(e.filter="grayscale(100%)"),e.translate(i.x,i.y);var u=l,f=l/2,d=1-l,s=1-l/2;e.fillStyle=c[0],e.fillRect(u,u,1-2*l,1-2*l),e.lineCap="butt",e.lineWidth=l,e.beginPath(),e.moveTo(f,d),e.lineTo(f,u),e.strokeStyle=r[7]?c[1]:c[0],e.stroke(),e.beginPath(),e.moveTo(u,f),e.lineTo(d,f),e.strokeStyle=r[1]?c[1]:c[0],e.stroke(),e.beginPath(),e.moveTo(0,f),e.lineTo(f,f),e.lineTo(f,0),e.strokeStyle=r[0]||r[7]||r[1]?c[1]:c[0],e.stroke(),e.beginPath(),e.moveTo(s,u),e.lineTo(s,d),e.strokeStyle=r[3]?c[2]:c[0],e.stroke(),e.beginPath(),e.moveTo(d,s),e.lineTo(u,s),e.strokeStyle=r[5]?c[2]:c[0],e.stroke(),e.beginPath(),e.moveTo(1,s),e.lineTo(s,s),e.lineTo(s,1),e.strokeStyle=r[4]||r[3]||r[5]?c[2]:c[0],e.stroke(),e.beginPath(),e.moveTo(s,0),e.lineTo(s,f),e.lineTo(1,f),e.strokeStyle=r[2]&&r[1]&&r[3]?c[0]:r[1]?c[1]:r[3]||r[2]?c[2]:c[0],e.stroke(),e.beginPath(),e.moveTo(f,1),e.lineTo(f,s),e.lineTo(0,s),e.strokeStyle=r[6]&&r[7]&&r[5]?c[0]:r[7]?c[1]:r[5]?c[2]:r[6]?c[1]:c[0],e.stroke(),e.filter="none",e.restore()}};(function(e){e[e["normal"]=0]="normal",e[e["ghost"]=1]="ghost",e[e["disabled"]=2]="disabled"})(Ne||(Ne={}));var We=256;function Ze(e,t,n){for(var r=t<<8,o=0;o<8;++o)e[o]&&(r|=1<<o);return x.scale(new x(r%We,Math.floor(r/We)),n)}function Ke(e,t,n){var r=(new TextEncoder).encode(t.toString());window.crypto.subtle.digest("SHA-256",r).then((function(r){var o=Array.from(new Uint8Array(r)).map((function(e){return e.toString(16).padStart(2,"0")})).join(""),l=localStorage.getItem("mfro:tetris-tilesheet");if(l){var a=JSON.parse(l);if(a.hash==o)return void n(a.list);console.log("tilesheet hash match ".concat(a.hash," expected ").concat(o))}var i=[Ne.normal,Ne.ghost,Ne.disabled],c=document.createElement("canvas");c.width=e*We,c.height=e*i.length*(256/We);var u=c.getContext("2d");Object(pe["a"])(null!=u,"no context"),u.scale(e,e);var f,d=[],s=[].concat(Object(y["a"])(j.all),[j.GARBAGE]),b=Object(be["a"])(s);try{for(b.s();!(f=b.n()).done;){var v=f.value;u.clearRect(0,0,c.width,c.height);var m,p=Object(be["a"])(i);try{for(p.s();!(m=p.n()).done;)for(var O=m.value,g=0;g<256;++g){for(var _=[],h=0;h<8;++h)_[h]=0!=(g&1<<h);var x=Ze(_,O,1);t(u,x,v,_,O)}}catch(k){p.e(k)}finally{p.f()}var w=c.toDataURL();d.push(w),d.length==s.length&&(localStorage.setItem("mfro:tetris-tilesheet",JSON.stringify({hash:o,list:d})),n(d))}}catch(k){b.e(k)}finally{b.f()}}))}var He=[new x(-1,-1),new x(0,-1),new x(1,-1),new x(1,0),new x(1,1),new x(0,1),new x(-1,1),new x(-1,0)];function $e(e,t){var n=32,o=1/n,l=new Map;function a(e){return e.x<0||e.x>=t.rules.field_size.x||e.y<0||e.y>=t.rules.field_size.y?null:t.state.field[e.y][e.x]}function i(e,t,r,o){var a=l.get(t),i=Ze(r,o,n),c=new ve["f"];return c.scale=new ve["d"](1/n,1/n),c.texture=new ve["g"](a,new ve["e"](i.x,i.y,n,n)),c.position=new ve["d"](e.x,e.y),c}e.width=(t.rules.field_size.x+12)*n,e.height=t.rules.field_size.y/2*n,e.style.width="".concat(e.width,"px"),e.style.height="".concat(e.height,"px");var c=function(){function e(t){Object(_["a"])(this,e),this.container=t,this.sprites=[]}return Object(h["a"])(e,[{key:"clear",value:function(){var e,t=Object(be["a"])(this.sprites);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.container.removeChild(n)}}catch(r){t.e(r)}finally{t.f()}this.sprites=[]}},{key:"draw_tile",value:function(e,t,n,r){var o=i(e,t,n,r);this.sprites.push(o),this.container.addChild(o)}},{key:"draw_tetronimo",value:function(e,t){var n,r=this,o=e.kind.rotations[e.rotation],l=Object(be["a"])(e.kind.rotations[e.rotation]);try{var a=function(){var l=n.value,a=x.add(e.position,l),i=He.map((function(e){return o.every((function(t){return!x.eq(t,x.add(l,e))}))}));r.draw_tile(a,e.kind,i,t)};for(l.s();!(n=l.n()).done;)a()}catch(i){l.e(i)}finally{l.f()}}}]),e}();function u(e){var o=e().length,l=new ve["b"],a=new ve["c"];l.addChild(a),a.scale=new ve["d"](1/n,1/n);var i=x.scale(new x(0,0),n),u=x.scale(new x(4,1+3*o),n),f=2,d=8;a.lineStyle(f,8421504,1,0),a.moveTo(i.x,i.y+d),a.lineTo(i.x,i.y),a.lineTo(i.x+d,i.y),a.moveTo(u.x-d,i.y),a.lineTo(u.x,i.y),a.lineTo(u.x,i.y+d),a.moveTo(u.x,u.y-d),a.lineTo(u.x,u.y),a.lineTo(u.x-d,u.y),a.moveTo(i.x+d,u.y),a.lineTo(i.x,u.y),a.lineTo(i.x,u.y-d);var s=new c(l);return Object(r["E"])((function(){return[e(),t.state.hold_available]}),(function(e){var t=Object(se["a"])(e,2),n=t[0],r=t[1];s.clear();var o,l=new x(2,2),a=Object(be["a"])(n);try{for(a.s();!(o=a.n()).done;){var i=o.value;if(i){var c=Pe({id:-1,kind:i,position:x.zero,rotation:0}),u=c.reduce((function(e,t){return Math.min(e,t.x)}),1/0)+.5,f=c.reduce((function(e,t){return Math.min(e,t.y)}),1/0)+.5,d=c.reduce((function(e,t){return Math.max(e,t.x)}),-1/0)+.5,b=c.reduce((function(e,t){return Math.max(e,t.y)}),-1/0)+.5,v=new x(-(u+d)/2,-(f+b)/2),j=x.add(l,v),m=1!=n.length||r?Ne.normal:Ne.disabled;s.draw_tetronimo({id:-1,kind:i,position:j,rotation:0},m),l=x.add(l,new x(0,3))}}}catch(p){a.e(p)}finally{a.f()}}),{immediate:!0}),l}function f(e){e.beginFill(16777215),e.drawRect(0,0,t.rules.field_size.x,t.rules.field_size.y),e.endFill(),e.lineStyle(o,16053492);for(var n=0;n<t.rules.field_size.x;++n)e.moveTo(n+.5*o,0),e.lineTo(n+.5*o,t.rules.field_size.y),e.moveTo(n+1-.5*o,0),e.lineTo(n+1-.5*o,t.rules.field_size.y);for(var r=0;r<t.rules.field_size.y;++r)e.moveTo(0,r+.5*o),e.lineTo(t.rules.field_size.x,r+.5*o),e.moveTo(0,r+1-.5*o),e.lineTo(t.rules.field_size.x,r+1-.5*o)}var d=new ve["a"]({view:e,width:n*(t.rules.field_size.x+12),height:n*(t.rules.field_size.y/2),transparent:!0});return Ke(n,Fe.v2,(function(e){e.forEach((function(e,t){d.loader.add(t.toString(),e)})),d.loader.load()})),d.loader.onLoad.once((function(){for(var e=0;e<7;++e){var o=d.loader.resources[e].texture.baseTexture;l.set(j.all[e],o)}var s=d.loader.resources[j.all.length].texture.baseTexture;l.set(j.GARBAGE,s);var b=new ve["b"];b.scale=new ve["d"](n,n);var v=new ve["b"];v.position=new ve["d"](6,-t.rules.field_size.y/2);var m=new ve["c"];f(m);var p=u((function(){return[t.state.holding]}));p.position=new ve["d"](1,1);var O=u((function(){return t.state.fall_queue.slice(0,5)}));O.position=new ve["d"](7+t.rules.field_size.x,1);var y=new ve["b"];y.position=new ve["d"](4,0),v.addChild(m),b.addChild(v),b.addChild(O),b.addChild(p),b.addChild(y),d.stage.addChild(b);for(var _=function(e){for(var n=function(n){var o=new x(e,n),l=null;Object(r["F"])((function(){null!=l&&(v.removeChild(l),l=null);var r=t.state.field[n][e];if(null!=r){var c=He.map((function(e){var t;return(null===(t=a(x.add(o,e)))||void 0===t?void 0:t.id)!=r.id}));l=i(new x(e,n),r.kind,c,Ne.normal),v.addChild(l)}}))},o=0;o<t.rules.field_size.y;++o)n(o)},h=0;h<t.rules.field_size.x;++h)_(h);var w=new c(v);Object(r["F"])((function(){if(w.clear(),t.state.falling){var e=t.hard_drop_position(t.state.falling),n=Object(g["a"])(Object(g["a"])({},t.state.falling),{},{position:e});w.draw_tetronimo(n,Ne.ghost),w.draw_tetronimo(t.state.falling,Ne.normal)}}));var k=new c(y);Object(r["F"])((function(){k.clear();var e,n=t.rules.field_size.y/2,r=Object(be["a"])(t.state.garbage);try{for(r.s();!(e=r.n()).done;){var o=e.value;n-=o;for(var l=0;l<o;++l){var a=new x(0,n+l);k.draw_tile(a,j.GARBAGE,[!0,0==l,!0,!0,!0,l+1==o,!0,!0],Ne.normal)}}}catch(i){r.e(i)}finally{r.f()}}))})),function(){return d.destroy()}}var Qe={name:"game",props:{value:Object},setup:function(e){var t,n=Object(r["C"])(e,"value"),o=Object(r["u"])(null);return Object(r["o"])((function(){Object(r["E"])(n,(function(e,n){var r;null===(r=t)||void 0===r||r(),e&&(t=$e(o.value,e))}),{immediate:!0})})),{canvas:o}}};Qe.render=de;var Xe=Qe,Ye=Object(r["i"])("content_paste"),et=Object(r["i"])("check");function tt(e,t,n,o,l,a){var i=Object(r["x"])("v-icon"),c=Object(r["x"])("v-button"),u=Object(r["x"])("v-text-field"),f=Object(r["x"])("v-flex");return Object(r["p"])(),Object(r["f"])(f,{"align-center":"","justify-center":""},{default:Object(r["G"])((function(){return[Object(r["j"])(c,{small:"",icon:"",onClick:t[1]||(t[1]=function(e){return o.copy()}),onMouseleave:t[2]||(t[2]=function(e){return o.copied=!1})},{default:Object(r["G"])((function(){return[o.copied?(Object(r["p"])(),Object(r["f"])(i,{key:1,small:"",bold:"",style:{color:"#4caf50"}},{default:Object(r["G"])((function(){return[et]})),_:1})):(Object(r["p"])(),Object(r["f"])(i,{key:0,small:""},{default:Object(r["G"])((function(){return[Ye]})),_:1}))]})),_:1}),Object(r["j"])(u,{small:"",class:"mt-0 ml-4",ref:"input",solo:"","model-value":n.value},null,8,["model-value"])]})),_:1})}var nt={name:"clipboard",props:{value:String},setup:function(e){var t=Object(r["A"])(null),n=Object(r["A"])(!1);return{input:t,copied:n,copy:function(){t.value.select(),document.execCommand("copy"),n.value=!0}}}};nt.render=tt;var rt=nt,ot={name:"room",components:{game:Xe,clipboard:rt,editConfig:re},props:["room"],setup:function(e){var t=window.location,n=Object(r["d"])((function(){return"".concat(t.origin).concat(t.pathname,"?code=").concat(e.room.code)})),o=Object(r["A"])(!1),l=Object(r["z"])({field_size:new x(10,40),fall_delay:50,lock_delay:30,move_reset_limit:15,wall_kicks:m.standard,bag_preview:5}),a=Object(r["d"])((function(){return e.room.members.filter((function(t,n){return n!=e.room.index}))}));return{link:n,editing:o,game_rules:l,others:a,start:function(){e.room.start_game(l)}}}};ot.render=ue;var lt=ot,at=Object(r["j"])("span",null,"Create lobby",-1),it=Object(r["i"])("arrow_forward");function ct(e,t,n,o,l,a){var i=Object(r["x"])("edit-config"),c=Object(r["x"])("v-dialog"),u=Object(r["x"])("game"),f=Object(r["x"])("v-grow"),d=Object(r["x"])("v-text-field"),s=Object(r["x"])("v-icon"),b=Object(r["x"])("v-button"),v=Object(r["x"])("v-flex"),j=Object(r["x"])("v-card");return Object(r["p"])(),Object(r["f"])(r["a"],null,[Object(r["j"])(c,{"model-value":o.editing},{default:Object(r["G"])((function(){return[Object(r["j"])(i,{kind:"game",modelValue:o.game_rules,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.game_rules=e}),onClose:t[2]||(t[2]=function(e){return o.editing=!1})},null,8,["modelValue"])]})),_:1},8,["model-value"]),Object(r["j"])(v,{column:"",grow:"","align-center":""},{default:Object(r["G"])((function(){return[Object(r["j"])(u,{value:o.local_game},null,8,["value"]),Object(r["j"])(f),Object(r["j"])(j,{class:"mt-4"},{default:Object(r["G"])((function(){return[Object(r["j"])(d,{label:"Name",modelValue:o.name,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.name=e})},null,8,["modelValue"]),Object(r["j"])(v,{"justify-center":"",class:"my-2"},{default:Object(r["G"])((function(){return[Object(r["j"])(b,{text:"",color:"primary",disabled:!o.valid,onClick:t[4]||(t[4]=function(e){return o.create_room()})},{default:Object(r["G"])((function(){return[at,Object(r["j"])(s,{class:"ml-3"},{default:Object(r["G"])((function(){return[it]})),_:1})]})),_:1},8,["disabled"])]})),_:1})]})),_:1})]})),_:1})],64)}n("32ec"),n("5f99");var ut=n("4c57"),ft=n("d313"),dt=n("b740");function st(e,t,n){var r=e[t];e[t]=function(){var e=r.apply(void 0,arguments);return n.apply(void 0,arguments),e}}function bt(e,t,n){var o,l="box:8080"==window.location.host||"localhost:8080"==window.location.host?"ws://box:8081/":"wss://api.mfro.me/tetris/play",a=Object(r["z"])({local:null,index:0,members:[],code:n,state:0,start_game:function(e){var t=me()(Math.random()).uint32();Object(ft["send"])(o,dt["StartGameRequest"],{seed:t,rules:p.save(e)})}});function i(){var e=a.members.filter((function(e,t){return e.game&&!e.game.state.dead}));if(1==e.length)e[0].winner=!0;else if(0==e.length){a.local=null;var t,n=Object(be["a"])(a.members);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.game=null}}catch(o){n.e(o)}finally{n.f()}}}o=a.code?new WebSocket("".concat(l,"?name=").concat(e,"&code=").concat(a.code)):new WebSocket("".concat(l,"?name=").concat(e));var c=null;return Object(ut["c"])(Object(ft["receive"])(o,dt["StartGame"]),(function(e){var n;null===(n=c)||void 0===n||n();var r=p.load(e.rules),l=Le(Je(r,e.seed));a.local=Be(r,l);for(var u=0;u<e.players;++u)if(a.members[u].winner=!1,u==a.index)a.members[u].game=a.local;else{var f=Le(Je(r,e.seed));a.members[u].game=Be(r,f)}st(a.local,"hold",(function(){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"hold"})})),st(a.local,"drop",(function(e){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"drop",distance:e})})),st(a.local,"shift",(function(e){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"shift",dir:e})})),st(a.local,"rotate",(function(e){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"rotate",dir:e})})),st(a.local,"lock_down",(function(){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"lock_down"})})),st(a.local,"new_falling",(function(){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"new_falling"})})),st(a.local,"clear_lines",(function(e){return Object(ft["send"])(o,dt["ClientUpdate"],{type:"send_lines",count:vt(e.length)})})),st(a.local,"end_game",(function(){Object(ft["send"])(o,dt["ClientUpdate"],{type:"end_game"}),i()})),c=qe(t,a.local)})),Object(ut["c"])(Object(ft["receive"])(o,dt["BroadcastUpdate"]),(function(e){var t=Object(se["a"])(e,2),n=t[0],r=t[1],o=a.members[n].game;if(o!=a.local||"send_lines"==r.type)switch(r.type){case"hold":o.hold();break;case"drop":o.drop(r.distance);break;case"shift":o.shift(r.dir);break;case"rotate":o.rotate(r.dir);break;case"lock_down":o.lock_down();break;case"new_falling":o.new_falling();break;case"end_game":o.end_game(),i();break;case"send_lines":var l=a.members[(n+1)%a.members.length].game;l.add_garbage(r.count);break}})),Object(ut["c"])(Object(ft["receive"])(o,dt["RoomCode"]),(function(e){if(e!=a.code){var t=new URL(window.location.href);t.searchParams.delete("code"),window.history.replaceState(null,document.title,t.pathname+t.search)}a.code=e})),Object(ut["c"])(Object(ft["receive"])(o,dt["RoomState"]),(function(e){var t=e.index,n=e.names;if(a.members=n.map((function(e){return{name:e,game:null,winner:!1}})),a.index=t,a.members.length>1){var r=new URL(window.location.href);r.searchParams.set("code",a.code),window.history.replaceState(null,document.title,r.pathname+r.search)}i()})),a}function vt(e){return 4==e?4:e-1}var jt={name:"landing",components:{game:Xe,editConfig:re,configGameRules:Z,configUserPrefs:te},emits:["room"],setup:function(e,t){var n,o,l=t.emit,a=Object(r["A"])(null),i=Object(r["z"])({field_size:new x(10,40),fall_delay:50,lock_delay:30,move_reset_limit:15,wall_kicks:m.standard,bag_preview:5}),c=Object(r["l"])("user_prefs"),u=Object(r["A"])(null),f=function(){var e;null===(e=o)||void 0===e||e();var t=Le(Je(i));u.value=Be(i,t),o=qe(c,u.value)};Object(r["o"])((function(){f()})),Object(r["n"])((function(){var e;return null===(e=o)||void 0===e?void 0:e()})),Ue(Ge,(function(){return f()}));var d=Object(r["A"])(null!==(n=localStorage.getItem("mfro:user-name"))&&void 0!==n?n:""),s=Object(r["d"])((function(){return""!=d.value}));return{local_game:u,editing:a,game_rules:i,name:d,valid:s,create_room:function(){localStorage.setItem("mfro:user-name",d.value);var e=bt(d.value,c);l("room",e)},edit:function(e){a.value=e}}}};jt.render=ct;var mt=jt,pt=Object(r["j"])("span",null,"Join lobby",-1),Ot=Object(r["i"])("arrow_forward");function gt(e,t,n,o,l,a){var i=Object(r["x"])("v-text-field"),c=Object(r["x"])("v-icon"),u=Object(r["x"])("v-button"),f=Object(r["x"])("v-flex"),d=Object(r["x"])("v-card");return Object(r["p"])(),Object(r["f"])(f,{column:"",grow:"","align-center":""},{default:Object(r["G"])((function(){return[Object(r["j"])(d,{class:"mb-4"},{default:Object(r["G"])((function(){return[Object(r["j"])(i,{label:"Code",modelValue:o.code,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.code=e})},null,8,["modelValue"]),Object(r["j"])(i,{label:"Name",modelValue:o.name,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.name=e})},null,8,["modelValue"]),Object(r["j"])(f,{"justify-center":"",class:"my-2"},{default:Object(r["G"])((function(){return[Object(r["j"])(u,{text:"",color:"primary",disabled:!o.valid,onClick:t[3]||(t[3]=function(e){return o.submit()})},{default:Object(r["G"])((function(){return[pt,Object(r["j"])(c,{class:"ml-3"},{default:Object(r["G"])((function(){return[Ot]})),_:1})]})),_:1},8,["disabled"])]})),_:1})]})),_:1})]})),_:1})}var yt={name:"joining",emits:["room"],props:{code:String},setup:function(e,t){var n,o=t.emit,l=Object(r["A"])(null!==(n=localStorage.getItem("mfro:user-name"))&&void 0!==n?n:""),a=Object(r["A"])(e.code),i=Object(r["d"])((function(){return""!=l.value})),c=Object(r["l"])("user_prefs");return{name:l,code:a,valid:i,submit:function(){localStorage.setItem("mfro:user-name",l.value);var e=bt(l.value,c,a.value);o("room",e)}}}};yt.render=gt;var _t=yt,ht={name:"tetris",components:{editConfig:re,room:lt,landing:mt,joining:_t},setup:function(){var e=Object(r["A"])(null),t=new URL(window.location.href),n=t.searchParams.get("code"),o=Object(r["A"])(n),l=localStorage.getItem("mfro:tetris-user-preferences"),a=Object(r["A"])(!1),i=l?JSON.parse(l):{autoshift:{delay:2,initial_delay:10},soft_drop:10};return Object(r["r"])("user_prefs",i),{current_room:e,joining_code:o,editing_user:a,user_prefs:Object(r["d"])({get:function(){return i},set:function(e){Object.assign(i,e),localStorage.setItem("mfro:tetris-user-preferences",JSON.stringify(e))}})}}};n("2195"),n("50a0");ht.render=c,ht.__scopeId="data-v-3ed78246";var xt=ht;Object(r["e"])(xt).use(o["a"]).mount("#app")},d92e:function(e,t,n){"use strict";n("13e7")},e70f:function(e,t,n){}});
//# sourceMappingURL=index.076edb7c.js.map